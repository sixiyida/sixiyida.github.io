<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Guide and Code Explanation for SAA Graph">
<title>Spring AI Alibaba Graph ‰ΩøÁî®ÊåáÂçó‰∏éÊ∫êÁ†ÅËß£ËØª</title>

<link rel='canonical' href='https://sixiyida.github.io/p/spring-ai-alibaba-graph-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97%E4%B8%8E%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/'>

<link rel="stylesheet" href="/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css"><meta property='og:title' content="Spring AI Alibaba Graph ‰ΩøÁî®ÊåáÂçó‰∏éÊ∫êÁ†ÅËß£ËØª">
<meta property='og:description' content="Guide and Code Explanation for SAA Graph">
<meta property='og:url' content='https://sixiyida.github.io/p/spring-ai-alibaba-graph-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97%E4%B8%8E%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/'>
<meta property='og:site_name' content='sixiyida'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Java' /><meta property='article:tag' content='LLM' /><meta property='article:tag' content='Infrastructure' /><meta property='article:published_time' content='2025-07-15T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-07-15T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="Spring AI Alibaba Graph ‰ΩøÁî®ÊåáÂçó‰∏éÊ∫êÁ†ÅËß£ËØª">
<meta name="twitter:description" content="Guide and Code Explanation for SAA Graph">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_599050889a64db87.png" width="300"
                            height="299" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üòÄ</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">sixiyida</a></h1>
            <h2 class="site-description">sixiyida&#39;s notes</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/sixiyida'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.xiaohongshu.com/user/profile/6329e87e000000002303d3d3'
                        target="_blank"
                        title="RedBook"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Created with Inkscape (http://www.inkscape.org/) -->

<svg
   version="1.1"
   id="svg1"
   width="256"
   height="256"
   viewBox="0 0 256 256"
   sodipodi:docname="XiaohongshuLOGO.png"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <defs
     id="defs1" />
  <sodipodi:namedview
     id="namedview1"
     pagecolor="#ffffff"
     bordercolor="#000000"
     borderopacity="0.25"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:zoom="2.6914062"
     inkscape:cx="127.81422"
     inkscape:cy="128"
     inkscape:window-width="1600"
     inkscape:window-height="928"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="1"
     inkscape:current-layer="g1" />
  <g
     inkscape:groupmode="layer"
     inkscape:label="Image"
     id="g1">
    <path
       style="fill:#ff2842;stroke:none"
       d="M 29,0.33332825 C 13.959937,3.4666748 1.5356731,15.204498 0,31 -1.586103,47.314209 0,64.597672 0,81 v 102 c 0,18.76035 -4.7369685,44.19888 7.3333335,60 C 20.372129,260.06897 44.156731,256 63,256 h 111 35 c 5.78276,0 12.33244,0.84741 18,-0.33333 15.0401,-3.13336 27.46432,-14.87115 29,-30.66667 1.58612,-16.31419 0,-33.59769 0,-50 V 73 C 256,54.239685 260.73697,28.801102 248.66667,13 235.62787,-4.0689697 211.84329,0 193,0 H 82 47 C 41.217228,0 34.667561,-0.84741211 29,0.33332825 M 120,91 l -7,19 h 12 l -10,24 9,1 c -0.98794,2.68155 -2.31718,7.73317 -4.33334,9.83334 C 118.18945,146.3721 115.92654,146 114,146 c -4.35942,0 -13.16798,1.80539 -15.5,-3 -1.069664,-2.20416 0.465553,-4.98451 1.333336,-7 1.813624,-4.21228 4.222554,-8.51549 5.166664,-13 -2.17548,0 -4.92464,0.42967 -7,-0.33333 -7.778526,-2.85974 0.874031,-15.36435 2.66666,-19.66667 1.25875,-3.020981 2.75652,-9.584732 5.5,-11.5 C 110.01874,88.810822 115.88325,90.674988 120,91 m -79,63 c 2.750713,0 6.837379,0.81721 8.5,-2 1.769028,-2.99753 0.5,-9.58963 0.5,-13 V 106 C 50,102.90659 48.438198,93.464493 51.166668,91.5 53.41069,89.884308 62.832935,90.226166 63.833332,93 65.47065,97.539825 64,105.16241 64,110 v 32 c 0,5.48389 0.949112,11.8645 -1.333332,17 -2.177158,4.89861 -12.303417,9.27243 -17.333336,5.5 C 43.120155,162.84012 41.545292,156.59013 41,154 M 193,91 v 5 c 3.72887,0 8.4108,-0.763367 12,0.333328 11.97635,3.659424 11,15.422502 11,25.666672 1.99706,0 4.04419,-0.15562 6,0.33333 11.49335,2.87334 10,14.36401 10,23.66667 0,4.95615 0.93086,10.82184 -2.33333,15 -3.59567,4.60246 -9.48195,4 -14.66667,4 -1.6116,0 -4.26318,0.51051 -5.66667,-0.5 -2.62326,-1.88875 -3.78159,-7.50485 -4.33333,-10.5 3.28711,0 9.2179,1.12517 11.83333,-1.33334 C 219.9164,149.76859 218.65411,138.43454 215,136.5 c -1.93661,-1.02527 -4.88672,-0.5 -7,-0.5 h -15 v 29 h -14 v -29 h -14 v -14 h 14 v -12 h -9 V 96 h 9 v -5 h 14 m -32,5 v 14 h -8 v 42 h 13 v 13 H 120 L 125.33334,152.5 138,152 v -42 h -8 V 96 h 31 m 57,14 c 0,-2.84204 -0.51608,-6.25871 0.33333,-9 3.34434,-10.793121 19.61577,-2.093994 11.5,6.83333 -0.92279,1.01507 -2.54419,1.51106 -3.83333,1.83334 C 223.43948,110.30679 220.61993,110 218,110 M 41,110 36.833332,147 30,159 24,143 27,110 h 14 m 46,0 3,33 -6,15 h -2 c -5.366936,-8.49765 -6.053299,-17.26251 -7,-27 -0.672195,-6.91406 -2,-14.04004 -2,-21 h 14 m 106,0 v 12 h 9 v -12 h -9 m -75,42 -5,13 H 91 L 96.333336,151.5 104,151.66666 Z"
       id="path1" />
  </g>
</svg>

                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about-me/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About Me</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://sixiyida.github.io/" selected>English</option>
                                
                                    <option value="https://sixiyida.github.io/zh-cn/" >‰∏≠Êñá</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#ÁõÆÂΩï">ÁõÆÂΩï</a></li>
    <li><a href="#1-ÂºïË®Ä‰∏éÊ¶ÇËø∞">1. ÂºïË®Ä‰∏éÊ¶ÇËø∞</a>
      <ol>
        <li><a href="#11-spring-ai-alibaba-graph-Ê¶ÇËø∞">1.1 Spring AI Alibaba Graph Ê¶ÇËø∞</a></li>
        <li><a href="#12-Ê†∏ÂøÉÁâπÊÄß‰∏é‰ºòÂäø">1.2 Ê†∏ÂøÉÁâπÊÄß‰∏é‰ºòÂäø</a>
          <ol>
            <li><a href="#javaÁîüÊÄÅÊ∑±Â∫¶ÈõÜÊàê">JavaÁîüÊÄÅÊ∑±Â∫¶ÈõÜÊàê</a></li>
            <li><a href="#‰∏∞ÂØåÁöÑÈ¢ÑÁΩÆÁªÑ‰ª∂">‰∏∞ÂØåÁöÑÈ¢ÑÁΩÆÁªÑ‰ª∂</a></li>
            <li><a href="#Â£∞ÊòéÂºèapiËÆæËÆ°">Â£∞ÊòéÂºèAPIËÆæËÆ°</a></li>
            <li><a href="#Áîü‰∫ßÁ∫ßÁâπÊÄß">Áîü‰∫ßÁ∫ßÁâπÊÄß</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#Âø´ÈÄüÂºÄÂßãÂÆ¢Êà∑ËØÑ‰ª∑ÂàÜÁ±ªÁ≥ªÁªü">Âø´ÈÄüÂºÄÂßãÔºöÂÆ¢Êà∑ËØÑ‰ª∑ÂàÜÁ±ªÁ≥ªÁªü</a>
      <ol>
        <li><a href="#Á≥ªÁªüÊû∂ÊûÑ">Á≥ªÁªüÊû∂ÊûÑ</a></li>
        <li><a href="#Ê†∏ÂøÉ‰ª£Á†ÅÂÆûÁé∞">Ê†∏ÂøÉ‰ª£Á†ÅÂÆûÁé∞</a></li>
      </ol>
    </li>
    <li><a href="#2-Ê†∏ÂøÉÊû∂ÊûÑ‰∏éËÆæËÆ°ÁêÜÂøµ">2. Ê†∏ÂøÉÊû∂ÊûÑ‰∏éËÆæËÆ°ÁêÜÂøµ</a>
      <ol>
        <li><a href="#21-Êï¥‰ΩìÊï∞ÊçÆÊµÅËΩ¨Êû∂ÊûÑ">2.1 Êï¥‰ΩìÊï∞ÊçÆÊµÅËΩ¨Êû∂ÊûÑ</a>
          <ol>
            <li><a href="#211-ÂÆåÊï¥Êï∞ÊçÆÊµÅËΩ¨Âõæ">2.1.1 ÂÆåÊï¥Êï∞ÊçÆÊµÅËΩ¨Âõæ</a></li>
            <li><a href="#212-Ê†∏ÂøÉÊâßË°åÊµÅÁ®ãËØ¶Ëß£">2.1.2 Ê†∏ÂøÉÊâßË°åÊµÅÁ®ãËØ¶Ëß£</a></li>
            <li><a href="#213-ÂÖ≥ÈîÆÊï∞ÊçÆÁªìÊûÑÊµÅËΩ¨">2.1.3 ÂÖ≥ÈîÆÊï∞ÊçÆÁªìÊûÑÊµÅËΩ¨</a></li>
          </ol>
        </li>
        <li><a href="#22-Êï¥‰ΩìÊû∂ÊûÑËÆæËÆ°">2.2 Êï¥‰ΩìÊû∂ÊûÑËÆæËÆ°</a>
          <ol>
            <li><a href="#221-Á≥ªÁªüÊû∂ÊûÑÊÄªËßà">2.2.1 Á≥ªÁªüÊû∂ÊûÑÊÄªËßà</a></li>
            <li><a href="#222-stategraphÊûÑÂª∫ÊµÅÁ®ã">2.2.2 StateGraphÊûÑÂª∫ÊµÅÁ®ã</a></li>
            <li><a href="#223-compiledgraphÊâßË°åÊµÅÁ®ã">2.2.3 CompiledGraphÊâßË°åÊµÅÁ®ã</a></li>
          </ol>
        </li>
        <li><a href="#23-Ê†∏ÂøÉÁªÑ‰ª∂ÂÖ≥Á≥ªÂõæ">2.3 Ê†∏ÂøÉÁªÑ‰ª∂ÂÖ≥Á≥ªÂõæ</a></li>
        <li><a href="#24-Ê†∏ÂøÉËÆæËÆ°ÁêÜÂøµ">2.4 Ê†∏ÂøÉËÆæËÆ°ÁêÜÂøµ</a>
          <ol>
            <li><a href="#241-Â£∞ÊòéÂºèÁºñÁ®ãÊ®°Âûã">2.4.1 Â£∞ÊòéÂºèÁºñÁ®ãÊ®°Âûã</a></li>
            <li><a href="#242-Áä∂ÊÄÅÈ©±Âä®ÁöÑÊâßË°åÊ®°Âûã">2.4.2 Áä∂ÊÄÅÈ©±Âä®ÁöÑÊâßË°åÊ®°Âûã</a></li>
            <li><a href="#243-ÂºÇÊ≠•‰ºòÂÖàÁöÑËÆæËÆ°">2.4.3 ÂºÇÊ≠•‰ºòÂÖàÁöÑËÆæËÆ°</a></li>
          </ol>
        </li>
        <li><a href="#25-springÁîüÊÄÅÈõÜÊàê">2.5 SpringÁîüÊÄÅÈõÜÊàê</a>
          <ol>
            <li><a href="#251-‰æùËµñÊ≥®ÂÖ•Êû∂ÊûÑ">2.5.1 ‰æùËµñÊ≥®ÂÖ•Êû∂ÊûÑ</a></li>
            <li><a href="#252-‰æùËµñÊ≥®ÂÖ•ÊîØÊåÅ">2.5.2 ‰æùËµñÊ≥®ÂÖ•ÊîØÊåÅ</a></li>
            <li><a href="#253-ËßÇÊµãÊÄßÈõÜÊàê">2.5.3 ËßÇÊµãÊÄßÈõÜÊàê</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#3-Ê†∏ÂøÉÊ¶ÇÂøµÊ∑±Â∫¶Ëß£Êûê">3. Ê†∏ÂøÉÊ¶ÇÂøµÊ∑±Â∫¶Ëß£Êûê</a>
      <ol>
        <li><a href="#31-stategraph-Áä∂ÊÄÅÂõæ">3.1 StateGraph (Áä∂ÊÄÅÂõæ)</a>
          <ol>
            <li><a href="#311-stategraphÁîüÂëΩÂë®Êúü">3.1.1 StateGraphÁîüÂëΩÂë®Êúü</a></li>
            <li><a href="#312-Âü∫Êú¨ÊûÑÈÄ†">3.1.2 Âü∫Êú¨ÊûÑÈÄ†</a></li>
            <li><a href="#313-ËäÇÁÇπÁÆ°ÁêÜÊµÅÁ®ã">3.1.3 ËäÇÁÇπÁÆ°ÁêÜÊµÅÁ®ã</a></li>
            <li><a href="#314-ËæπÁÆ°ÁêÜÊµÅÁ®ã">3.1.4 ËæπÁÆ°ÁêÜÊµÅÁ®ã</a></li>
            <li><a href="#315-ÂõæÈ™åËØÅÊú∫Âà∂">3.1.5 ÂõæÈ™åËØÅÊú∫Âà∂</a></li>
          </ol>
        </li>
        <li><a href="#32-overallstate-ÂÖ®Â±ÄÁä∂ÊÄÅ">3.2 OverAllState (ÂÖ®Â±ÄÁä∂ÊÄÅ)</a>
          <ol>
            <li><a href="#321-Áä∂ÊÄÅÁÆ°ÁêÜÊû∂ÊûÑ">3.2.1 Áä∂ÊÄÅÁÆ°ÁêÜÊû∂ÊûÑ</a></li>
            <li><a href="#322-Áä∂ÊÄÅÊõ¥Êñ∞ÊµÅÁ®ã">3.2.2 Áä∂ÊÄÅÊõ¥Êñ∞ÊµÅÁ®ã</a></li>
            <li><a href="#323-Áä∂ÊÄÅÁ≠ñÁï•ËØ¶Ëß£">3.2.3 Áä∂ÊÄÅÁ≠ñÁï•ËØ¶Ëß£</a></li>
          </ol>
        </li>
        <li><a href="#33-node-ËäÇÁÇπ">3.3 Node (ËäÇÁÇπ)</a>
          <ol>
            <li><a href="#331-ËäÇÁÇπÊâßË°åÊµÅÁ®ã">3.3.1 ËäÇÁÇπÊâßË°åÊµÅÁ®ã</a></li>
            <li><a href="#332-ËäÇÁÇπÁ±ªÂûãÂ±ÇÊ¨°ÁªìÊûÑ">3.3.2 ËäÇÁÇπÁ±ªÂûãÂ±ÇÊ¨°ÁªìÊûÑ</a></li>
            <li><a href="#333-Âπ∂Ë°åËäÇÁÇπÂ§ÑÁêÜÊú∫Âà∂">3.3.3 Âπ∂Ë°åËäÇÁÇπÂ§ÑÁêÜÊú∫Âà∂</a></li>
          </ol>
        </li>
        <li><a href="#34-edge-Ëæπ">3.4 Edge (Ëæπ)</a>
          <ol>
            <li><a href="#341-ËæπÁöÑÁ±ªÂûã‰∏éÁªìÊûÑ">3.4.1 ËæπÁöÑÁ±ªÂûã‰∏éÁªìÊûÑ</a></li>
            <li><a href="#342-Êù°‰ª∂ËæπË∑ØÁî±ÊµÅÁ®ã">3.4.2 Êù°‰ª∂ËæπË∑ØÁî±ÊµÅÁ®ã</a></li>
            <li><a href="#343-ËæπÈ™åËØÅÊú∫Âà∂">3.4.3 ËæπÈ™åËØÅÊú∫Âà∂</a></li>
          </ol>
        </li>
        <li><a href="#35-compiledgraph-ÁºñËØëÂõæ">3.5 CompiledGraph (ÁºñËØëÂõæ)</a>
          <ol>
            <li><a href="#351-ÁºñËØëËøáÁ®ãËØ¶Ëß£">3.5.1 ÁºñËØëËøáÁ®ãËØ¶Ëß£</a></li>
            <li><a href="#352-asyncnodegeneratorÊâßË°åÊú∫Âà∂">3.5.2 AsyncNodeGeneratorÊâßË°åÊú∫Âà∂</a></li>
            <li><a href="#353-Áä∂ÊÄÅÊµÅËΩ¨Ê†∏ÂøÉÈÄªËæë">3.5.3 Áä∂ÊÄÅÊµÅËΩ¨Ê†∏ÂøÉÈÄªËæë</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#4-È¢ÑÂÆö‰πâÁªÑ‰ª∂‰∏éÂ∑•ÂÖ∑ÁÆ±">4. È¢ÑÂÆö‰πâÁªÑ‰ª∂‰∏éÂ∑•ÂÖ∑ÁÆ±</a>
      <ol>
        <li><a href="#41-È¢ÑÂÆö‰πâËäÇÁÇπÁ±ªÂûã">4.1 È¢ÑÂÆö‰πâËäÇÁÇπÁ±ªÂûã</a>
          <ol>
            <li><a href="#411-ËäÇÁÇπÂàÜÁ±ªÊû∂ÊûÑ">4.1.1 ËäÇÁÇπÂàÜÁ±ªÊû∂ÊûÑ</a></li>
            <li><a href="#412-questionclassifiernode---Êô∫ËÉΩÂàÜÁ±ªËäÇÁÇπ">4.1.2 QuestionClassifierNode - Êô∫ËÉΩÂàÜÁ±ªËäÇÁÇπ</a></li>
            <li><a href="#413-llmnode---Â§ßÊ®°ÂûãË∞ÉÁî®ËäÇÁÇπ">4.1.3 LlmNode - Â§ßÊ®°ÂûãË∞ÉÁî®ËäÇÁÇπ</a></li>
            <li><a href="#414-toolnode---Â∑•ÂÖ∑Ë∞ÉÁî®ËäÇÁÇπ">4.1.4 ToolNode - Â∑•ÂÖ∑Ë∞ÉÁî®ËäÇÁÇπ</a></li>
            <li><a href="#415-knowledgeretrievalnode---Áü•ËØÜÊ£ÄÁ¥¢ËäÇÁÇπ">4.1.5 KnowledgeRetrievalNode - Áü•ËØÜÊ£ÄÁ¥¢ËäÇÁÇπ</a></li>
          </ol>
        </li>
        <li><a href="#42-È¢ÑÂÆö‰πâagentÁ±ªÂûã">4.2 È¢ÑÂÆö‰πâAgentÁ±ªÂûã</a>
          <ol>
            <li><a href="#421-reactagent---ÂèçÂ∫îÂºèagent">4.2.1 ReactAgent - ÂèçÂ∫îÂºèAgent</a></li>
            <li><a href="#422-reflectagent---ÂèçÊÄùagent">4.2.2 ReflectAgent - ÂèçÊÄùAgent</a></li>
            <li><a href="#423-reactagentwithhuman---‰∫∫Êú∫Âçè‰Ωúagent">4.2.3 ReactAgentWithHuman - ‰∫∫Êú∫Âçè‰ΩúAgent</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#5-È´òÁ∫ßÁâπÊÄß‰∏éÊâ©Â±ïËÉΩÂäõ">5. È´òÁ∫ßÁâπÊÄß‰∏éÊâ©Â±ïËÉΩÂäõ</a>
      <ol>
        <li><a href="#51-ÂèØËßÇÊµãÊÄß">5.1 ÂèØËßÇÊµãÊÄß</a>
          <ol>
            <li><a href="#511-Ê†∏ÂøÉÁâπÊÄß">5.1.1 Ê†∏ÂøÉÁâπÊÄß</a></li>
            <li><a href="#512-Âø´ÈÄüÊé•ÂÖ•">5.1.2 Âø´ÈÄüÊé•ÂÖ•</a></li>
            <li><a href="#513-ËØ¶ÁªÜÊñáÊ°£">5.1.3 ËØ¶ÁªÜÊñáÊ°£</a></li>
          </ol>
        </li>
        <li><a href="#52-Âπ∂Ë°åËäÇÁÇπ‰∏éÊµÅÂºèÂ§ÑÁêÜ">5.2 Âπ∂Ë°åËäÇÁÇπ‰∏éÊµÅÂºèÂ§ÑÁêÜ</a>
          <ol>
            <li><a href="#521-Âπ∂Ë°åËäÇÁÇπÁöÑ‰∏§ÁßçÂàõÂª∫ÊñπÂºè">5.2.1 Âπ∂Ë°åËäÇÁÇπÁöÑ‰∏§ÁßçÂàõÂª∫ÊñπÂºè</a></li>
            <li><a href="#522-Âπ∂Ë°åËäÇÁÇπÁöÑÂÜÖÈÉ®ÊâßË°åÊú∫Âà∂">5.2.2 Âπ∂Ë°åËäÇÁÇπÁöÑÂÜÖÈÉ®ÊâßË°åÊú∫Âà∂</a></li>
            <li><a href="#523-Âπ∂Ë°åÊµÅÂºèÂ§ÑÁêÜÁöÑÂêàÂπ∂Êú∫Âà∂">5.2.3 Âπ∂Ë°åÊµÅÂºèÂ§ÑÁêÜÁöÑÂêàÂπ∂Êú∫Âà∂</a></li>
            <li><a href="#524-mergedgeneratorÊ†∏ÂøÉÂÆûÁé∞">5.2.4 MergedGeneratorÊ†∏ÂøÉÂÆûÁé∞</a></li>
            <li><a href="#525-ÊµÅÂºèËæìÂá∫ÈÖçÁΩÆ">5.2.5 ÊµÅÂºèËæìÂá∫ÈÖçÁΩÆ</a></li>
          </ol>
        </li>
        <li><a href="#53-Â≠êÂõæËäÇÁÇπ">5.3 Â≠êÂõæËäÇÁÇπ</a>
          <ol>
            <li><a href="#531-Â≠êÂõæËäÇÁÇπÁ±ªÂûã">5.3.1 Â≠êÂõæËäÇÁÇπÁ±ªÂûã</a></li>
            <li><a href="#532-Â≠êÂõæÂÆö‰πâ‰∏é‰ΩøÁî®">5.3.2 Â≠êÂõæÂÆö‰πâ‰∏é‰ΩøÁî®</a></li>
            <li><a href="#533-Â≠êÂõæÊâßË°åÊµÅÁ®ã">5.3.3 Â≠êÂõæÊâßË°åÊµÅÁ®ã</a></li>
            <li><a href="#534-Â≠êÂõæÁä∂ÊÄÅÁÆ°ÁêÜ">5.3.4 Â≠êÂõæÁä∂ÊÄÅÁÆ°ÁêÜ</a></li>
          </ol>
        </li>
        <li><a href="#54-‰∏≠Êñ≠‰∏éÊÅ¢Â§çÊú∫Âà∂">5.4 ‰∏≠Êñ≠‰∏éÊÅ¢Â§çÊú∫Âà∂</a>
          <ol>
            <li><a href="#541-‰∏≠Êñ≠Êú∫Âà∂ÂéüÁêÜ">5.4.1 ‰∏≠Êñ≠Êú∫Âà∂ÂéüÁêÜ</a></li>
            <li><a href="#542-‰∏≠Êñ≠Êù°‰ª∂ÈÖçÁΩÆ">5.4.2 ‰∏≠Êñ≠Êù°‰ª∂ÈÖçÁΩÆ</a></li>
            <li><a href="#543-Áä∂ÊÄÅÂø´ÁÖßÁÆ°ÁêÜ">5.4.3 Áä∂ÊÄÅÂø´ÁÖßÁÆ°ÁêÜ</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#6-Âø´ÈÄüÂºÄÂßã‰∏éÂÆûÊàòÊåáÂçó">6. Âø´ÈÄüÂºÄÂßã‰∏éÂÆûÊàòÊåáÂçó</a>
      <ol>
        <li><a href="#61-ÁéØÂ¢ÉÂáÜÂ§á">6.1 ÁéØÂ¢ÉÂáÜÂ§á</a>
          <ol>
            <li><a href="#611-‰æùËµñÈÖçÁΩÆ">6.1.1 ‰æùËµñÈÖçÁΩÆ</a></li>
          </ol>
        </li>
        <li><a href="#62-Âø´ÈÄüÂºÄÂßãÊµÅÁ®ã">6.2 Âø´ÈÄüÂºÄÂßãÊµÅÁ®ã</a>
          <ol>
            <li><a href="#621-ÂàõÂª∫Á¨¨‰∏Ä‰∏™Â∑•‰ΩúÊµÅ">6.2.1 ÂàõÂª∫Á¨¨‰∏Ä‰∏™Â∑•‰ΩúÊµÅ</a></li>
            <li><a href="#622-‰ΩøÁî®Â∑•‰ΩúÊµÅ">6.2.2 ‰ΩøÁî®Â∑•‰ΩúÊµÅ</a></li>
          </ol>
        </li>
        <li><a href="#63-ÂÆåÊï¥Á§∫‰æãÈ°πÁõÆ">6.3 ÂÆåÊï¥Á§∫‰æãÈ°πÁõÆ</a></li>
        <li><a href="#64-Á§æÂå∫ÊîØÊåÅ">6.4 Á§æÂå∫ÊîØÊåÅ</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/programing/" >
                Programing
            </a>
        
            <a href="/categories/agent-development/" >
                Agent Development
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/spring-ai-alibaba-graph-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97%E4%B8%8E%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/">Spring AI Alibaba Graph ‰ΩøÁî®ÊåáÂçó‰∏éÊ∫êÁ†ÅËß£ËØª</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            Guide and Code Explanation for SAA Graph
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jul 15, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    36 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="spring-ai-alibaba-graph-‰ΩøÁî®ÊåáÂçó‰∏éÊ∫êÁ†ÅËß£ËØª">Spring AI Alibaba Graph ‰ΩøÁî®ÊåáÂçó‰∏éÊ∫êÁ†ÅËß£ËØª
</h1><blockquote>
<p>Ê∑±ÂÖ•ÁêÜËß£Spring AI Alibaba GraphÁöÑËÆæËÆ°ÊÄùË∑Ø„ÄÅÊ†∏ÂøÉËÉΩÂäõ‰∏éÊúÄ‰Ω≥ÂÆûË∑µ</p></blockquote>
<h2 id="ÁõÆÂΩï">ÁõÆÂΩï
</h2><ul>
<li><a class="link" href="#1-%e5%bc%95%e8%a8%80%e4%b8%8e%e6%a6%82%e8%bf%b0" >1. ÂºïË®Ä‰∏éÊ¶ÇËø∞</a></li>
<li><a class="link" href="#2-%e6%a0%b8%e5%bf%83%e6%9e%b6%e6%9e%84%e4%b8%8e%e8%ae%be%e8%ae%a1%e7%90%86%e5%bf%b5" >2. Ê†∏ÂøÉÊû∂ÊûÑ‰∏éËÆæËÆ°ÁêÜÂøµ</a></li>
<li><a class="link" href="#3-%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5%e6%b7%b1%e5%ba%a6%e8%a7%a3%e6%9e%90" >3. Ê†∏ÂøÉÊ¶ÇÂøµÊ∑±Â∫¶Ëß£Êûê</a></li>
<li><a class="link" href="#4-%e9%a2%84%e5%ae%9a%e4%b9%89%e7%bb%84%e4%bb%b6%e4%b8%8e%e5%b7%a5%e5%85%b7%e7%ae%b1" >4. È¢ÑÂÆö‰πâÁªÑ‰ª∂‰∏éÂ∑•ÂÖ∑ÁÆ±</a></li>
<li><a class="link" href="#5-%e9%ab%98%e7%ba%a7%e7%89%b9%e6%80%a7%e4%b8%8e%e6%89%a9%e5%b1%95%e8%83%bd%e5%8a%9b" >5. È´òÁ∫ßÁâπÊÄß‰∏éÊâ©Â±ïËÉΩÂäõ</a></li>
<li><a class="link" href="#6-%e5%bf%ab%e9%80%9f%e5%bc%80%e5%a7%8b%e4%b8%8e%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97" >6. Âø´ÈÄüÂºÄÂßã‰∏éÂÆûÊàòÊåáÂçó</a></li>
</ul>
<hr>
<h2 id="1-ÂºïË®Ä‰∏éÊ¶ÇËø∞">1. ÂºïË®Ä‰∏éÊ¶ÇËø∞
</h2><h3 id="11-spring-ai-alibaba-graph-Ê¶ÇËø∞">1.1 Spring AI Alibaba Graph Ê¶ÇËø∞
</h3><p>Spring AI Alibaba Graph ÊòØÁ§æÂå∫Ê†∏ÂøÉÂÆûÁé∞‰πã‰∏ÄÔºå‰πüÊòØÊï¥‰∏™Ê°ÜÊû∂Âú®ËÆæËÆ°ÁêÜÂøµ‰∏äÂå∫Âà´‰∫é Spring AI Âè™ÂÅöÂ∫ïÂ±ÇÂéüÂ≠êÊäΩË±°ÁöÑÂú∞ÊñπÔºåSpring AI Alibaba ÊúüÊúõÂ∏ÆÂä©ÂºÄÂèëËÄÖÊõ¥ÂÆπÊòìÁöÑÊûÑÂª∫Êô∫ËÉΩ‰ΩìÂ∫îÁî®„ÄÇÂü∫‰∫é Graph ÂºÄÂèëËÄÖÂèØ‰ª•ÊûÑÂª∫Â∑•‰ΩúÊµÅ„ÄÅÂ§öÊô∫ËÉΩ‰ΩìÂ∫îÁî®„ÄÇ</p>
<p>Spring AI Alibaba Graph Âú®ËÆæËÆ°ÁêÜÂøµ‰∏äÂÄüÈâ¥ LangGraphÔºåÂõ†Ê≠§Âú®‰∏ÄÂÆöÁ®ãÂ∫¶‰∏äÂèØ‰ª•ÁêÜËß£‰∏∫ÊòØ Java ÁâàÁöÑ LangGraph ÂÆûÁé∞ÔºåÁ§æÂå∫Âú®Ê≠§Âü∫Á°Ä‰∏äÂ¢ûÂä†‰∫ÜÂ§ßÈáèÈ¢ÑÁΩÆ Node„ÄÅÁÆÄÂåñ‰∫Ü State ÂÆö‰πâËøáÁ®ãÁ≠âÔºåËÆ©ÂºÄÂèëËÄÖÊõ¥ÂÆπÊòìÁºñÂÜôÂØπÁ≠â‰Ωé‰ª£Á†ÅÂπ≥Âè∞ÁöÑÂ∑•‰ΩúÊµÅ„ÄÅÂ§öÊô∫ËÉΩ‰ΩìÁ≠â„ÄÇ</p>
<h3 id="12-Ê†∏ÂøÉÁâπÊÄß‰∏é‰ºòÂäø">1.2 Ê†∏ÂøÉÁâπÊÄß‰∏é‰ºòÂäø
</h3><p>Áõ∏ÊØî‰º†ÁªüÁöÑAIÂ∫îÁî®ÂºÄÂèëÊñπÂºèÔºåSpring AI Alibaba GraphÂÖ∑Êúâ‰ª•‰∏ãÊ†∏ÂøÉ‰ºòÂäøÔºö</p>
<h4 id="javaÁîüÊÄÅÊ∑±Â∫¶ÈõÜÊàê">JavaÁîüÊÄÅÊ∑±Â∫¶ÈõÜÊàê
</h4><ul>
<li><strong>SpringÂéüÁîüÊîØÊåÅ</strong>ÔºöÂÆåÊï¥ÁöÑ‰æùËµñÊ≥®ÂÖ•„ÄÅÈÖçÁΩÆÁÆ°ÁêÜ„ÄÅÁõëÊéßËßÇÊµã</li>
<li><strong>È´òÂπ∂ÂèëÂ§ÑÁêÜ</strong>ÔºöJavaÂ§©ÁÑ∂ÁöÑÂ§öÁ∫øÁ®ã‰ºòÂäøÔºåÊîØÊåÅÈ´òÂπ∂ÂèëÂú∫ÊôØ</li>
</ul>
<h4 id="‰∏∞ÂØåÁöÑÈ¢ÑÁΩÆÁªÑ‰ª∂">‰∏∞ÂØåÁöÑÈ¢ÑÁΩÆÁªÑ‰ª∂
</h4><ul>
<li><strong>15+ È¢ÑÂÆö‰πâËäÇÁÇπÁ±ªÂûã</strong>ÔºöQuestionClassifierNode„ÄÅLlmNode„ÄÅToolNode„ÄÅKnowledgeRetrievalNodeÁ≠â</li>
<li><strong>Â§öÁßçAgentÊ®°Âºè</strong>ÔºöÂÜÖÁΩÆReact„ÄÅReflection„ÄÅSupervisorÁ≠âÊô∫ËÉΩ‰ΩìÊ®°Âºè</li>
<li><strong>ÁÆÄÂåñÁöÑStateÁÆ°ÁêÜ</strong>ÔºöÁªü‰∏ÄÁöÑÁä∂ÊÄÅÂÆö‰πâÂíåÂêàÂπ∂Á≠ñÁï•</li>
</ul>
<h4 id="Â£∞ÊòéÂºèapiËÆæËÆ°">Â£∞ÊòéÂºèAPIËÆæËÆ°
</h4><ul>
<li><strong>Á±ª‰ººLangGraphÁöÑAPI</strong>ÔºöJavaÂºÄÂèëËÄÖÊõ¥ÂÆπÊòì‰∏äÊâã</li>
<li><strong>ÈìæÂºèË∞ÉÁî®</strong>ÔºöÁÆÄÊ¥ÅÁöÑÊµÅÂºèAPIÔºå‰ª£Á†ÅÊõ¥Âä†‰ºòÈõÖ</li>
<li><strong>Êù°‰ª∂ÂàÜÊîØ</strong>ÔºöÊîØÊåÅÂ§çÊùÇÁöÑÊù°‰ª∂ÈÄªËæëÂíåÂπ∂Ë°åÂ§ÑÁêÜ</li>
</ul>
<h4 id="Áîü‰∫ßÁ∫ßÁâπÊÄß">Áîü‰∫ßÁ∫ßÁâπÊÄß
</h4><ul>
<li><strong>ËßÇÊµãÊÄßÊîØÊåÅ</strong>ÔºöÂÆåÊï¥ÁöÑÊåáÊ†áÊî∂ÈõÜ„ÄÅÈìæË∑ØËøΩË∏™</li>
<li><strong>ÂÆπÈîôÊú∫Âà∂</strong>ÔºöÊîØÊåÅÊ£ÄÊü•ÁÇπ„ÄÅÁä∂ÊÄÅÊÅ¢Â§ç„ÄÅÈîôËØØÂ§ÑÁêÜ</li>
<li><strong>‰∫∫Êú∫Âçè‰Ωú</strong>ÔºöHuman-in-the-loopÊîØÊåÅÔºåÊîØÊåÅ‰øÆÊîπÁä∂ÊÄÅ„ÄÅÊÅ¢Â§çÊâßË°å</li>
</ul>
<h2 id="Âø´ÈÄüÂºÄÂßãÂÆ¢Êà∑ËØÑ‰ª∑ÂàÜÁ±ªÁ≥ªÁªü">Âø´ÈÄüÂºÄÂßãÔºöÂÆ¢Êà∑ËØÑ‰ª∑ÂàÜÁ±ªÁ≥ªÁªü
</h2><p>ËÆ©Êàë‰ª¨ÈÄöËøá‰∏Ä‰∏™ÂÖ∑‰ΩìÁ§∫‰æã‰∫ÜËß£Spring AI Alibaba GraphÁöÑ‰ΩøÁî®ÊñπÂºè„ÄÇËøô‰∏™Á§∫‰æãÂ±ïÁ§∫‰∫ÜÂ¶Ç‰ΩïÊûÑÂª∫‰∏Ä‰∏™ÂÆ¢Êà∑ËØÑ‰ª∑ÂàÜÁ±ªÁ≥ªÁªüÔºö</p>
<h3 id="Á≥ªÁªüÊû∂ÊûÑ">Á≥ªÁªüÊû∂ÊûÑ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">graph TD
</span></span><span class="line"><span class="cl">    A[Áî®Êà∑ËæìÂÖ•] --&gt; B[ËØÑ‰ª∑ÂàÜÁ±ªÂô®]
</span></span><span class="line"><span class="cl">    B --&gt; C{Ê≠£Èù¢/Ë¥üÈù¢?}
</span></span><span class="line"><span class="cl">    C --&gt;|Ê≠£Èù¢| D[ËÆ∞ÂΩïÂ•ΩËØÑ]
</span></span><span class="line"><span class="cl">    C --&gt;|Ë¥üÈù¢| E[ÈóÆÈ¢òÁªÜÂàÜÂô®]
</span></span><span class="line"><span class="cl">    E --&gt; F[ÈóÆÈ¢òÂ§ÑÁêÜÂô®]
</span></span><span class="line"><span class="cl">    D --&gt; G[ÁªìÊùü]
</span></span><span class="line"><span class="cl">    F --&gt; G
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Ê†∏ÂøÉ‰ª£Á†ÅÂÆûÁé∞">Ê†∏ÂøÉ‰ª£Á†ÅÂÆûÁé∞
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CustomerServiceWorkflow</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">StateGraph</span><span class="w"> </span><span class="nf">customerServiceGraph</span><span class="p">(</span><span class="n">ChatModel</span><span class="w"> </span><span class="n">chatModel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ChatClient</span><span class="w"> </span><span class="n">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="n">chatModel</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">defaultAdvisors</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">SimpleLoggerAdvisor</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ËØÑ‰ª∑ÂàÜÁ±ªÂô® - Âå∫ÂàÜÊ≠£Èù¢/Ë¥üÈù¢ËØÑ‰ª∑</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">QuestionClassifierNode</span><span class="w"> </span><span class="n">feedbackClassifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">QuestionClassifierNode</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">chatClient</span><span class="p">(</span><span class="n">chatClient</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">inputTextKey</span><span class="p">(</span><span class="s">&#34;input&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">outputKey</span><span class="p">(</span><span class="s">&#34;classifier_output&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">categories</span><span class="p">(</span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;positive feedback&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;negative feedback&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ÈóÆÈ¢òÁªÜÂàÜÂô® - ÂØπË¥üÈù¢ËØÑ‰ª∑ËøõË°åÁªÜÂàÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">QuestionClassifierNode</span><span class="w"> </span><span class="n">specificQuestionClassifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">QuestionClassifierNode</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">chatClient</span><span class="p">(</span><span class="n">chatClient</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">inputTextKey</span><span class="p">(</span><span class="s">&#34;input&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">outputKey</span><span class="p">(</span><span class="s">&#34;classifier_output&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">categories</span><span class="p">(</span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;after-sale service&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;transportation&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;product quality&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;others&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Áä∂ÊÄÅÂ∑•ÂéÇÂÆö‰πâ - ÁÆÄÂåñÁöÑÁä∂ÊÄÅÁÆ°ÁêÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">KeyStrategyFactory</span><span class="w"> </span><span class="n">stateFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="o">&gt;</span><span class="w"> </span><span class="n">strategies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;input&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;classifier_output&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;solution&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">strategies</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ÊûÑÂª∫Â∑•‰ΩúÊµÅ - Â£∞ÊòéÂºèAPI</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StateGraph</span><span class="p">(</span><span class="s">&#34;ÂÆ¢Êà∑ÊúçÂä°ËØÑ‰ª∑Â§ÑÁêÜ&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">stateFactory</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;feedback_classifier&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">feedbackClassifier</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;specific_question_classifier&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">specificQuestionClassifier</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;recorder&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RecordingNode</span><span class="p">()))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;feedback_classifier&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addConditionalEdges</span><span class="p">(</span><span class="s">&#34;feedback_classifier&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">edge_async</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FeedbackQuestionDispatcher</span><span class="p">()),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;positive&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;recorder&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;negative&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;specific_question_classifier&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;recorder&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">END</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>‰ª•‰∏ä‰ª£Á†ÅÂè™Â±ïÁ§∫‰∫ÜÂõæÁªìÊûÑÔºàStateGraphÔºâÁöÑÊûÑÂª∫ÔºåÂÖ∑‰ΩìÁöÑ‰ª£Á†ÅÂÆûÁé∞ÊÇ®ÂèØ‰ª•ÂÖ≥Ê≥®<strong>spring-ai-alibaba-example</strong>‰ªìÂ∫ìÔºö<a class="link" href="https://github.com/springaialibaba/spring-ai-alibaba-examples/tree/main/spring-ai-alibaba-graph-example"  target="_blank" rel="noopener"
    >spring-ai-alibaba-example</a></p>
<p>Ëøô‰∏™Á§∫‰æãÂ±ïÁ§∫‰∫ÜSpring AI Alibaba GraphÁöÑÊ†∏ÂøÉÁâπÊÄßÔºö</p>
<ul>
<li><strong>È¢ÑÁΩÆÁªÑ‰ª∂</strong>Ôºö‰ΩøÁî®QuestionClassifierNodeÂø´ÈÄüÂÆûÁé∞ÂàÜÁ±ªÂäüËÉΩ</li>
<li><strong>ÁÆÄÂåñÁä∂ÊÄÅÁÆ°ÁêÜ</strong>ÔºöÈÄöËøáKeyStrategyFactoryÁªü‰∏ÄÁÆ°ÁêÜÁä∂ÊÄÅ</li>
<li><strong>Â£∞ÊòéÂºèAPI</strong>ÔºöÈìæÂºèË∞ÉÁî®ÊûÑÂª∫Â§çÊùÇÂ∑•‰ΩúÊµÅ</li>
<li><strong>Spring BootÈõÜÊàê</strong>ÔºöÈÄöËøá@ConfigurationÂíå@BeanÂÆåÊàê‰æùËµñÊ≥®ÂÖ•</li>
</ul>
<h2 id="2-Ê†∏ÂøÉÊû∂ÊûÑ‰∏éËÆæËÆ°ÁêÜÂøµ">2. Ê†∏ÂøÉÊû∂ÊûÑ‰∏éËÆæËÆ°ÁêÜÂøµ
</h2><h3 id="21-Êï¥‰ΩìÊï∞ÊçÆÊµÅËΩ¨Êû∂ÊûÑ">2.1 Êï¥‰ΩìÊï∞ÊçÆÊµÅËΩ¨Êû∂ÊûÑ
</h3><p>Spring AI Alibaba GraphÈááÁî®Â∑•‰ΩúÊµÅÊ®°ÂûãÔºåÊï¥‰∏™Ê°ÜÊû∂ÁöÑÊï∞ÊçÆÊµÅËΩ¨ÈÅµÂæ™**&ldquo;ÊûÑÂª∫‚ÜíÁºñËØë‚ÜíÊâßË°å&rdquo;**ÁöÑ‰∏âÈò∂ÊÆµÊ®°ÂºèÔºö</p>
<h4 id="211-ÂÆåÊï¥Êï∞ÊçÆÊµÅËΩ¨Âõæ">2.1.1 ÂÆåÊï¥Êï∞ÊçÆÊµÅËΩ¨Âõæ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart TD
</span></span><span class="line"><span class="cl">    subgraph &#34;Èò∂ÊÆµ1: ÊûÑÂª∫Èò∂ÊÆµ&#34;
</span></span><span class="line"><span class="cl">        A[ÂºÄÂèëËÄÖÂÆö‰πâStateGraph] --&gt; B[Ê∑ªÂä†ËäÇÁÇπ addNode]
</span></span><span class="line"><span class="cl">        B --&gt; C[Ê∑ªÂä†Ëæπ addEdge/addConditionalEdges]
</span></span><span class="line"><span class="cl">        C --&gt; D[ÂÆö‰πâÁä∂ÊÄÅÁ≠ñÁï• KeyStrategyFactory]
</span></span><span class="line"><span class="cl">        D --&gt; E[ÂõæÁªìÊûÑÈ™åËØÅ validateGraph]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;Èò∂ÊÆµ2: ÁºñËØëÈò∂ÊÆµ&#34;
</span></span><span class="line"><span class="cl">        E --&gt; F[StateGraph.compile]
</span></span><span class="line"><span class="cl">        F --&gt; G[Â§ÑÁêÜÂ≠êÂõæÂ±ïÂºÄ]
</span></span><span class="line"><span class="cl">        G --&gt; H[Ê£ÄÊµãÂπ∂Ë°åËæπÊ®°Âºè]
</span></span><span class="line"><span class="cl">        H --&gt; I[ÂàõÂª∫ParallelNode]
</span></span><span class="line"><span class="cl">        I --&gt; J[ËäÇÁÇπActionÈ¢ÑÂ§ÑÁêÜ]
</span></span><span class="line"><span class="cl">        J --&gt; K[ËæπË∑ØÁî±‰ºòÂåñ]
</span></span><span class="line"><span class="cl">        K --&gt; L[ÁîüÊàêCompiledGraph]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;Èò∂ÊÆµ3: ÊâßË°åÈò∂ÊÆµ&#34;
</span></span><span class="line"><span class="cl">        L --&gt; M{Ë∞ÉÁî®ÊñπÂºè}
</span></span><span class="line"><span class="cl">        M --&gt;|invoke| N[ÂêåÊ≠•ÊâßË°å]
</span></span><span class="line"><span class="cl">        M --&gt;|stream| O[ÊµÅÂºèÊâßË°å]
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        N --&gt; P[ÂàõÂª∫AsyncNodeGenerator]
</span></span><span class="line"><span class="cl">        O --&gt; P
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        P --&gt; Q[Áä∂ÊÄÅÊú∫È©±Âä®ÊâßË°å]
</span></span><span class="line"><span class="cl">        Q --&gt; R[ËäÇÁÇπË∞ÉÂ∫¶‰∏éÊâßË°å]
</span></span><span class="line"><span class="cl">        R --&gt; S[Áä∂ÊÄÅÊõ¥Êñ∞‰∏éÂêàÂπ∂]
</span></span><span class="line"><span class="cl">        S --&gt; T[Ê£ÄÊü•ÁÇπ‰øùÂ≠ò]
</span></span><span class="line"><span class="cl">        T --&gt; U[Êù°‰ª∂Âà§Êñ≠‰∏éË∑ØÁî±]
</span></span><span class="line"><span class="cl">        U --&gt; V{ÊòØÂê¶ÁªìÊùü?}
</span></span><span class="line"><span class="cl">        V --&gt;|Âê¶| R
</span></span><span class="line"><span class="cl">        V --&gt;|ÊòØ| W[ËøîÂõûÊúÄÁªàÁªìÊûú]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;Êï∞ÊçÆËΩΩ‰Ωì&#34;
</span></span><span class="line"><span class="cl">        X[OverAllState&lt;br/&gt;ÂÖ®Â±ÄÁä∂ÊÄÅÁÆ°ÁêÜ]
</span></span><span class="line"><span class="cl">        Y[RunnableConfig&lt;br/&gt;ÊâßË°åÈÖçÁΩÆ]
</span></span><span class="line"><span class="cl">        Z[NodeOutput&lt;br/&gt;ËäÇÁÇπËæìÂá∫]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    R --&gt; X
</span></span><span class="line"><span class="cl">    X --&gt; S
</span></span><span class="line"><span class="cl">    Y --&gt; P
</span></span><span class="line"><span class="cl">    Z --&gt; W
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    style A fill:#e1f5fe
</span></span><span class="line"><span class="cl">    style L fill:#fff3e0
</span></span><span class="line"><span class="cl">    style W fill:#e8f5e8
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="212-Ê†∏ÂøÉÊâßË°åÊµÅÁ®ãËØ¶Ëß£">2.1.2 Ê†∏ÂøÉÊâßË°åÊµÅÁ®ãËØ¶Ëß£
</h4><p><strong>Êï∞ÊçÆÊµÅËΩ¨ÁöÑÊ†∏ÂøÉÁêÜÂøµ</strong>ÔºöÊï¥‰∏™Ê°ÜÊû∂Âõ¥Áªï<strong>OverAllState</strong>Ëøô‰∏™Êï∞ÊçÆËΩΩ‰ΩìËøõË°åÊµÅËΩ¨ÔºåÊØè‰∏™ËäÇÁÇπÈÉΩÊòØÁä∂ÊÄÅÁöÑËΩ¨Êç¢Âô®ÔºåÈÄöËøá<strong>AsyncNodeGenerator</strong>Ëøô‰∏™Áä∂ÊÄÅÊú∫Êù•È©±Âä®Êï¥‰∏™ÊµÅÁ®ãÁöÑÊâßË°å„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sequenceDiagram
</span></span><span class="line"><span class="cl">    participant Dev as ÂºÄÂèëËÄÖ
</span></span><span class="line"><span class="cl">    participant SG as StateGraph
</span></span><span class="line"><span class="cl">    participant CG as CompiledGraph
</span></span><span class="line"><span class="cl">    participant ANG as AsyncNodeGenerator
</span></span><span class="line"><span class="cl">    participant Node as ËäÇÁÇπ
</span></span><span class="line"><span class="cl">    participant State as OverAllState
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    Dev-&gt;&gt;SG: 1. ÊûÑÂª∫ÂõæÁªìÊûÑ
</span></span><span class="line"><span class="cl">    SG-&gt;&gt;SG: 2. È™åËØÅÂõæÂÆåÊï¥ÊÄß
</span></span><span class="line"><span class="cl">    SG-&gt;&gt;CG: 3. ÁºñËØë‰ºòÂåñ
</span></span><span class="line"><span class="cl">    CG-&gt;&gt;CG: 4. Â§ÑÁêÜÂ≠êÂõæÂíåÂπ∂Ë°å
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    Dev-&gt;&gt;CG: 5. invoke/streamË∞ÉÁî®
</span></span><span class="line"><span class="cl">    CG-&gt;&gt;State: 6. ÂàùÂßãÂåñÁä∂ÊÄÅ
</span></span><span class="line"><span class="cl">    CG-&gt;&gt;ANG: 7. ÂàõÂª∫ÊâßË°åÂô®
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    loop ÊâßË°åÂæ™ÁéØ
</span></span><span class="line"><span class="cl">        ANG-&gt;&gt;ANG: 8. Áä∂ÊÄÅÊú∫Êé®Ëøõ
</span></span><span class="line"><span class="cl">        ANG-&gt;&gt;Node: 9. Ë∞ÉÂ∫¶ËäÇÁÇπÊâßË°å
</span></span><span class="line"><span class="cl">        Node-&gt;&gt;Node: 10. ‰∏öÂä°ÈÄªËæëÂ§ÑÁêÜ
</span></span><span class="line"><span class="cl">        Node-&gt;&gt;State: 11. Áä∂ÊÄÅÊõ¥Êñ∞
</span></span><span class="line"><span class="cl">        State-&gt;&gt;ANG: 12. Áä∂ÊÄÅÂêàÂπ∂ÂÆåÊàê
</span></span><span class="line"><span class="cl">        ANG-&gt;&gt;ANG: 13. Ë∑ØÁî±‰∏ã‰∏ÄËäÇÁÇπ
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    ANG-&gt;&gt;CG: 14. ËøîÂõûÊúÄÁªàÁªìÊûú
</span></span><span class="line"><span class="cl">    CG-&gt;&gt;Dev: 15. ÂÆåÊàêÊâßË°å
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="213-ÂÖ≥ÈîÆÊï∞ÊçÆÁªìÊûÑÊµÅËΩ¨">2.1.3 ÂÖ≥ÈîÆÊï∞ÊçÆÁªìÊûÑÊµÅËΩ¨
</h4><p><strong>StateGraph ‚Üí CompiledGraphËΩ¨Êç¢</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">graph LR
</span></span><span class="line"><span class="cl">    subgraph &#34;StateGraph (ÈùôÊÄÅÂÆö‰πâ)&#34;
</span></span><span class="line"><span class="cl">        A[ËäÇÁÇπÂÆö‰πâ&lt;br/&gt;Map&amp;lt;String, Node&amp;gt;]
</span></span><span class="line"><span class="cl">        B[ËæπÂÆö‰πâ&lt;br/&gt;Map&amp;lt;String, Edge&amp;gt;]
</span></span><span class="line"><span class="cl">        C[Áä∂ÊÄÅÁ≠ñÁï•&lt;br/&gt;KeyStrategyFactory]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;ÁºñËØëÂ§ÑÁêÜ&#34;
</span></span><span class="line"><span class="cl">        D[ËäÇÁÇπÈ¢ÑÂ§ÑÁêÜ&lt;br/&gt;ActionFactory.apply]
</span></span><span class="line"><span class="cl">        E[ËæπË∑ØÁî±‰ºòÂåñ&lt;br/&gt;EdgeValueÂ§ÑÁêÜ]
</span></span><span class="line"><span class="cl">        F[Âπ∂Ë°åÊ£ÄÊµã&lt;br/&gt;ParallelNodeÂàõÂª∫]
</span></span><span class="line"><span class="cl">        G[Â≠êÂõæÂ±ïÂºÄ&lt;br/&gt;SubGraphÂ§ÑÁêÜ]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;CompiledGraph (ÂèØÊâßË°å)&#34;
</span></span><span class="line"><span class="cl">        H[ÊâßË°åËäÇÁÇπ&lt;br/&gt;Map&amp;lt;String, AsyncNodeActionWithConfig&amp;gt;]
</span></span><span class="line"><span class="cl">        I[Ë∑ØÁî±Êò†Â∞Ñ&lt;br/&gt;Map&amp;lt;String, EdgeValue&amp;gt;]
</span></span><span class="line"><span class="cl">        J[ÈÖçÁΩÆ‰ø°ÊÅØ&lt;br/&gt;CompileConfig]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    A --&gt; D
</span></span><span class="line"><span class="cl">    B --&gt; E
</span></span><span class="line"><span class="cl">    C --&gt; F
</span></span><span class="line"><span class="cl">    D --&gt; H
</span></span><span class="line"><span class="cl">    E --&gt; I
</span></span><span class="line"><span class="cl">    F --&gt; G
</span></span><span class="line"><span class="cl">    G --&gt; J
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>AsyncNodeGeneratorÊâßË°åÊú∫Âà∂</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">stateDiagram-v2
</span></span><span class="line"><span class="cl">    [*] --&gt; Initialize: ÂàõÂª∫ÊâßË°åÂô®
</span></span><span class="line"><span class="cl">    Initialize --&gt; CheckResume: Ê£ÄÊü•ÊÅ¢Â§çÊ®°Âºè
</span></span><span class="line"><span class="cl">    CheckResume --&gt; LoadSnapshot: ÊÅ¢Â§çÊ®°Âºè
</span></span><span class="line"><span class="cl">    CheckResume --&gt; StartExecution: Ê≠£Â∏∏ÂêØÂä®
</span></span><span class="line"><span class="cl">    LoadSnapshot --&gt; StartExecution: Âä†ËΩΩÂÆåÊàê
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    StartExecution --&gt; ExecuteNode: ÊâßË°åÂΩìÂâçËäÇÁÇπ
</span></span><span class="line"><span class="cl">    ExecuteNode --&gt; UpdateState: Êõ¥Êñ∞Áä∂ÊÄÅ
</span></span><span class="line"><span class="cl">    UpdateState --&gt; SaveCheckpoint: ‰øùÂ≠òÊ£ÄÊü•ÁÇπ
</span></span><span class="line"><span class="cl">    SaveCheckpoint --&gt; RouteNext: Ë∑ØÁî±‰∏ã‰∏ÄËäÇÁÇπ
</span></span><span class="line"><span class="cl">    RouteNext --&gt; CheckEnd: Ê£ÄÊü•ÁªìÊùüÊù°‰ª∂
</span></span><span class="line"><span class="cl">    CheckEnd --&gt; ExecuteNode: ÁªßÁª≠ÊâßË°å
</span></span><span class="line"><span class="cl">    CheckEnd --&gt; [*]: ÊâßË°åÂÆåÊàê
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    ExecuteNode --&gt; CheckInterrupt: Ê£ÄÊü•‰∏≠Êñ≠
</span></span><span class="line"><span class="cl">    CheckInterrupt --&gt; Interrupt: ‰∏≠Êñ≠ÊâßË°å
</span></span><span class="line"><span class="cl">    Interrupt --&gt; [*]: Á≠âÂæÖÊÅ¢Â§ç
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="22-Êï¥‰ΩìÊû∂ÊûÑËÆæËÆ°">2.2 Êï¥‰ΩìÊû∂ÊûÑËÆæËÆ°
</h3><p>Âü∫‰∫é‰∏äËø∞Êï∞ÊçÆÊµÅËΩ¨Êú∫Âà∂ÔºåSpring AI Alibaba GraphÁöÑÊï¥‰ΩìÊû∂ÊûÑËÆæËÆ°ÂÖ∑Êúâ‰ª•‰∏ãÁâπÁÇπÔºö</p>
<ul>
<li><strong>Ê∏ÖÊô∞ÁöÑÊâßË°åÊµÅÁ®ã</strong>ÔºöÊØè‰∏™ËäÇÁÇπ‰ª£Ë°®‰∏Ä‰∏™Â§ÑÁêÜÊ≠•È™§ÔºåËæπË°®Á§∫Êï∞ÊçÆÊµÅÂêë</li>
<li><strong>ÁÅµÊ¥ªÁöÑÊù°‰ª∂ÂàÜÊîØ</strong>ÔºöÊîØÊåÅÊ†πÊçÆÁä∂ÊÄÅÂä®ÊÄÅÈÄâÊã©ÊâßË°åË∑ØÂæÑ</li>
<li><strong>Âπ∂Ë°åÂ§ÑÁêÜËÉΩÂäõ</strong>ÔºöÂ§ö‰∏™ËäÇÁÇπÂèØ‰ª•Âπ∂Ë°åÊâßË°åÔºåÊèêÈ´òÂ§ÑÁêÜÊïàÁéá</li>
<li><strong>Áä∂ÊÄÅÂèØËøΩÊ∫Ø</strong>ÔºöÂÆåÊï¥ÁöÑÁä∂ÊÄÅÂèòÂåñÂéÜÂè≤Ôºå‰æø‰∫éË∞ÉËØïÂíåÁõëÊéß</li>
</ul>
<p><strong>Êû∂ÊûÑÊ†∏ÂøÉÁêÜÂøµ</strong>ÔºöSpring AI Alibaba GraphÂ∞ÜÂ§çÊùÇÁöÑAI‰ªªÂä°ÂàÜËß£‰∏∫ÂèØÁªÑÂêàÁöÑÂéüÂ≠êÊìç‰ΩúÔºåÊØè‰∏™ËäÇÁÇπ‰∏ìÊ≥®‰∫éÂçï‰∏ÄËÅåË¥£ÔºåÈÄöËøáÁä∂ÊÄÅÈ©±Âä®ÁöÑÊñπÂºèÂÆûÁé∞ËäÇÁÇπÈó¥ÁöÑÂçèË∞É„ÄÇËøôÁßçËÆæËÆ°ËÆ©ÂºÄÂèëËÄÖÂèØ‰ª•ÂÉèÊê≠ÁßØÊú®‰∏ÄÊ†∑ÊûÑÂª∫Â§çÊùÇÁöÑAIÂ∫îÁî®ÔºåÊó¢‰øùËØÅ‰∫ÜÁ≥ªÁªüÁöÑÂèØÁª¥Êä§ÊÄßÔºåÂèàÊèê‰æõ‰∫ÜË∂≥Â§üÁöÑÁÅµÊ¥ªÊÄß„ÄÇ</p>
<h4 id="221-Á≥ªÁªüÊû∂ÊûÑÊÄªËßà">2.2.1 Á≥ªÁªüÊû∂ÊûÑÊÄªËßà
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">graph TB
</span></span><span class="line"><span class="cl">    subgraph &#34;Áî®Êà∑Â±Ç&#34;
</span></span><span class="line"><span class="cl">        U1[Spring BootÂ∫îÁî®]
</span></span><span class="line"><span class="cl">        U2[REST Controller]
</span></span><span class="line"><span class="cl">        U3[‰∏öÂä°ÈÄªËæë]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;Spring AI Alibaba GraphÊ†∏ÂøÉ&#34;
</span></span><span class="line"><span class="cl">        SG[StateGraph&lt;br/&gt;Áä∂ÊÄÅÂõæÂÆö‰πâ&lt;br/&gt;Â∑•‰ΩúÊµÅËìùÂõæ]
</span></span><span class="line"><span class="cl">        CG[CompiledGraph&lt;br/&gt;ÁºñËØëÊâßË°åÂô®&lt;br/&gt;ËøêË°åÊó∂ÂºïÊìé]
</span></span><span class="line"><span class="cl">        OS[OverAllState&lt;br/&gt;ÂÖ®Â±ÄÁä∂ÊÄÅ&lt;br/&gt;Êï∞ÊçÆËΩΩ‰Ωì]
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        subgraph &#34;ËäÇÁÇπÂ±Ç&#34;
</span></span><span class="line"><span class="cl">            N1[LlmNode&lt;br/&gt;Â§ßÊ®°ÂûãËäÇÁÇπ]
</span></span><span class="line"><span class="cl">            N2[ToolNode&lt;br/&gt;Â∑•ÂÖ∑ËäÇÁÇπ]
</span></span><span class="line"><span class="cl">            N3[QuestionClassifierNode&lt;br/&gt;ÂàÜÁ±ªËäÇÁÇπ]
</span></span><span class="line"><span class="cl">            N4[CustomNode&lt;br/&gt;Ëá™ÂÆö‰πâËäÇÁÇπ]
</span></span><span class="line"><span class="cl">        end
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        subgraph &#34;AgentÂ±Ç&#34;
</span></span><span class="line"><span class="cl">            A1[ReactAgent&lt;br/&gt;ÂèçÂ∫îÂºèAgent]
</span></span><span class="line"><span class="cl">            A2[ReflectAgent&lt;br/&gt;ÂèçÊÄùAgent]
</span></span><span class="line"><span class="cl">            A3[ReactAgentWithHuman&lt;br/&gt;‰∫∫Êú∫Âçè‰ΩúAgent]
</span></span><span class="line"><span class="cl">        end
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;Âü∫Á°ÄËÆæÊñΩÂ±Ç&#34;
</span></span><span class="line"><span class="cl">        SC[Spring Container&lt;br/&gt;‰æùËµñÊ≥®ÂÖ•]
</span></span><span class="line"><span class="cl">        OB[Observation&lt;br/&gt;ËßÇÊµãÊÄß]
</span></span><span class="line"><span class="cl">        CP[Checkpoint&lt;br/&gt;Ê£ÄÊü•ÁÇπ]
</span></span><span class="line"><span class="cl">        SZ[Serialization&lt;br/&gt;Â∫èÂàóÂåñ]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;Â§ñÈÉ®ÊúçÂä°&#34;
</span></span><span class="line"><span class="cl">        LLM[Â§ßËØ≠Ë®ÄÊ®°Âûã&lt;br/&gt;DashScope/OpenAI]
</span></span><span class="line"><span class="cl">        TOOL[Â§ñÈÉ®Â∑•ÂÖ∑&lt;br/&gt;API/ÂáΩÊï∞]
</span></span><span class="line"><span class="cl">        STORE[Â≠òÂÇ®ÊúçÂä°&lt;br/&gt;Redis/DB]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    U1 --&gt; U2
</span></span><span class="line"><span class="cl">    U2 --&gt; U3
</span></span><span class="line"><span class="cl">    U3 --&gt; SG
</span></span><span class="line"><span class="cl">    SG --&gt; CG
</span></span><span class="line"><span class="cl">    CG --&gt; OS
</span></span><span class="line"><span class="cl">    CG --&gt; N1
</span></span><span class="line"><span class="cl">    CG --&gt; N2
</span></span><span class="line"><span class="cl">    CG --&gt; N3
</span></span><span class="line"><span class="cl">    CG --&gt; N4
</span></span><span class="line"><span class="cl">    A1 --&gt; SG
</span></span><span class="line"><span class="cl">    A2 --&gt; SG
</span></span><span class="line"><span class="cl">    A3 --&gt; SG
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    CG --&gt; SC
</span></span><span class="line"><span class="cl">    CG --&gt; OB
</span></span><span class="line"><span class="cl">    CG --&gt; CP
</span></span><span class="line"><span class="cl">    CG --&gt; SZ
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    N1 --&gt; LLM
</span></span><span class="line"><span class="cl">    N2 --&gt; TOOL
</span></span><span class="line"><span class="cl">    CP --&gt; STORE
</span></span><span class="line"><span class="cl">    SZ --&gt; STORE
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="222-stategraphÊûÑÂª∫ÊµÅÁ®ã">2.2.2 StateGraphÊûÑÂª∫ÊµÅÁ®ã
</h4><p><strong>StateGraphÊòØÂ∑•‰ΩúÊµÅÁöÑËìùÂõæËÆæËÆ°Âô®</strong>ÔºåÂÆÉË¥üË¥£ÂÆö‰πâÊï¥‰∏™Â∑•‰ΩúÊµÅÁöÑÁªìÊûÑÂíåÊâßË°åÈÄªËæëÔºåÂ∞±ÂÉèÂª∫Á≠ëÂ∏àÁªòÂà∂Âª∫Á≠ëÂõæÁ∫∏‰∏ÄÊ†∑„ÄÇÈÄöËøáÂ£∞ÊòéÂºèÁöÑAPIÔºåÂºÄÂèëËÄÖÂèØ‰ª•ËΩªÊùæÂÆö‰πâËäÇÁÇπ„ÄÅËæπÂíåÁä∂ÊÄÅÁÆ°ÁêÜÁ≠ñÁï•ÔºåÊúÄÁªàÁºñËØëÊàêÂèØÊâßË°åÁöÑCompiledGraph„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart TD
</span></span><span class="line"><span class="cl">    A[ÂºÄÂßãÊûÑÂª∫StateGraph] --&gt; B[ÂàõÂª∫StateGraphÂÆû‰æã]
</span></span><span class="line"><span class="cl">    B --&gt; C[ÂÆö‰πâKeyStrategyFactory]
</span></span><span class="line"><span class="cl">    C --&gt; D[Ê∑ªÂä†ËäÇÁÇπ addNode]
</span></span><span class="line"><span class="cl">    D --&gt; E{ÊòØÂê¶ËøòÊúâËäÇÁÇπ?}
</span></span><span class="line"><span class="cl">    E --&gt;|ÊòØ| D
</span></span><span class="line"><span class="cl">    E --&gt;|Âê¶| F[Ê∑ªÂä†Ëæπ addEdge]
</span></span><span class="line"><span class="cl">    F --&gt; G{ÊòØÂê¶ËøòÊúâËæπ?}
</span></span><span class="line"><span class="cl">    G --&gt;|ÊòØ| H[Ê∑ªÂä†Êù°‰ª∂Ëæπ addConditionalEdges]
</span></span><span class="line"><span class="cl">    H --&gt; G
</span></span><span class="line"><span class="cl">    G --&gt;|Âê¶| I[È™åËØÅÂõæÁªìÊûÑ validateGraph]
</span></span><span class="line"><span class="cl">    I --&gt; J{È™åËØÅÈÄöËøá?}
</span></span><span class="line"><span class="cl">    J --&gt;|Âê¶| K[ÊäõÂá∫GraphStateException]
</span></span><span class="line"><span class="cl">    J --&gt;|ÊòØ| L[ÁºñËØëÂõæ compile]
</span></span><span class="line"><span class="cl">    L --&gt; M[ÁîüÊàêCompiledGraph]
</span></span><span class="line"><span class="cl">    M --&gt; N[ÁªìÊùü]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    style A fill:#e1f5fe
</span></span><span class="line"><span class="cl">    style N fill:#e8f5e8
</span></span><span class="line"><span class="cl">    style K fill:#ffebee
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÂÖ≥ÈîÆËÆæËÆ°ÊÄùÊÉ≥</strong>ÔºöStateGraphÈááÁî®‰∫Ü&quot;ÂÖàÂÆö‰πâÂêéÊâßË°å&quot;ÁöÑÊ®°ÂºèÔºåÂ∞ÜÂ∑•‰ΩúÊµÅÁöÑÁªìÊûÑÂÆö‰πâ‰∏éÂÆûÈôÖÊâßË°åÂàÜÁ¶ªÔºåËøôÊ†∑ÂèØ‰ª•Âú®ÁºñËØëÊó∂ËøõË°åÂêÑÁßçÈ™åËØÅÂíå‰ºòÂåñÔºåÁ°Æ‰øùËøêË°åÊó∂ÁöÑÁ®≥ÂÆöÊÄßÂíåÈ´òÊïàÊÄß„ÄÇ</p>
<h4 id="223-compiledgraphÊâßË°åÊµÅÁ®ã">2.2.3 CompiledGraphÊâßË°åÊµÅÁ®ã
</h4><p><strong>CompiledGraphÊòØÂ∑•‰ΩúÊµÅÁöÑËøêË°åÊó∂ÂºïÊìé</strong>ÔºåÂÆÉÂ∞ÜStateGraphÁöÑÈùôÊÄÅÂÆö‰πâËΩ¨Êç¢‰∏∫ÂèØÊâßË°åÁöÑÂä®ÊÄÅÊµÅÁ®ã„ÄÇÂ∞±ÂÉèÂ∞ÜÂª∫Á≠ëÂõæÁ∫∏ÂèòÊàêÁúüÊ≠£ÁöÑÂª∫Á≠ëÁâ©‰∏ÄÊ†∑ÔºåCompiledGraphË¥üË¥£ÂçèË∞ÉÂêÑ‰∏™ÁªÑ‰ª∂ÁöÑÊâßË°åÔºåÁÆ°ÁêÜÁä∂ÊÄÅÊµÅËΩ¨ÔºåÁ°Æ‰øùÊï¥‰∏™Â∑•‰ΩúÊµÅÊåâÁÖßÈ¢ÑÊúüËøêË°å„ÄÇ</p>
<p><strong>AsyncNodeGeneratorÊòØÊï¥‰∏™ÂõæÊµÅËΩ¨ÊâßË°åÁöÑÂîØ‰∏ÄÁä∂ÊÄÅÊú∫</strong>ÔºåÂÆÉÊéßÂà∂ÁùÄÂ∑•‰ΩúÊµÅÁöÑÊØè‰∏ÄÊ≠•ÊâßË°åÔºåÂåÖÊã¨ËäÇÁÇπË∞ÉÂ∫¶„ÄÅÁä∂ÊÄÅÊõ¥Êñ∞„ÄÅÊù°‰ª∂Âà§Êñ≠ÂíåÂºÇÂ∏∏Â§ÑÁêÜ„ÄÇËøôÁßçÂçï‰∏ÄÁä∂ÊÄÅÊú∫ÁöÑËÆæËÆ°Á°Æ‰øù‰∫ÜÊâßË°åÁöÑ‰∏ÄËá¥ÊÄßÂíåÂèØÈ¢ÑÊµãÊÄß„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sequenceDiagram
</span></span><span class="line"><span class="cl">    participant Client as ÂÆ¢Êà∑Á´Ø
</span></span><span class="line"><span class="cl">    participant CG as CompiledGraph
</span></span><span class="line"><span class="cl">    participant ANG as AsyncNodeGenerator
</span></span><span class="line"><span class="cl">    participant Node as ËäÇÁÇπ
</span></span><span class="line"><span class="cl">    participant State as OverAllState
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    Client-&gt;&gt;CG: invoke(inputs)
</span></span><span class="line"><span class="cl">    CG-&gt;&gt;CG: stateCreate(inputs)
</span></span><span class="line"><span class="cl">    CG-&gt;&gt;ANG: new AsyncNodeGenerator(state, config)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    loop ÊâßË°åÂæ™ÁéØ
</span></span><span class="line"><span class="cl">        ANG-&gt;&gt;ANG: next()
</span></span><span class="line"><span class="cl">        ANG-&gt;&gt;ANG: Ê£ÄÊü•ÊúÄÂ§ßËø≠‰ª£Ê¨°Êï∞
</span></span><span class="line"><span class="cl">        ANG-&gt;&gt;ANG: Ê£ÄÊü•‰∏≠Êñ≠Êù°‰ª∂
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        alt Ëµ∑ÂßãËäÇÁÇπ
</span></span><span class="line"><span class="cl">            ANG-&gt;&gt;ANG: Â§ÑÁêÜSTARTËäÇÁÇπ
</span></span><span class="line"><span class="cl">            ANG-&gt;&gt;ANG: Á°ÆÂÆö‰∏ã‰∏Ä‰∏™ËäÇÁÇπ
</span></span><span class="line"><span class="cl">        else ÊôÆÈÄöËäÇÁÇπ
</span></span><span class="line"><span class="cl">            ANG-&gt;&gt;Node: ÊâßË°åËäÇÁÇπÂä®‰Ωú
</span></span><span class="line"><span class="cl">            Node-&gt;&gt;State: Êõ¥Êñ∞Áä∂ÊÄÅ
</span></span><span class="line"><span class="cl">            State--&gt;&gt;ANG: ËøîÂõûÊõ¥Êñ∞ÁªìÊûú
</span></span><span class="line"><span class="cl">            ANG-&gt;&gt;ANG: Á°ÆÂÆö‰∏ã‰∏Ä‰∏™ËäÇÁÇπ
</span></span><span class="line"><span class="cl">        else ÁªìÊùüËäÇÁÇπ
</span></span><span class="line"><span class="cl">            ANG-&gt;&gt;ANG: Â§ÑÁêÜENDËäÇÁÇπ
</span></span><span class="line"><span class="cl">            ANG--&gt;&gt;CG: ËøîÂõûÊúÄÁªàÁªìÊûú
</span></span><span class="line"><span class="cl">        end
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        ANG-&gt;&gt;ANG: Ê∑ªÂä†Ê£ÄÊü•ÁÇπ
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    CG--&gt;&gt;Client: ËøîÂõûÊúÄÁªàÁä∂ÊÄÅ
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ê†∏ÂøÉÊâßË°åÊú∫Âà∂</strong>ÔºöCompiledGraphÈááÁî®‰∫ÜÂü∫‰∫éËø≠‰ª£Âô®Ê®°ÂºèÁöÑÂºÇÊ≠•ÊâßË°åÊú∫Âà∂ÔºåÊØèÊ¨°Ë∞ÉÁî®next()ÊñπÊ≥ïÈÉΩ‰ºöÊé®ËøõÂ∑•‰ΩúÊµÅÁöÑÊâßË°åÔºåËøôÁßçËÆæËÆ°Êó¢ÊîØÊåÅÂêåÊ≠•Ë∞ÉÁî®Ôºå‰πüÊîØÊåÅÊµÅÂºèÂ§ÑÁêÜÔºå‰∏∫‰∏çÂêåÁöÑ‰ΩøÁî®Âú∫ÊôØÊèê‰æõ‰∫ÜÁÅµÊ¥ªÊÄß„ÄÇ</p>
<h3 id="23-Ê†∏ÂøÉÁªÑ‰ª∂ÂÖ≥Á≥ªÂõæ">2.3 Ê†∏ÂøÉÁªÑ‰ª∂ÂÖ≥Á≥ªÂõæ
</h3><p><strong>ÁªÑ‰ª∂ËÅåË¥£ËØ¥Êòé</strong>Ôºö</p>
<ul>
<li><strong>StateGraph</strong>ÔºöÂ∑•‰ΩúÊµÅÁöÑÊû∂ÊûÑÂ∏àÔºåË¥üË¥£ÂÆö‰πâÊï¥‰∏™ÊµÅÁ®ãÁöÑÁªìÊûÑÂíåËßÑÂàô</li>
<li><strong>CompiledGraph</strong>ÔºöÂ∑•‰ΩúÊµÅÁöÑÊåáÊå•ÂÆòÔºåË¥üË¥£ÂçèË∞ÉÂíåÁÆ°ÁêÜÊï¥‰∏™ÊâßË°åËøáÁ®ã</li>
<li><strong>OverAllState</strong>ÔºöÂ∑•‰ΩúÊµÅÁöÑËÆ∞ÂøÜ‰∏≠ÂøÉÔºåË¥üË¥£Â≠òÂÇ®ÂíåÁÆ°ÁêÜÊâÄÊúâÁä∂ÊÄÅÊï∞ÊçÆ</li>
<li><strong>Node</strong>ÔºöÂ∑•‰ΩúÊµÅÁöÑÊâßË°åÂçïÂÖÉÔºåÊØè‰∏™ËäÇÁÇπ‰∏ìÊ≥®‰∫éÁâπÂÆöÁöÑ‰∏öÂä°ÈÄªËæë</li>
<li><strong>Edge</strong>ÔºöÂ∑•‰ΩúÊµÅÁöÑËøûÊé•Âô®ÔºåÂÆö‰πâËäÇÁÇπ‰πãÈó¥ÁöÑËΩ¨Êç¢ÂÖ≥Á≥ªÂíåÊù°‰ª∂</li>
<li><strong>AsyncNodeGenerator</strong>ÔºöÂ∑•‰ΩúÊµÅÁöÑÊâßË°åÂºïÊìéÔºåÊòØÊé®Âä®Êï¥‰∏™ÊµÅÁ®ãËøêËΩ¨ÁöÑÊ†∏ÂøÉÁä∂ÊÄÅÊú∫</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">classDiagram
</span></span><span class="line"><span class="cl">    class StateGraph {
</span></span><span class="line"><span class="cl">        +String name
</span></span><span class="line"><span class="cl">        +Nodes nodes
</span></span><span class="line"><span class="cl">        +Edges edges
</span></span><span class="line"><span class="cl">        +KeyStrategyFactory keyStrategyFactory
</span></span><span class="line"><span class="cl">        +addNode(String id, NodeAction action)
</span></span><span class="line"><span class="cl">        +addEdge(String source, String target)
</span></span><span class="line"><span class="cl">        +addConditionalEdges(String source, EdgeCondition condition, Map mappings)
</span></span><span class="line"><span class="cl">        +compile(CompileConfig config) CompiledGraph
</span></span><span class="line"><span class="cl">        +validateGraph()
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class CompiledGraph {
</span></span><span class="line"><span class="cl">        +StateGraph stateGraph
</span></span><span class="line"><span class="cl">        +CompileConfig compileConfig
</span></span><span class="line"><span class="cl">        +Map~String,AsyncNodeActionWithConfig~ nodes
</span></span><span class="line"><span class="cl">        +Map~String,EdgeValue~ edges
</span></span><span class="line"><span class="cl">        +invoke(Map input) Optional~OverAllState~
</span></span><span class="line"><span class="cl">        +stream(Map input) AsyncGenerator~NodeOutput~
</span></span><span class="line"><span class="cl">        +resume(HumanFeedback feedback) Optional~OverAllState~
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class OverAllState {
</span></span><span class="line"><span class="cl">        +Map~String,Object~ data
</span></span><span class="line"><span class="cl">        +Map~String,KeyStrategy~ keyStrategies
</span></span><span class="line"><span class="cl">        +Boolean resume
</span></span><span class="line"><span class="cl">        +HumanFeedback humanFeedback
</span></span><span class="line"><span class="cl">        +String interruptMessage
</span></span><span class="line"><span class="cl">        +value(String key) Optional~Object~
</span></span><span class="line"><span class="cl">        +updateState(Map updates)
</span></span><span class="line"><span class="cl">        +registerKeyAndStrategy(String key, KeyStrategy strategy)
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class Node {
</span></span><span class="line"><span class="cl">        +String id
</span></span><span class="line"><span class="cl">        +ActionFactory actionFactory
</span></span><span class="line"><span class="cl">        +apply(CompileConfig config) AsyncNodeActionWithConfig
</span></span><span class="line"><span class="cl">        +isParallel() boolean
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class Edge {
</span></span><span class="line"><span class="cl">        +String sourceId
</span></span><span class="line"><span class="cl">        +EdgeValue targetValue
</span></span><span class="line"><span class="cl">        +validate(Nodes nodes)
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class AsyncNodeGenerator {
</span></span><span class="line"><span class="cl">        +Map~String,Object~ currentState
</span></span><span class="line"><span class="cl">        +String currentNodeId
</span></span><span class="line"><span class="cl">        +String nextNodeId
</span></span><span class="line"><span class="cl">        +OverAllState overAllState
</span></span><span class="line"><span class="cl">        +RunnableConfig config
</span></span><span class="line"><span class="cl">        +next() Data~NodeOutput~
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    StateGraph --&gt; CompiledGraph : compile()
</span></span><span class="line"><span class="cl">    StateGraph --&gt; Node : contains
</span></span><span class="line"><span class="cl">    StateGraph --&gt; Edge : contains
</span></span><span class="line"><span class="cl">    CompiledGraph --&gt; OverAllState : manages
</span></span><span class="line"><span class="cl">    CompiledGraph --&gt; AsyncNodeGenerator : creates
</span></span><span class="line"><span class="cl">    Node --&gt; OverAllState : processes
</span></span><span class="line"><span class="cl">    AsyncNodeGenerator --&gt; Node : executes
</span></span><span class="line"><span class="cl">    AsyncNodeGenerator --&gt; OverAllState : updates
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="24-Ê†∏ÂøÉËÆæËÆ°ÁêÜÂøµ">2.4 Ê†∏ÂøÉËÆæËÆ°ÁêÜÂøµ
</h3><h4 id="241-Â£∞ÊòéÂºèÁºñÁ®ãÊ®°Âûã">2.4.1 Â£∞ÊòéÂºèÁºñÁ®ãÊ®°Âûã
</h4><p>ÂÄüÈâ¥LangGraphÁöÑËÆæËÆ°ÁêÜÂøµÔºåSpring AI Alibaba GraphÈááÁî®Â£∞ÊòéÂºèÁºñÁ®ãÊ®°ÂûãÔºåÂºÄÂèëËÄÖÂè™ÈúÄË¶ÅÊèèËø∞&quot;ÂÅö‰ªÄ‰πà&quot;Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Â£∞ÊòéÂºèÂÆö‰πâÂ∑•‰ΩúÊµÅ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">StateGraph</span><span class="w"> </span><span class="n">graph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StateGraph</span><span class="p">(</span><span class="s">&#34;ÂÆ¢Êà∑ÊúçÂä°Â∑•‰ΩúÊµÅ&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">stateFactory</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;feedback_classifier&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">feedbackClassifier</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;specific_question_classifier&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">specificQuestionClassifier</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;recorder&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">recorderNode</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;feedback_classifier&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addConditionalEdges</span><span class="p">(</span><span class="s">&#34;feedback_classifier&#34;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">edge_async</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FeedbackQuestionDispatcher</span><span class="p">()),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;positive&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;recorder&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;negative&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;specific_question_classifier&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;recorder&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">END</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="242-Áä∂ÊÄÅÈ©±Âä®ÁöÑÊâßË°åÊ®°Âûã">2.4.2 Áä∂ÊÄÅÈ©±Âä®ÁöÑÊâßË°åÊ®°Âûã
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart LR
</span></span><span class="line"><span class="cl">    subgraph &#34;Áä∂ÊÄÅÁÆ°ÁêÜÊµÅÁ®ã&#34;
</span></span><span class="line"><span class="cl">        S1[ÂàùÂßãÁä∂ÊÄÅ] --&gt; N1[ËäÇÁÇπ1ÊâßË°å]
</span></span><span class="line"><span class="cl">        N1 --&gt; U1[Áä∂ÊÄÅÊõ¥Êñ∞]
</span></span><span class="line"><span class="cl">        U1 --&gt; S2[Êñ∞Áä∂ÊÄÅ]
</span></span><span class="line"><span class="cl">        S2 --&gt; N2[ËäÇÁÇπ2ÊâßË°å]
</span></span><span class="line"><span class="cl">        N2 --&gt; U2[Áä∂ÊÄÅÊõ¥Êñ∞]
</span></span><span class="line"><span class="cl">        U2 --&gt; S3[ÊúÄÁªàÁä∂ÊÄÅ]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;Áä∂ÊÄÅÁªìÊûÑ&#34;
</span></span><span class="line"><span class="cl">        OS[OverAllState]
</span></span><span class="line"><span class="cl">        OS --&gt; D[data: Map&lt;String,Object&gt;]
</span></span><span class="line"><span class="cl">        OS --&gt; KS[keyStrategies: Map&lt;String,KeyStrategy&gt;]
</span></span><span class="line"><span class="cl">        OS --&gt; R[resume: Boolean]
</span></span><span class="line"><span class="cl">        OS --&gt; HF[humanFeedback: HumanFeedback]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;Áä∂ÊÄÅÁ≠ñÁï•&#34;
</span></span><span class="line"><span class="cl">        RS[ReplaceStrategy&lt;br/&gt;ÊõøÊç¢Á≠ñÁï•]
</span></span><span class="line"><span class="cl">        AS[AppendStrategy&lt;br/&gt;ËøΩÂä†Á≠ñÁï•]
</span></span><span class="line"><span class="cl">        CS[CustomStrategy&lt;br/&gt;Ëá™ÂÆö‰πâÁ≠ñÁï•]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    U1 --&gt; OS
</span></span><span class="line"><span class="cl">    U2 --&gt; OS
</span></span><span class="line"><span class="cl">    KS --&gt; RS
</span></span><span class="line"><span class="cl">    KS --&gt; AS
</span></span><span class="line"><span class="cl">    KS --&gt; CS
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊâÄÊúâÁöÑÊï∞ÊçÆÊµÅËΩ¨ÈÉΩÈÄöËøá<code>OverAllState</code>ËøõË°åÁÆ°ÁêÜÔºåÁ°Æ‰øùÁä∂ÊÄÅÁöÑ‰∏ÄËá¥ÊÄßÂíåÂèØËøΩÊ∫ØÊÄßÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Áä∂ÊÄÅÂ∑•ÂéÇÂÆö‰πâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">KeyStrategyFactory</span><span class="w"> </span><span class="n">stateFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="o">&gt;</span><span class="w"> </span><span class="n">strategies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;input&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;classifier_output&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;solution&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">strategies</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="243-ÂºÇÊ≠•‰ºòÂÖàÁöÑËÆæËÆ°">2.4.3 ÂºÇÊ≠•‰ºòÂÖàÁöÑËÆæËÆ°
</h4><p>Ê°ÜÊû∂‰ºòÂÖàÊîØÊåÅÂºÇÊ≠•Â§ÑÁêÜÔºåÊèêÈ´òÁ≥ªÁªüÁöÑÂêûÂêêÈáèÂíåÂìçÂ∫îÊÄßÔºåÂêåÊó∂ËøòÂéüÁîüÊîØÊåÅ‰∫Ü<strong>ËäÇÁÇπÂÜÖÊ®°ÂûãÊµÅÂºèÈÄè‰º†</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">graph TD
</span></span><span class="line"><span class="cl">    subgraph &#34;ÂºÇÊ≠•ÊâßË°åÊ®°Âûã&#34;
</span></span><span class="line"><span class="cl">        A1[AsyncNodeAction] --&gt; CF1[CompletableFuture]
</span></span><span class="line"><span class="cl">        A2[AsyncNodeActionWithConfig] --&gt; CF2[CompletableFuture]
</span></span><span class="line"><span class="cl">        A3[AsyncCommandAction] --&gt; CF3[CompletableFuture]
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        CF1 --&gt; ANG[AsyncNodeGenerator]
</span></span><span class="line"><span class="cl">        CF2 --&gt; ANG
</span></span><span class="line"><span class="cl">        CF3 --&gt; ANG
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        ANG --&gt; AG[AsyncGenerator]
</span></span><span class="line"><span class="cl">        AG --&gt; Stream[Stream Processing]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;Âπ∂Ë°åÂ§ÑÁêÜ&#34;
</span></span><span class="line"><span class="cl">        PN[ParallelNode] --&gt; PA1[Action1]
</span></span><span class="line"><span class="cl">        PN --&gt; PA2[Action2]
</span></span><span class="line"><span class="cl">        PN --&gt; PA3[Action3]
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        PA1 --&gt; CF4[CompletableFuture]
</span></span><span class="line"><span class="cl">        PA2 --&gt; CF5[CompletableFuture]
</span></span><span class="line"><span class="cl">        PA3 --&gt; CF6[CompletableFuture]
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        CF4 --&gt; ALLOF[CompletableFuture.allOf]
</span></span><span class="line"><span class="cl">        CF5 --&gt; ALLOF
</span></span><span class="line"><span class="cl">        CF6 --&gt; ALLOF
</span></span><span class="line"><span class="cl">    end
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÂºÇÊ≠•ËäÇÁÇπÂÆö‰πâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">AsyncNodeAction</span><span class="w"> </span><span class="n">asyncNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CustomNodeAction</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Âπ∂Ë°åËäÇÁÇπÂ§ÑÁêÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ParallelNode</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">record</span> <span class="nc">AsyncParallelNodeAction</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AsyncNodeActionWithConfig</span><span class="o">&gt;</span><span class="w"> </span><span class="n">actions</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="o">&gt;</span><span class="w"> </span><span class="n">channels</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AsyncNodeActionWithConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">OverAllState</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">RunnableConfig</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">actions</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">action</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">toArray</span><span class="p">(</span><span class="n">CompletableFuture</span><span class="o">[]</span><span class="p">::</span><span class="k">new</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">allOf</span><span class="p">(</span><span class="n">futures</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="c1">// ÂêàÂπ∂ÊâÄÊúâÁªìÊûú</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">futures</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">result</span><span class="p">.</span><span class="na">putAll</span><span class="p">(</span><span class="n">future</span><span class="p">.</span><span class="na">join</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="25-springÁîüÊÄÅÈõÜÊàê">2.5 SpringÁîüÊÄÅÈõÜÊàê
</h3><p>Spring AI Alibaba Graph‰∏éSpringÁîüÊÄÅÊ∑±Â∫¶ÈõÜÊàêÔºåÊÇ®ÂèØ‰ª•ËΩªÊùæÂú®ÊÇ®ÁöÑSpringÂ∫îÁî®‰∏≠ÂºïÂÖ•AIÊ®°ÂûãÂ∑•‰ΩúÊµÅ‰ª•ÂºÄÂèëÊô∫ËÉΩJavaÂ∫îÁî®„ÄÇ</p>
<h4 id="251-‰æùËµñÊ≥®ÂÖ•Êû∂ÊûÑ">2.5.1 ‰æùËµñÊ≥®ÂÖ•Êû∂ÊûÑ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">graph TB
</span></span><span class="line"><span class="cl">    subgraph &#34;Spring BootÂ∫îÁî®Â±Ç&#34;
</span></span><span class="line"><span class="cl">        APP[Spring Boot Application]
</span></span><span class="line"><span class="cl">        CTRL[REST Controller]
</span></span><span class="line"><span class="cl">        SVC[Service Layer]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;GraphÈÖçÁΩÆÂ±Ç&#34;
</span></span><span class="line"><span class="cl">        CONF[GraphConfiguration]
</span></span><span class="line"><span class="cl">        BEAN1[@Bean StateGraph]
</span></span><span class="line"><span class="cl">        BEAN2[@Bean CompiledGraph]
</span></span><span class="line"><span class="cl">        BEAN3[@Bean ChatModel]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;SpringÂÆπÂô®ÁÆ°ÁêÜ&#34;
</span></span><span class="line"><span class="cl">        IOC[IoC Container]
</span></span><span class="line"><span class="cl">        DI[Dependency Injection]
</span></span><span class="line"><span class="cl">        AOP[AOP Support]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;ËßÇÊµãÊÄßÈõÜÊàê&#34;
</span></span><span class="line"><span class="cl">        OBS[ObservationRegistry]
</span></span><span class="line"><span class="cl">        METRICS[Metrics Collection]
</span></span><span class="line"><span class="cl">        TRACING[Distributed Tracing]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    APP --&gt; CTRL
</span></span><span class="line"><span class="cl">    CTRL --&gt; SVC
</span></span><span class="line"><span class="cl">    SVC --&gt; BEAN2
</span></span><span class="line"><span class="cl">    CONF --&gt; BEAN1
</span></span><span class="line"><span class="cl">    CONF --&gt; BEAN2
</span></span><span class="line"><span class="cl">    CONF --&gt; BEAN3
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    IOC --&gt; DI
</span></span><span class="line"><span class="cl">    DI --&gt; CONF
</span></span><span class="line"><span class="cl">    AOP --&gt; OBS
</span></span><span class="line"><span class="cl">    OBS --&gt; METRICS
</span></span><span class="line"><span class="cl">    OBS --&gt; TRACING
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="252-‰æùËµñÊ≥®ÂÖ•ÊîØÊåÅ">2.5.2 ‰æùËµñÊ≥®ÂÖ•ÊîØÊåÅ
</h4><p>‰ª•‰∏ã‰ª£Á†ÅÊºîÁ§∫‰∫ÜSpring AI Alibaba GraphÊòØÂ¶Ç‰ΩïË¢´IOCÂÆπÂô®ÊâÄÁÆ°ÁêÜÁöÑ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GraphConfiguration</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">StateGraph</span><span class="w"> </span><span class="nf">workflowGraph</span><span class="p">(</span><span class="n">ChatModel</span><span class="w"> </span><span class="n">chatModel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ChatClient</span><span class="w"> </span><span class="n">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="n">chatModel</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">defaultAdvisors</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">SimpleLoggerAdvisor</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ÊûÑÂª∫ÂõæÂÆö‰πâ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">stateGraph</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompiledGraph</span><span class="w"> </span><span class="nf">compiledGraph</span><span class="p">(</span><span class="n">StateGraph</span><span class="w"> </span><span class="n">stateGraph</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                                      </span><span class="n">ObservationRegistry</span><span class="w"> </span><span class="n">observationRegistry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">stateGraph</span><span class="p">.</span><span class="na">compile</span><span class="p">(</span><span class="n">CompileConfig</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">withLifecycleListener</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">GraphObservationLifecycleListener</span><span class="p">(</span><span class="n">observationRegistry</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="253-ËßÇÊµãÊÄßÈõÜÊàê">2.5.3 ËßÇÊµãÊÄßÈõÜÊàê
</h4><p>Spring AI Alibaba GraphÂü∫‰∫éMicrometerÂÜÖÁΩÆ‰∫ÜÂèØËßÇÊµãÊîØÊåÅÔºåÂèØ‰ª•Êó†ÁºùÈõÜÊàêSpring BootÂèØËßÇÊµãÊÄß„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GraphController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">GraphController</span><span class="p">(</span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&#34;workflowGraph&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">StateGraph</span><span class="w"> </span><span class="n">stateGraph</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                          </span><span class="n">ObjectProvider</span><span class="o">&lt;</span><span class="n">ObservationRegistry</span><span class="o">&gt;</span><span class="w"> </span><span class="n">observationRegistry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">compiledGraph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stateGraph</span><span class="p">.</span><span class="na">compile</span><span class="p">(</span><span class="n">CompileConfig</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">withLifecycleListener</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">GraphObservationLifecycleListener</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">observationRegistry</span><span class="p">.</span><span class="na">getIfUnique</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ObservationRegistry</span><span class="p">.</span><span class="na">NOOP</span><span class="p">)))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="3-Ê†∏ÂøÉÊ¶ÇÂøµÊ∑±Â∫¶Ëß£Êûê">3. Ê†∏ÂøÉÊ¶ÇÂøµÊ∑±Â∫¶Ëß£Êûê
</h2><h3 id="31-stategraph-Áä∂ÊÄÅÂõæ">3.1 StateGraph (Áä∂ÊÄÅÂõæ)
</h3><p><strong>StateGraphÊòØÊï¥‰∏™Ê°ÜÊû∂ÁöÑËÆæËÆ°ËìùÂõæ</strong>ÔºåÂÆÉÂ∞±ÂÉèÂª∫Á≠ëÂ∏àÁöÑËÆæËÆ°ÂõæÁ∫∏‰∏ÄÊ†∑ÔºåÂÆö‰πâ‰∫ÜÂ∑•‰ΩúÊµÅÁöÑÂÆåÊï¥ÁªìÊûÑÂíåÊâßË°åÈÄªËæë„ÄÇStateGraphÈááÁî®Â£∞ÊòéÂºèAPIÔºåËÆ©ÂºÄÂèëËÄÖÂèØ‰ª•Áî®ÁÆÄÊ¥ÅÁöÑ‰ª£Á†ÅÊèèËø∞Â§çÊùÇÁöÑ‰∏öÂä°ÊµÅÁ®ãÔºåËÄå‰∏çÈúÄË¶ÅÂÖ≥ÂøÉÂ∫ïÂ±ÇÁöÑÊâßË°åÁªÜËäÇ„ÄÇ</p>
<p><strong>Ê†∏ÂøÉËÆæËÆ°ÁêÜÂøµ</strong>ÔºöStateGraphÂ∞ÜÂ§çÊùÇÁöÑÂ∑•‰ΩúÊµÅÊäΩË±°‰∏∫ËäÇÁÇπÂíåËæπÁöÑÁªÑÂêàÔºåÊØè‰∏™ËäÇÁÇπ‰ª£Ë°®‰∏Ä‰∏™ÂÖ∑‰ΩìÁöÑÊìç‰ΩúÔºåËæπÂÆö‰πâ‰∫ÜÊìç‰Ωú‰πãÈó¥ÁöÑÊµÅËΩ¨ÂÖ≥Á≥ª„ÄÇËøôÁßçÊäΩË±°ËÆ©ÂºÄÂèëËÄÖÂèØ‰ª•‰∏ìÊ≥®‰∫é‰∏öÂä°ÈÄªËæëÁöÑËÆæËÆ°ÔºåËÄå‰∏çÊòØÊâßË°åÊú∫Âà∂ÁöÑÂÆûÁé∞„ÄÇ</p>
<h4 id="311-stategraphÁîüÂëΩÂë®Êúü">3.1.1 StateGraphÁîüÂëΩÂë®Êúü
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">stateDiagram-v2
</span></span><span class="line"><span class="cl">    [*] --&gt; Created: new StateGraph()
</span></span><span class="line"><span class="cl">    Created --&gt; Building: Ê∑ªÂä†ËäÇÁÇπÂíåËæπ
</span></span><span class="line"><span class="cl">    Building --&gt; Building: addNode() / addEdge()
</span></span><span class="line"><span class="cl">    Building --&gt; Validating: validateGraph()
</span></span><span class="line"><span class="cl">    Validating --&gt; Invalid: È™åËØÅÂ§±Ë¥•
</span></span><span class="line"><span class="cl">    Invalid --&gt; [*]: ÊäõÂá∫ÂºÇÂ∏∏
</span></span><span class="line"><span class="cl">    Validating --&gt; Valid: È™åËØÅÈÄöËøá
</span></span><span class="line"><span class="cl">    Valid --&gt; Compiled: compile()
</span></span><span class="line"><span class="cl">    Compiled --&gt; Executing: invoke() / stream()
</span></span><span class="line"><span class="cl">    Executing --&gt; Completed: ÊâßË°åÂÆåÊàê
</span></span><span class="line"><span class="cl">    Completed --&gt; [*]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="312-Âü∫Êú¨ÊûÑÈÄ†">3.1.2 Âü∫Êú¨ÊûÑÈÄ†
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StateGraph</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ê†∏ÂøÉÊï∞ÊçÆÁªìÊûÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">Nodes</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Nodes</span><span class="p">();</span><span class="w">  </span><span class="c1">// Â≠òÂÇ®ÊâÄÊúâËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">Edges</span><span class="w"> </span><span class="n">edges</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Edges</span><span class="p">();</span><span class="w">  </span><span class="c1">// Â≠òÂÇ®ÊâÄÊúâËæπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÁâπÊÆäËäÇÁÇπÂ∏∏Èáè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;__END__&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">START</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;__START__&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">ERROR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;__ERROR__&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Áä∂ÊÄÅÁÆ°ÁêÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">KeyStrategyFactory</span><span class="w"> </span><span class="n">keyStrategyFactory</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PlainTextStateSerializer</span><span class="w"> </span><span class="n">stateSerializer</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="313-ËäÇÁÇπÁÆ°ÁêÜÊµÅÁ®ã">3.1.3 ËäÇÁÇπÁÆ°ÁêÜÊµÅÁ®ã
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart TD
</span></span><span class="line"><span class="cl">    A[addNodeË∞ÉÁî®] --&gt; B{Ê£ÄÊü•ËäÇÁÇπID}
</span></span><span class="line"><span class="cl">    B --&gt;|ID‰∏∫END| C[ÊäõÂá∫ÂºÇÂ∏∏]
</span></span><span class="line"><span class="cl">    B --&gt;|IDÂêàÊ≥ï| D{Ê£ÄÊü•ÊòØÂê¶ÈáçÂ§ç}
</span></span><span class="line"><span class="cl">    D --&gt;|ÈáçÂ§ç| E[ÊäõÂá∫ÈáçÂ§çËäÇÁÇπÂºÇÂ∏∏]
</span></span><span class="line"><span class="cl">    D --&gt;|‰∏çÈáçÂ§ç| F[ÂàõÂª∫NodeÂØπË±°]
</span></span><span class="line"><span class="cl">    F --&gt; G[Ê∑ªÂä†Âà∞nodesÈõÜÂêà]
</span></span><span class="line"><span class="cl">    G --&gt; H[ËøîÂõûStateGraphÂÆû‰æã]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;ËäÇÁÇπÁ±ªÂûã&#34;
</span></span><span class="line"><span class="cl">        I[ÊôÆÈÄöËäÇÁÇπ&lt;br/&gt;AsyncNodeAction]
</span></span><span class="line"><span class="cl">        J[Â∏¶ÈÖçÁΩÆËäÇÁÇπ&lt;br/&gt;AsyncNodeActionWithConfig]
</span></span><span class="line"><span class="cl">        K[Â≠êÂõæËäÇÁÇπ&lt;br/&gt;StateGraph]
</span></span><span class="line"><span class="cl">        L[ÂëΩ‰ª§ËäÇÁÇπ&lt;br/&gt;AsyncCommandAction]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    F --&gt; I
</span></span><span class="line"><span class="cl">    F --&gt; J
</span></span><span class="line"><span class="cl">    F --&gt; K
</span></span><span class="line"><span class="cl">    F --&gt; L
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊîØÊåÅÁöÑËäÇÁÇπÊ∑ªÂä†ÊñπÂºèÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Ê∑ªÂä†ÊôÆÈÄöËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">StateGraph</span><span class="w"> </span><span class="nf">addNode</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">AsyncNodeAction</span><span class="w"> </span><span class="n">action</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">AsyncNodeActionWithConfig</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">action</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">addNode</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Ê∑ªÂä†Â∏¶ÈÖçÁΩÆÁöÑËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">StateGraph</span><span class="w"> </span><span class="nf">addNode</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">AsyncNodeActionWithConfig</span><span class="w"> </span><span class="n">actionWithConfig</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Node</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">actionWithConfig</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">addNode</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Ê∑ªÂä†Â≠êÂõæËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">StateGraph</span><span class="w"> </span><span class="nf">addNode</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">StateGraph</span><span class="w"> </span><span class="n">subGraph</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">subGraph</span><span class="p">.</span><span class="na">validateGraph</span><span class="p">();</span><span class="w"> </span><span class="c1">// ÂÖàÈ™åËØÅÂ≠êÂõæ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SubStateGraphNode</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">subGraph</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">addNode</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="314-ËæπÁÆ°ÁêÜÊµÅÁ®ã">3.1.4 ËæπÁÆ°ÁêÜÊµÅÁ®ã
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart TD
</span></span><span class="line"><span class="cl">    A[&#34;addEdgeË∞ÉÁî®&#34;] --&gt; B{&#34;ËæπÁ±ªÂûã&#34;}
</span></span><span class="line"><span class="cl">    B --&gt;|ÈùôÊÄÅËæπ| C[&#34;addEdge(source, target)&#34;]
</span></span><span class="line"><span class="cl">    B --&gt;|Êù°‰ª∂Ëæπ| D[&#34;addConditionalEdges(source, condition, mappings)&#34;]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    C --&gt; E{&#34;Ê£ÄÊü•Ê∫êËäÇÁÇπ&#34;}
</span></span><span class="line"><span class="cl">    E --&gt;|Ê∫êËäÇÁÇπ‰∏∫END| F[&#34;ÊäõÂá∫ÂºÇÂ∏∏&#34;]
</span></span><span class="line"><span class="cl">    E --&gt;|Ê∫êËäÇÁÇπÂêàÊ≥ï| G[&#34;ÂàõÂª∫EdgeÂØπË±°&#34;]
</span></span><span class="line"><span class="cl">    G --&gt; H[&#34;Ê∑ªÂä†Âà∞edgesÈõÜÂêà&#34;]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    D --&gt; I{&#34;Ê£ÄÊü•Êò†Â∞Ñ&#34;}
</span></span><span class="line"><span class="cl">    I --&gt;|Êò†Â∞Ñ‰∏∫Á©∫| J[&#34;ÊäõÂá∫ÂºÇÂ∏∏&#34;]
</span></span><span class="line"><span class="cl">    I --&gt;|Êò†Â∞ÑÊúâÊïà| K[&#34;ÂàõÂª∫Êù°‰ª∂Ëæπ&#34;]
</span></span><span class="line"><span class="cl">    K --&gt; L{&#34;Ê£ÄÊü•ÊòØÂê¶ÈáçÂ§ç&#34;}
</span></span><span class="line"><span class="cl">    L --&gt;|ÈáçÂ§ç| M[&#34;ÊäõÂá∫ÈáçÂ§çËæπÂºÇÂ∏∏&#34;]
</span></span><span class="line"><span class="cl">    L --&gt;|‰∏çÈáçÂ§ç| N[&#34;Ê∑ªÂä†Âà∞edgesÈõÜÂêà&#34;]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    H --&gt; O[&#34;ËøîÂõûStateGraph&#34;]
</span></span><span class="line"><span class="cl">    N --&gt; O
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="315-ÂõæÈ™åËØÅÊú∫Âà∂">3.1.5 ÂõæÈ™åËØÅÊú∫Âà∂
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart TD
</span></span><span class="line"><span class="cl">    A[validateGraphÂºÄÂßã] --&gt; B[Ê£ÄÊü•ÂÖ•Âè£ÁÇπ]
</span></span><span class="line"><span class="cl">    B --&gt; C{STARTËæπÊòØÂê¶Â≠òÂú®?}
</span></span><span class="line"><span class="cl">    C --&gt;|Âê¶| D[ÊäõÂá∫Áº∫Â∞ëÂÖ•Âè£ÁÇπÂºÇÂ∏∏]
</span></span><span class="line"><span class="cl">    C --&gt;|ÊòØ| E[È™åËØÅSTARTËæπ]
</span></span><span class="line"><span class="cl">    E --&gt; F[È™åËØÅÊâÄÊúâËäÇÁÇπ]
</span></span><span class="line"><span class="cl">    F --&gt; G[È™åËØÅÊâÄÊúâËæπ]
</span></span><span class="line"><span class="cl">    G --&gt; H{ÊâÄÊúâÈ™åËØÅÈÄöËøá?}
</span></span><span class="line"><span class="cl">    H --&gt;|Âê¶| I[ÊäõÂá∫GraphStateException]
</span></span><span class="line"><span class="cl">    H --&gt;|ÊòØ| J[È™åËØÅÊàêÂäü]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;ËæπÈ™åËØÅÈÄªËæë&#34;
</span></span><span class="line"><span class="cl">        K[Ê£ÄÊü•Ê∫êËäÇÁÇπÂ≠òÂú®ÊÄß]
</span></span><span class="line"><span class="cl">        L[Ê£ÄÊü•ÁõÆÊ†áËäÇÁÇπÂ≠òÂú®ÊÄß]
</span></span><span class="line"><span class="cl">        M[Ê£ÄÊü•Êù°‰ª∂ËæπÊò†Â∞Ñ]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    G --&gt; K
</span></span><span class="line"><span class="cl">    G --&gt; L
</span></span><span class="line"><span class="cl">    G --&gt; M
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="32-overallstate-ÂÖ®Â±ÄÁä∂ÊÄÅ">3.2 OverAllState (ÂÖ®Â±ÄÁä∂ÊÄÅ)
</h3><p><strong>OverAllStateÊòØÂ∑•‰ΩúÊµÅÁöÑÊï∞ÊçÆ‰∏≠Êû¢</strong>ÔºåÂÆÉÂ∞±ÂÉèÂ∑•‰ΩúÊµÅÁöÑËÆ∞ÂøÜÁ≥ªÁªü‰∏ÄÊ†∑ÔºåË¥üË¥£Âú®ÂêÑ‰∏™ËäÇÁÇπ‰πãÈó¥‰º†ÈÄíÂíåÁÆ°ÁêÜÁä∂ÊÄÅÊï∞ÊçÆ„ÄÇOverAllState‰∏ç‰ªÖÂ≠òÂÇ®Êï∞ÊçÆÔºåËøòÂÆö‰πâ‰∫ÜÊï∞ÊçÆÁöÑÂêàÂπ∂Á≠ñÁï•ÔºåÁ°Æ‰øù‰∏çÂêåËäÇÁÇπ‰∫ßÁîüÁöÑÊï∞ÊçÆËÉΩÂ§üÊ≠£Á°ÆÂú∞Êï¥ÂêàÂú®‰∏ÄËµ∑„ÄÇ</p>
<p><strong>ËÆæËÆ°Â∑ßÊÄù</strong>ÔºöOverAllStateÈááÁî®‰∫ÜÁ≠ñÁï•Ê®°ÂºèÊù•Â§ÑÁêÜÁä∂ÊÄÅÊõ¥Êñ∞Ôºå‰∏çÂêåÁöÑÊï∞ÊçÆÁ±ªÂûãÂèØ‰ª•ÈááÁî®‰∏çÂêåÁöÑÂêàÂπ∂Á≠ñÁï•ÔºàÂ¶ÇÊõøÊç¢„ÄÅËøΩÂä†„ÄÅÂêàÂπ∂Á≠âÔºâÔºåËøôÁßçËÆæËÆ°ËÆ©Áä∂ÊÄÅÁÆ°ÁêÜÂèòÂæóÈùûÂ∏∏ÁÅµÊ¥ªÔºåËÉΩÂ§üÈÄÇÂ∫îÂêÑÁßçÂ§çÊùÇÁöÑ‰∏öÂä°Âú∫ÊôØ„ÄÇ</p>
<h4 id="321-Áä∂ÊÄÅÁÆ°ÁêÜÊû∂ÊûÑ">3.2.1 Áä∂ÊÄÅÁÆ°ÁêÜÊû∂ÊûÑ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">classDiagram
</span></span><span class="line"><span class="cl">    class OverAllState {
</span></span><span class="line"><span class="cl">        -Map~String,Object~ data
</span></span><span class="line"><span class="cl">        -Map~String,KeyStrategy~ keyStrategies
</span></span><span class="line"><span class="cl">        -Boolean resume
</span></span><span class="line"><span class="cl">        -HumanFeedback humanFeedback
</span></span><span class="line"><span class="cl">        -String interruptMessage
</span></span><span class="line"><span class="cl">        +value(String key) Optional~Object~
</span></span><span class="line"><span class="cl">        +updateState(Map updates)
</span></span><span class="line"><span class="cl">        +registerKeyAndStrategy(String key, KeyStrategy strategy)
</span></span><span class="line"><span class="cl">        +snapShot() Optional~OverAllState~
</span></span><span class="line"><span class="cl">        +withResume()
</span></span><span class="line"><span class="cl">        +withHumanFeedback(HumanFeedback feedback)
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class KeyStrategy {
</span></span><span class="line"><span class="cl">        &lt;&lt;interface&gt;&gt;
</span></span><span class="line"><span class="cl">        +apply(Object oldValue, Object newValue) Object
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class ReplaceStrategy {
</span></span><span class="line"><span class="cl">        +apply(Object oldValue, Object newValue) Object
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class AppendStrategy {
</span></span><span class="line"><span class="cl">        +apply(Object oldValue, Object newValue) Object
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class HumanFeedback {
</span></span><span class="line"><span class="cl">        +boolean approved
</span></span><span class="line"><span class="cl">        +String feedback
</span></span><span class="line"><span class="cl">        +Map~String,Object~ additionalData
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    OverAllState --&gt; KeyStrategy
</span></span><span class="line"><span class="cl">    OverAllState --&gt; HumanFeedback
</span></span><span class="line"><span class="cl">    KeyStrategy &lt;|-- ReplaceStrategy
</span></span><span class="line"><span class="cl">    KeyStrategy &lt;|-- AppendStrategy
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="322-Áä∂ÊÄÅÊõ¥Êñ∞ÊµÅÁ®ã">3.2.2 Áä∂ÊÄÅÊõ¥Êñ∞ÊµÅÁ®ã
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sequenceDiagram
</span></span><span class="line"><span class="cl">    participant Node as ËäÇÁÇπ
</span></span><span class="line"><span class="cl">    participant State as OverAllState
</span></span><span class="line"><span class="cl">    participant Strategy as KeyStrategy
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    Node-&gt;&gt;State: ËøîÂõûÊõ¥Êñ∞Map
</span></span><span class="line"><span class="cl">    State-&gt;&gt;State: updateState(updates)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    loop ÈÅçÂéÜÊØè‰∏™Êõ¥Êñ∞È°π
</span></span><span class="line"><span class="cl">        State-&gt;&gt;State: Ëé∑ÂèñkeyÂØπÂ∫îÁöÑÁ≠ñÁï•
</span></span><span class="line"><span class="cl">        State-&gt;&gt;Strategy: apply(oldValue, newValue)
</span></span><span class="line"><span class="cl">        Strategy--&gt;&gt;State: ËøîÂõûÂêàÂπ∂ÂêéÁöÑÂÄº
</span></span><span class="line"><span class="cl">        State-&gt;&gt;State: Êõ¥Êñ∞data‰∏≠ÁöÑÂÄº
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    State--&gt;&gt;Node: Áä∂ÊÄÅÊõ¥Êñ∞ÂÆåÊàê
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="323-Áä∂ÊÄÅÁ≠ñÁï•ËØ¶Ëß£">3.2.3 Áä∂ÊÄÅÁ≠ñÁï•ËØ¶Ëß£
</h4><p><strong>Á≠ñÁï•Ê®°ÂºèÊû∂ÊûÑ</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">classDiagram
</span></span><span class="line"><span class="cl">    class KeyStrategy {
</span></span><span class="line"><span class="cl">        &lt;&lt;interface&gt;&gt;
</span></span><span class="line"><span class="cl">        +apply(Object oldValue, Object newValue) Object
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class ReplaceStrategy {
</span></span><span class="line"><span class="cl">        +apply(Object oldValue, Object newValue) Object
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class AppendStrategy {
</span></span><span class="line"><span class="cl">        +apply(Object oldValue, Object newValue) Object
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    KeyStrategy &lt;|-- ReplaceStrategy
</span></span><span class="line"><span class="cl">    KeyStrategy &lt;|-- AppendStrategy
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÂÜÖÁΩÆÁ≠ñÁï•ÂÆûÁé∞</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÊõøÊç¢Á≠ñÁï• - Êñ∞ÂÄºË¶ÜÁõñÊóßÂÄº</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ReplaceStrategy</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">oldValue</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">newValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">newValue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ËøΩÂä†Á≠ñÁï• - Êñ∞ÂÄºËøΩÂä†Âà∞ÂàóË°®ÔºåÊîØÊåÅÂ§çÊùÇÁöÑÂàóË°®Êìç‰Ωú</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppendStrategy</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">oldValue</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">newValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">newValue</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">oldValue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Â§ÑÁêÜOptionalÁ±ªÂûã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">oldValue</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">oldValueOptional</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">oldValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oldValueOptional</span><span class="p">.</span><span class="na">orElse</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">oldValueIsList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oldValue</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;?&gt;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Â§ÑÁêÜÁßªÈô§Êìç‰Ωú</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">oldValueIsList</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">newValue</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">AppenderChannel</span><span class="p">.</span><span class="na">RemoveIdentifier</span><span class="o">&lt;?&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">((</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">oldValue</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">removeFromList</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">AppenderChannel</span><span class="p">.</span><span class="na">RemoveIdentifier</span><span class="p">)</span><span class="w"> </span><span class="n">newValue</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">unmodifiableList</span><span class="p">(</span><span class="n">result</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Â§ÑÁêÜÊñ∞ÂÄº‰∏∫ÈõÜÂêàÁöÑÊÉÖÂÜµ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">newValue</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">List</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">((</span><span class="n">List</span><span class="o">&lt;?&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">newValue</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">newValue</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">isArray</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">((</span><span class="n">Object</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="n">newValue</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">newValue</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Collection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">((</span><span class="n">Collection</span><span class="o">&lt;?&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">newValue</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ÂêàÂπ∂ÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">oldValueIsList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">oldList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">oldValue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">list</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">list</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">oldValue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// ÂêàÂπ∂Âπ∂ÂéªÈáç</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateRemoval</span><span class="p">(</span><span class="n">oldList</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">concat</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">oldValues</span><span class="p">().</span><span class="na">stream</span><span class="p">(),</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">newValues</span><span class="p">().</span><span class="na">stream</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">.</span><span class="na">distinct</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">oldList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">newValue</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">oldList</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">arrayResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">list</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">arrayResult</span><span class="p">.</span><span class="na">addAll</span><span class="p">(</span><span class="n">list</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">arrayResult</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">newValue</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">arrayResult</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ëá™ÂÆö‰πâÁ≠ñÁï•Á§∫‰æã</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Ëá™ÂÆö‰πâMapÂêàÂπ∂Á≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MapMergeStrategy</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">oldValue</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">newValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">oldValue</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Map</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">newValue</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Map</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">merged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">((</span><span class="n">Map</span><span class="p">)</span><span class="w"> </span><span class="n">oldValue</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">merged</span><span class="p">.</span><span class="na">putAll</span><span class="p">((</span><span class="n">Map</span><span class="p">)</span><span class="w"> </span><span class="n">newValue</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">merged</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">newValue</span><span class="p">;</span><span class="w"> </span><span class="c1">// ÈªòËÆ§ÊõøÊç¢</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Ëá™ÂÆö‰πâÂ≠óÁ¨¶‰∏≤ËøûÊé•Á≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StringConcatStrategy</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">separator</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">StringConcatStrategy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">separator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">separator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">separator</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">oldValue</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">newValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">oldValue</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">newValue</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">oldValue</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">separator</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">newValue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">newValue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Á≠ñÁï•Â∑•ÂéÇÊ®°Âºè</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StrategyFactory</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">KeyStrategyFactory</span><span class="w"> </span><span class="nf">createDefaultFactory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="o">&gt;</span><span class="w"> </span><span class="n">strategies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;messages&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AppendStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;input&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;output&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">strategies</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">KeyStrategyFactory</span><span class="w"> </span><span class="nf">createCustomFactory</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="o">&gt;</span><span class="w"> </span><span class="n">customStrategies</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="o">&gt;</span><span class="w"> </span><span class="n">strategies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Ê∑ªÂä†ÈªòËÆ§Á≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;messages&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AppendStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;input&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Ë¶ÜÁõñËá™ÂÆö‰πâÁ≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">putAll</span><span class="p">(</span><span class="n">customStrategies</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">strategies</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="33-node-ËäÇÁÇπ">3.3 Node (ËäÇÁÇπ)
</h3><p><strong>NodeÊòØÂ∑•‰ΩúÊµÅÁöÑÂäüËÉΩÊ®°Âùó</strong>ÔºåÊØè‰∏™ËäÇÁÇπÂ∞±ÂÉè‰∏Ä‰∏™‰∏ìÈó®ÁöÑÂ∑•‰ΩúÁ´ôÔºåË¥üË¥£ÊâßË°åÁâπÂÆöÁöÑ‰∏öÂä°ÈÄªËæë„ÄÇNodeÁöÑËÆæËÆ°ÈÅµÂæ™Âçï‰∏ÄËÅåË¥£ÂéüÂàôÔºåÊØè‰∏™ËäÇÁÇπÂè™ÂÖ≥Ê≥®‰∏Ä‰ª∂‰∫ãÊÉÖÔºåËøôÊ†∑Êó¢‰øùËØÅ‰∫Ü‰ª£Á†ÅÁöÑÂèØÁª¥Êä§ÊÄßÔºå‰πüÊèêÈ´ò‰∫ÜËäÇÁÇπÁöÑÂèØÂ§çÁî®ÊÄß„ÄÇ</p>
<p><strong>ÊâßË°åÁâπÊÄß</strong>ÔºöNodeÊîØÊåÅÂêåÊ≠•ÂíåÂºÇÊ≠•‰∏§ÁßçÊâßË°åÊ®°ÂºèÔºåËøòÊîØÊåÅÂπ∂Ë°åÊâßË°åÂ§ö‰∏™Â≠ê‰ªªÂä°„ÄÇËøôÁßçÁÅµÊ¥ªÁöÑÊâßË°åÊú∫Âà∂ËÆ©NodeÊó¢ËÉΩÂ§ÑÁêÜÁÆÄÂçïÁöÑÊï∞ÊçÆËΩ¨Êç¢Ôºå‰πüËÉΩÂ§ÑÁêÜÂ§çÊùÇÁöÑÂ§ñÈÉ®ÊúçÂä°Ë∞ÉÁî®ÔºåÊª°Ë∂≥ÂêÑÁßçÊÄßËÉΩË¶ÅÊ±Ç„ÄÇ</p>
<h4 id="331-ËäÇÁÇπÊâßË°åÊµÅÁ®ã">3.3.1 ËäÇÁÇπÊâßË°åÊµÅÁ®ã
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart TD
</span></span><span class="line"><span class="cl">    A[ËäÇÁÇπÂºÄÂßãÊâßË°å] --&gt; B[Ëé∑ÂèñActionFactory]
</span></span><span class="line"><span class="cl">    B --&gt; C[Â∫îÁî®CompileConfig]
</span></span><span class="line"><span class="cl">    C --&gt; D[ÂàõÂª∫AsyncNodeActionWithConfig]
</span></span><span class="line"><span class="cl">    D --&gt; E[Ë∞ÉÁî®applyÊñπÊ≥ï]
</span></span><span class="line"><span class="cl">    E --&gt; F[‰º†ÂÖ•OverAllStateÂíåRunnableConfig]
</span></span><span class="line"><span class="cl">    F --&gt; G[ÊâßË°å‰∏öÂä°ÈÄªËæë]
</span></span><span class="line"><span class="cl">    G --&gt; H[ËøîÂõûCompletableFuture]
</span></span><span class="line"><span class="cl">    H --&gt; I{ÊòØÂê¶ÂåÖÂê´AsyncGenerator?}
</span></span><span class="line"><span class="cl">    I --&gt;|ÊòØ| J[Â§ÑÁêÜÊµÅÂºèËæìÂá∫]
</span></span><span class="line"><span class="cl">    I --&gt;|Âê¶| K[Áõ¥Êé•ËøîÂõûÁªìÊûú]
</span></span><span class="line"><span class="cl">    J --&gt; L[Áä∂ÊÄÅÊõ¥Êñ∞]
</span></span><span class="line"><span class="cl">    K --&gt; L
</span></span><span class="line"><span class="cl">    L --&gt; M[ËäÇÁÇπÊâßË°åÂÆåÊàê]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;ËäÇÁÇπÁ±ªÂûã&#34;
</span></span><span class="line"><span class="cl">        N1[LlmNode&lt;br/&gt;Â§ßÊ®°ÂûãË∞ÉÁî®]
</span></span><span class="line"><span class="cl">        N2[ToolNode&lt;br/&gt;Â∑•ÂÖ∑Ë∞ÉÁî®]
</span></span><span class="line"><span class="cl">        N3[QuestionClassifierNode&lt;br/&gt;ÊñáÊú¨ÂàÜÁ±ª]
</span></span><span class="line"><span class="cl">        N4[ParallelNode&lt;br/&gt;Âπ∂Ë°åÊâßË°å]
</span></span><span class="line"><span class="cl">        N5[SubGraphNode&lt;br/&gt;Â≠êÂõæËäÇÁÇπ]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    D --&gt; N1
</span></span><span class="line"><span class="cl">    D --&gt; N2
</span></span><span class="line"><span class="cl">    D --&gt; N3
</span></span><span class="line"><span class="cl">    D --&gt; N4
</span></span><span class="line"><span class="cl">    D --&gt; N5
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="332-ËäÇÁÇπÁ±ªÂûãÂ±ÇÊ¨°ÁªìÊûÑ">3.3.2 ËäÇÁÇπÁ±ªÂûãÂ±ÇÊ¨°ÁªìÊûÑ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">classDiagram
</span></span><span class="line"><span class="cl">    class Node {
</span></span><span class="line"><span class="cl">        +String id
</span></span><span class="line"><span class="cl">        +ActionFactory actionFactory
</span></span><span class="line"><span class="cl">        +apply(CompileConfig config) AsyncNodeActionWithConfig
</span></span><span class="line"><span class="cl">        +isParallel() boolean
</span></span><span class="line"><span class="cl">        +withIdUpdated(Function newId) Node
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class ParallelNode {
</span></span><span class="line"><span class="cl">        +String PARALLEL_PREFIX
</span></span><span class="line"><span class="cl">        +List~AsyncNodeActionWithConfig~ actions
</span></span><span class="line"><span class="cl">        +Map~String,KeyStrategy~ channels
</span></span><span class="line"><span class="cl">        +isParallel() boolean
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class SubStateGraphNode {
</span></span><span class="line"><span class="cl">        +String id
</span></span><span class="line"><span class="cl">        +StateGraph subGraph
</span></span><span class="line"><span class="cl">        +formatId(String nodeId) String
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class SubCompiledGraphNode {
</span></span><span class="line"><span class="cl">        +String id
</span></span><span class="line"><span class="cl">        +CompiledGraph subGraph
</span></span><span class="line"><span class="cl">        +formatId(String nodeId) String
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class CommandNode {
</span></span><span class="line"><span class="cl">        +String id
</span></span><span class="line"><span class="cl">        +AsyncCommandAction action
</span></span><span class="line"><span class="cl">        +Map~String,String~ mappings
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    Node &lt;|-- ParallelNode
</span></span><span class="line"><span class="cl">    Node &lt;|-- SubStateGraphNode
</span></span><span class="line"><span class="cl">    Node &lt;|-- SubCompiledGraphNode
</span></span><span class="line"><span class="cl">    Node &lt;|-- CommandNode
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="333-Âπ∂Ë°åËäÇÁÇπÂ§ÑÁêÜÊú∫Âà∂">3.3.3 Âπ∂Ë°åËäÇÁÇπÂ§ÑÁêÜÊú∫Âà∂
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sequenceDiagram
</span></span><span class="line"><span class="cl">    participant PNode as ParallelNode
</span></span><span class="line"><span class="cl">    participant Action1 as Action1
</span></span><span class="line"><span class="cl">    participant Action2 as Action2
</span></span><span class="line"><span class="cl">    participant Action3 as Action3
</span></span><span class="line"><span class="cl">    participant CF as CompletableFuture
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    PNode-&gt;&gt;Action1: apply(state, config)
</span></span><span class="line"><span class="cl">    PNode-&gt;&gt;Action2: apply(state, config)
</span></span><span class="line"><span class="cl">    PNode-&gt;&gt;Action3: apply(state, config)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    Action1--&gt;&gt;CF: CompletableFuture1
</span></span><span class="line"><span class="cl">    Action2--&gt;&gt;CF: CompletableFuture2
</span></span><span class="line"><span class="cl">    Action3--&gt;&gt;CF: CompletableFuture3
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    CF-&gt;&gt;CF: CompletableFuture.allOf()
</span></span><span class="line"><span class="cl">    CF-&gt;&gt;PNode: ÊâÄÊúâ‰ªªÂä°ÂÆåÊàê
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    PNode-&gt;&gt;PNode: ÂêàÂπ∂ÁªìÊûú
</span></span><span class="line"><span class="cl">    PNode--&gt;&gt;PNode: ËøîÂõûÂêàÂπ∂ÂêéÁöÑÁä∂ÊÄÅ
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="34-edge-Ëæπ">3.4 Edge (Ëæπ)
</h3><p><strong>EdgeÊòØÂ∑•‰ΩúÊµÅÁöÑË∑ØÁî±Âô®</strong>ÔºåÂÆÉÂÜ≥ÂÆö‰∫ÜÊï∞ÊçÆÂú®ËäÇÁÇπ‰πãÈó¥ÁöÑÊµÅËΩ¨Ë∑ØÂæÑ„ÄÇEdge‰∏ç‰ªÖ‰ªÖÊòØÁÆÄÂçïÁöÑËøûÊé•Á∫øÔºåÂÆÉËøòÂåÖÂê´‰∫ÜÂ§çÊùÇÁöÑÊù°‰ª∂Âà§Êñ≠ÈÄªËæëÔºåËÉΩÂ§üÊ†πÊçÆÂΩìÂâçÁä∂ÊÄÅÂä®ÊÄÅÂÜ≥ÂÆö‰∏ã‰∏ÄÊ≠•ÁöÑÊâßË°åË∑ØÂæÑ„ÄÇ</p>
<p><strong>Êô∫ËÉΩË∑ØÁî±</strong>ÔºöEdgeÊîØÊåÅÈùôÊÄÅË∑ØÁî±ÂíåÂä®ÊÄÅË∑ØÁî±‰∏§ÁßçÊ®°Âºè„ÄÇÈùôÊÄÅËæπÊèê‰æõÂõ∫ÂÆöÁöÑËΩ¨Êç¢Ë∑ØÂæÑÔºåËÄåÊù°‰ª∂ËæπÂàôÂèØ‰ª•Ê†πÊçÆÁä∂ÊÄÅÂÜÖÂÆπËøõË°åÊô∫ËÉΩÂà§Êñ≠ÔºåËøôÁßçËÆæËÆ°ËÆ©Â∑•‰ΩúÊµÅÂÖ∑Â§á‰∫ÜÂº∫Â§ßÁöÑÊù°‰ª∂ÂàÜÊîØËÉΩÂäõÔºåËÉΩÂ§üÂ§ÑÁêÜÂêÑÁßçÂ§çÊùÇÁöÑ‰∏öÂä°ÈÄªËæë„ÄÇ</p>
<h4 id="341-ËæπÁöÑÁ±ªÂûã‰∏éÁªìÊûÑ">3.4.1 ËæπÁöÑÁ±ªÂûã‰∏éÁªìÊûÑ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">classDiagram
</span></span><span class="line"><span class="cl">    class Edge {
</span></span><span class="line"><span class="cl">        +String sourceId
</span></span><span class="line"><span class="cl">        +EdgeValue targetValue
</span></span><span class="line"><span class="cl">        +validate(Nodes nodes)
</span></span><span class="line"><span class="cl">        +List~EdgeValue~ targets()
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class EdgeValue {
</span></span><span class="line"><span class="cl">        &lt;&lt;sealed interface&gt;&gt;
</span></span><span class="line"><span class="cl">        +String id()
</span></span><span class="line"><span class="cl">        +EdgeCondition value()
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class EdgeValue_Const {
</span></span><span class="line"><span class="cl">        +String value
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class EdgeValue_Condition {
</span></span><span class="line"><span class="cl">        +EdgeCondition condition
</span></span><span class="line"><span class="cl">        +Map~String,String~ mappings
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    class EdgeCondition {
</span></span><span class="line"><span class="cl">        +AsyncCommandAction action
</span></span><span class="line"><span class="cl">        +Map~String,String~ mappings
</span></span><span class="line"><span class="cl">        +apply(OverAllState state, RunnableConfig config) CompletableFuture~Command~
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    Edge --&gt; EdgeValue
</span></span><span class="line"><span class="cl">    EdgeValue &lt;|-- EdgeValue_Const
</span></span><span class="line"><span class="cl">    EdgeValue &lt;|-- EdgeValue_Condition
</span></span><span class="line"><span class="cl">    EdgeValue_Condition --&gt; EdgeCondition
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="342-Êù°‰ª∂ËæπË∑ØÁî±ÊµÅÁ®ã">3.4.2 Êù°‰ª∂ËæπË∑ØÁî±ÊµÅÁ®ã
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart TD
</span></span><span class="line"><span class="cl">    A[Âà∞ËææÊù°‰ª∂Ëæπ] --&gt; B[Ëé∑ÂèñEdgeCondition]
</span></span><span class="line"><span class="cl">    B --&gt; C[ÊâßË°åcondition.apply]
</span></span><span class="line"><span class="cl">    C --&gt; D[Ëé∑ÂèñCommandÁªìÊûú]
</span></span><span class="line"><span class="cl">    D --&gt; E[ÊèêÂèñgotoNodeÂÄº]
</span></span><span class="line"><span class="cl">    E --&gt; F[Âú®mappings‰∏≠Êü•Êâæ]
</span></span><span class="line"><span class="cl">    F --&gt; G{ÊâæÂà∞Êò†Â∞Ñ?}
</span></span><span class="line"><span class="cl">    G --&gt;|ÊòØ| H[ËøîÂõûÁõÆÊ†áËäÇÁÇπID]
</span></span><span class="line"><span class="cl">    G --&gt;|Âê¶| I[ÊäõÂá∫Êò†Â∞ÑÁº∫Â§±ÂºÇÂ∏∏]
</span></span><span class="line"><span class="cl">    H --&gt; J[Ë∑≥ËΩ¨Âà∞ÁõÆÊ†áËäÇÁÇπ]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;Êù°‰ª∂ËØÑ‰º∞Á§∫‰æã&#34;
</span></span><span class="line"><span class="cl">        K[FeedbackQuestionDispatcher]
</span></span><span class="line"><span class="cl">        K --&gt; L[ÂàÜÊûêclassifier_output]
</span></span><span class="line"><span class="cl">        L --&gt; M{ÂåÖÂê´positive?}
</span></span><span class="line"><span class="cl">        M --&gt;|ÊòØ| N[ËøîÂõûpositive]
</span></span><span class="line"><span class="cl">        M --&gt;|Âê¶| O[ËøîÂõûnegative]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    C --&gt; K
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="343-ËæπÈ™åËØÅÊú∫Âà∂">3.4.3 ËæπÈ™åËØÅÊú∫Âà∂
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Edge</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="n">Nodes</span><span class="w"> </span><span class="n">nodes</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">GraphStateException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// È™åËØÅÊ∫êËäÇÁÇπÂ≠òÂú®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">nodes</span><span class="p">.</span><span class="na">anyMatchById</span><span class="p">(</span><span class="n">sourceId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">Errors</span><span class="p">.</span><span class="na">missingNodeInEdgeMapping</span><span class="p">.</span><span class="na">exception</span><span class="p">(</span><span class="n">sourceId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// È™åËØÅÁõÆÊ†áËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">EdgeValue</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">targets</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="na">id</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// ÈùôÊÄÅËæπÔºöÁõ¥Êé•È™åËØÅÁõÆÊ†áËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">nodes</span><span class="p">.</span><span class="na">anyMatchById</span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="na">id</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">END</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="na">id</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">throw</span><span class="w"> </span><span class="n">Errors</span><span class="p">.</span><span class="na">missingNodeInEdgeMapping</span><span class="p">.</span><span class="na">exception</span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="na">id</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="na">value</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// Êù°‰ª∂ËæπÔºöÈ™åËØÅÊò†Â∞Ñ‰∏≠ÁöÑÊâÄÊúâÁõÆÊ†áËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">targetNodeId</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="na">value</span><span class="p">().</span><span class="na">mappings</span><span class="p">().</span><span class="na">values</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">nodes</span><span class="p">.</span><span class="na">anyMatchById</span><span class="p">(</span><span class="n">targetNodeId</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">END</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">targetNodeId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">throw</span><span class="w"> </span><span class="n">Errors</span><span class="p">.</span><span class="na">missingNodeInEdgeMapping</span><span class="p">.</span><span class="na">exception</span><span class="p">(</span><span class="n">targetNodeId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="35-compiledgraph-ÁºñËØëÂõæ">3.5 CompiledGraph (ÁºñËØëÂõæ)
</h3><p><strong>CompiledGraphÊòØÂ∑•‰ΩúÊµÅÁöÑÊâßË°åÂºïÊìé</strong>ÔºåÂÆÉÂ∞ÜStateGraphÁöÑÈùôÊÄÅÂÆö‰πâËΩ¨Êç¢‰∏∫È´òÊïàÁöÑËøêË°åÊó∂‰ª£Á†Å„ÄÇÂ∞±ÂÉèÂ∞ÜÈ´òÁ∫ßËØ≠Ë®ÄÁºñËØëÊàêÊú∫Âô®Á†Å‰∏ÄÊ†∑ÔºåCompiledGraphÂØπÂ∑•‰ΩúÊµÅËøõË°å‰∫ÜÂêÑÁßç‰ºòÂåñÔºåÂåÖÊã¨ËäÇÁÇπÈ¢ÑÂ§ÑÁêÜ„ÄÅËæπË∑ØÁî±‰ºòÂåñ„ÄÅÁä∂ÊÄÅÁÆ°ÁêÜÁ≠ñÁï•Á≠â„ÄÇ</p>
<p><strong>ËøêË°åÊó∂‰ºòÂåñ</strong>ÔºöCompiledGraphÂú®ÁºñËØëËøáÁ®ã‰∏≠‰ºöËøõË°åÂ§öÁßç‰ºòÂåñÔºåÂ¶ÇËäÇÁÇπ‰æùËµñÂàÜÊûê„ÄÅÂπ∂Ë°åÊâßË°åËßÑÂàí„ÄÅÁä∂ÊÄÅËÆøÈóÆ‰ºòÂåñÁ≠âÔºåËøô‰∫õ‰ºòÂåñÁ°Æ‰øù‰∫ÜÂ∑•‰ΩúÊµÅÂú®ËøêË°åÊó∂ÁöÑÈ´òÊïàÊÄßÂíåÁ®≥ÂÆöÊÄß„ÄÇ</p>
<h4 id="351-ÁºñËØëËøáÁ®ãËØ¶Ëß£">3.5.1 ÁºñËØëËøáÁ®ãËØ¶Ëß£
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart TD
</span></span><span class="line"><span class="cl">    A[StateGraph.compile] --&gt; B[ÂàõÂª∫CompiledGraph]
</span></span><span class="line"><span class="cl">    B --&gt; C[Â§ÑÁêÜËäÇÁÇπÂíåËæπ]
</span></span><span class="line"><span class="cl">    C --&gt; D[Ê£ÄÊü•‰∏≠Êñ≠ÈÖçÁΩÆ]
</span></span><span class="line"><span class="cl">    D --&gt; E[ÂàõÂª∫ËäÇÁÇπÊò†Â∞Ñ]
</span></span><span class="line"><span class="cl">    E --&gt; F[ÂàõÂª∫ËæπÊò†Â∞Ñ]
</span></span><span class="line"><span class="cl">    F --&gt; G[Â§ÑÁêÜÂ≠êÂõæËäÇÁÇπ]
</span></span><span class="line"><span class="cl">    G --&gt; H[ÁîüÊàêÊúÄÁªàCompiledGraph]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;ProcessedNodesEdgesAndConfig&#34;
</span></span><span class="line"><span class="cl">        I[Â§ÑÁêÜÊôÆÈÄöËäÇÁÇπ]
</span></span><span class="line"><span class="cl">        J[Â§ÑÁêÜÂ≠êÂõæËäÇÁÇπ]
</span></span><span class="line"><span class="cl">        K[Â§ÑÁêÜÂπ∂Ë°åËäÇÁÇπ]
</span></span><span class="line"><span class="cl">        L[Â§ÑÁêÜ‰∏≠Êñ≠ÈÖçÁΩÆ]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    C --&gt; I
</span></span><span class="line"><span class="cl">    C --&gt; J
</span></span><span class="line"><span class="cl">    C --&gt; K
</span></span><span class="line"><span class="cl">    C --&gt; L
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="352-asyncnodegeneratorÊâßË°åÊú∫Âà∂">3.5.2 AsyncNodeGeneratorÊâßË°åÊú∫Âà∂
</h4><p><strong>AsyncNodeGeneratorÊòØÂ∑•‰ΩúÊµÅÊâßË°åÁöÑÊ†∏ÂøÉÁä∂ÊÄÅÊú∫</strong>ÔºåÂÆÉË¥üË¥£Êé®Âä®Êï¥‰∏™Â∑•‰ΩúÊµÅÁöÑËøêË°å„ÄÇAsyncNodeGeneratorÈááÁî®‰∫ÜÂü∫‰∫éËø≠‰ª£Âô®ÁöÑËÆæËÆ°Ê®°ÂºèÔºåÊØèÊ¨°Ë∞ÉÁî®next()ÊñπÊ≥ïÈÉΩ‰ºöÊâßË°å‰∏Ä‰∏™Ê≠•È™§ÔºåËøôÁßçËÆæËÆ°Êó¢ÊîØÊåÅÂêåÊ≠•ÊâßË°åÔºå‰πüÊîØÊåÅÂºÇÊ≠•ÊµÅÂºèÂ§ÑÁêÜ„ÄÇ</p>
<p><strong>ÊâßË°åÊéßÂà∂</strong>ÔºöAsyncNodeGeneratorÂÜÖÁΩÆ‰∫ÜÂÆåÂñÑÁöÑÊâßË°åÊéßÂà∂Êú∫Âà∂ÔºåÂåÖÊã¨ÊúÄÂ§ßËø≠‰ª£Ê¨°Êï∞Ê£ÄÊü•„ÄÅ‰∏≠Êñ≠Êù°‰ª∂Â§ÑÁêÜ„ÄÅÈîôËØØÊÅ¢Â§çÁ≠âÔºåÁ°Æ‰øùÂ∑•‰ΩúÊµÅÂú®ÂêÑÁßçÊÉÖÂÜµ‰∏ãÈÉΩËÉΩÁ®≥ÂÆöËøêË°å„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">stateDiagram-v2
</span></span><span class="line"><span class="cl">    [*] --&gt; Initializing: ÂàõÂª∫AsyncNodeGenerator
</span></span><span class="line"><span class="cl">    Initializing --&gt; CheckingResume: Ê£ÄÊü•ÊòØÂê¶ÊÅ¢Â§çÊ®°Âºè
</span></span><span class="line"><span class="cl">    CheckingResume --&gt; Resuming: ÊÅ¢Â§çÊ®°Âºè
</span></span><span class="line"><span class="cl">    CheckingResume --&gt; Starting: Ê≠£Â∏∏ÂêØÂä®
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    Resuming --&gt; LoadingCheckpoint: Âä†ËΩΩÊ£ÄÊü•ÁÇπ
</span></span><span class="line"><span class="cl">    LoadingCheckpoint --&gt; RestoringState: ÊÅ¢Â§çÁä∂ÊÄÅ
</span></span><span class="line"><span class="cl">    RestoringState --&gt; Ready: ÂáÜÂ§áÊâßË°å
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    Starting --&gt; InitializingState: ÂàùÂßãÂåñÁä∂ÊÄÅ
</span></span><span class="line"><span class="cl">    InitializingState --&gt; Ready: ÂáÜÂ§áÊâßË°å
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    Ready --&gt; Executing: ÂºÄÂßãÊâßË°å
</span></span><span class="line"><span class="cl">    Executing --&gt; CheckingIteration: Ê£ÄÊü•Ëø≠‰ª£Ê¨°Êï∞
</span></span><span class="line"><span class="cl">    CheckingIteration --&gt; MaxIterationReached: ËææÂà∞ÊúÄÂ§ßËø≠‰ª£
</span></span><span class="line"><span class="cl">    CheckingIteration --&gt; CheckingInterrupt: Ê£ÄÊü•‰∏≠Êñ≠
</span></span><span class="line"><span class="cl">    CheckingInterrupt --&gt; Interrupted: ‰∏≠Êñ≠ÊâßË°å
</span></span><span class="line"><span class="cl">    CheckingInterrupt --&gt; ExecutingNode: ÊâßË°åËäÇÁÇπ
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    ExecutingNode --&gt; UpdatingState: Êõ¥Êñ∞Áä∂ÊÄÅ
</span></span><span class="line"><span class="cl">    UpdatingState --&gt; SavingCheckpoint: ‰øùÂ≠òÊ£ÄÊü•ÁÇπ
</span></span><span class="line"><span class="cl">    SavingCheckpoint --&gt; DeterminingNext: Á°ÆÂÆö‰∏ã‰∏ÄËäÇÁÇπ
</span></span><span class="line"><span class="cl">    DeterminingNext --&gt; CheckingEnd: Ê£ÄÊü•ÊòØÂê¶ÁªìÊùü
</span></span><span class="line"><span class="cl">    CheckingEnd --&gt; Completed: ÊâßË°åÂÆåÊàê
</span></span><span class="line"><span class="cl">    CheckingEnd --&gt; Executing: ÁªßÁª≠ÊâßË°å
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    MaxIterationReached --&gt; [*]
</span></span><span class="line"><span class="cl">    Interrupted --&gt; [*]
</span></span><span class="line"><span class="cl">    Completed --&gt; [*]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="353-Áä∂ÊÄÅÊµÅËΩ¨Ê†∏ÂøÉÈÄªËæë">3.5.3 Áä∂ÊÄÅÊµÅËΩ¨Ê†∏ÂøÉÈÄªËæë
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AsyncNodeGenerator</span><span class="o">&lt;</span><span class="n">Output</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">NodeOutput</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AsyncGenerator</span><span class="o">&lt;</span><span class="n">Output</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Data</span><span class="o">&lt;</span><span class="n">Output</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">next</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 1. Ê£ÄÊü•ÊúÄÂ§ßËø≠‰ª£Ê¨°Êï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">iteration</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxIterations</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">format</span><span class="p">(</span><span class="s">&#34;Maximum number of iterations (%d) reached!&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">maxIterations</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 2. Ê£ÄÊü•ÊòØÂê¶ÁªìÊùü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nextNodeId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">currentNodeId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">releaseThread</span><span class="p">().</span><span class="na">map</span><span class="p">(</span><span class="n">Data</span><span class="p">::</span><span class="o">&lt;</span><span class="n">Output</span><span class="o">&gt;</span><span class="n">done</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">.</span><span class="na">orElseGet</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="na">done</span><span class="p">(</span><span class="n">currentState</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 3. Â§ÑÁêÜSTARTËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">START</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">currentNodeId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">doListeners</span><span class="p">(</span><span class="n">START</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="n">nextNodeCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getEntryPoint</span><span class="p">(</span><span class="n">currentState</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">nextNodeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nextNodeCommand</span><span class="p">.</span><span class="na">gotoNode</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">currentState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nextNodeCommand</span><span class="p">.</span><span class="na">update</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="n">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addCheckpoint</span><span class="p">(</span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="n">START</span><span class="p">,</span><span class="w"> </span><span class="n">currentState</span><span class="p">,</span><span class="w"> </span><span class="n">nextNodeId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">cp</span><span class="p">.</span><span class="na">isPresent</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="na">streamMode</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">StreamMode</span><span class="p">.</span><span class="na">SNAPSHOTS</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="o">?</span><span class="w"> </span><span class="n">buildStateSnapshot</span><span class="p">(</span><span class="n">cp</span><span class="p">.</span><span class="na">get</span><span class="p">())</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">buildNodeOutput</span><span class="p">(</span><span class="n">currentNodeId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">currentNodeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nextNodeId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">output</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 4. Â§ÑÁêÜENDËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">END</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">nextNodeId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">nextNodeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">currentNodeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">doListeners</span><span class="p">(</span><span class="n">END</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">buildNodeOutput</span><span class="p">(</span><span class="n">END</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 5. Ê£ÄÊü•‰∏≠Êñ≠Êù°‰ª∂</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">shouldInterruptAfter</span><span class="p">(</span><span class="n">currentNodeId</span><span class="p">,</span><span class="w"> </span><span class="n">nextNodeId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="na">done</span><span class="p">(</span><span class="n">currentNodeId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">shouldInterruptBefore</span><span class="p">(</span><span class="n">nextNodeId</span><span class="p">,</span><span class="w"> </span><span class="n">currentNodeId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="na">done</span><span class="p">(</span><span class="n">currentNodeId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 6. ÊâßË°åËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">currentNodeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nextNodeId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nodes</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">currentNodeId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">evaluateAction</span><span class="p">(</span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">overAllState</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="4-È¢ÑÂÆö‰πâÁªÑ‰ª∂‰∏éÂ∑•ÂÖ∑ÁÆ±">4. È¢ÑÂÆö‰πâÁªÑ‰ª∂‰∏éÂ∑•ÂÖ∑ÁÆ±
</h2><h3 id="41-È¢ÑÂÆö‰πâËäÇÁÇπÁ±ªÂûã">4.1 È¢ÑÂÆö‰πâËäÇÁÇπÁ±ªÂûã
</h3><p><strong>Spring AI Alibaba GraphÊèê‰æõ‰∫Ü‰∏∞ÂØåÁöÑÈ¢ÑÂÆö‰πâËäÇÁÇπÂ∑•ÂÖ∑ÁÆ±</strong>ÔºåËøô‰∫õËäÇÁÇπÂ∞±ÂÉè‰πêÈ´òÁßØÊú®‰∏ÄÊ†∑ÔºåÂºÄÂèëËÄÖÂèØ‰ª•ÈÄöËøáÁªÑÂêàËøô‰∫õÈ¢ÑÂÆö‰πâËäÇÁÇπÂø´ÈÄüÊûÑÂª∫Â§çÊùÇÁöÑAIÂ∫îÁî®„ÄÇÊØè‰∏™È¢ÑÂÆö‰πâËäÇÁÇπÈÉΩÁªèËøá‰∫ÜÁ≤æÂøÉËÆæËÆ°Âíå‰ºòÂåñÔºå‰∏ç‰ªÖÂäüËÉΩÂº∫Â§ßÔºåËÄå‰∏îÊòì‰∫é‰ΩøÁî®„ÄÇ</p>
<p><strong>ËÆæËÆ°ÁêÜÂøµ</strong>ÔºöÈ¢ÑÂÆö‰πâËäÇÁÇπÁöÑËÆæËÆ°ÈÅµÂæ™‰∫Ü&quot;ÂºÄÁÆ±Âç≥Áî®&quot;ÁöÑÂéüÂàôÔºåÂºÄÂèëËÄÖÂè™ÈúÄË¶ÅÊèê‰æõÂøÖË¶ÅÁöÑÈÖçÁΩÆÂèÇÊï∞ÔºåÂ∞±ËÉΩÁ´ãÂç≥‰ΩøÁî®Ëøô‰∫õËäÇÁÇπÁöÑÂº∫Â§ßÂäüËÉΩÔºåÂ§ßÂ§ßÈôç‰Ωé‰∫ÜAIÂ∫îÁî®ÁöÑÂºÄÂèëÈó®Êßõ„ÄÇ</p>
<h4 id="411-ËäÇÁÇπÂàÜÁ±ªÊû∂ÊûÑ">4.1.1 ËäÇÁÇπÂàÜÁ±ªÊû∂ÊûÑ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">graph TB
</span></span><span class="line"><span class="cl">    subgraph &#34;È¢ÑÂÆö‰πâËäÇÁÇπ‰ΩìÁ≥ª&#34;
</span></span><span class="line"><span class="cl">        A[NodeActionÊé•Âè£]
</span></span><span class="line"><span class="cl">        A --&gt; B[LlmNode&lt;br/&gt;Â§ßÊ®°ÂûãËäÇÁÇπ]
</span></span><span class="line"><span class="cl">        A --&gt; C[ToolNode&lt;br/&gt;Â∑•ÂÖ∑ËäÇÁÇπ]
</span></span><span class="line"><span class="cl">        A --&gt; D[QuestionClassifierNode&lt;br/&gt;ÂàÜÁ±ªËäÇÁÇπ]
</span></span><span class="line"><span class="cl">        A --&gt; E[KnowledgeRetrievalNode&lt;br/&gt;Ê£ÄÁ¥¢ËäÇÁÇπ]
</span></span><span class="line"><span class="cl">        A --&gt; F[ParameterParsingNode&lt;br/&gt;ÂèÇÊï∞Ëß£ÊûêËäÇÁÇπ]
</span></span><span class="line"><span class="cl">        A --&gt; G[McpNode&lt;br/&gt;MCPÂçèËÆÆËäÇÁÇπ]
</span></span><span class="line"><span class="cl">        A --&gt; H[AnswerNode&lt;br/&gt;Á≠îÊ°àÁîüÊàêËäÇÁÇπ]
</span></span><span class="line"><span class="cl">        A --&gt; I[ListOperatorNode&lt;br/&gt;ÂàóË°®Êìç‰ΩúËäÇÁÇπ]
</span></span><span class="line"><span class="cl">        A --&gt; J[CodeExecutorNode&lt;br/&gt;‰ª£Á†ÅÊâßË°åËäÇÁÇπ]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;ËäÇÁÇπÁâπÊÄß&#34;
</span></span><span class="line"><span class="cl">        K[BuilderÊ®°ÂºèÊûÑÂª∫]
</span></span><span class="line"><span class="cl">        L[Áä∂ÊÄÅÈ©±Âä®]
</span></span><span class="line"><span class="cl">        M[ÂºÇÊ≠•ÊîØÊåÅ]
</span></span><span class="line"><span class="cl">        N[ÊµÅÂºèÂ§ÑÁêÜ]
</span></span><span class="line"><span class="cl">        O[ÈîôËØØÂ§ÑÁêÜ]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    B --&gt; K
</span></span><span class="line"><span class="cl">    C --&gt; L
</span></span><span class="line"><span class="cl">    D --&gt; M
</span></span><span class="line"><span class="cl">    E --&gt; N
</span></span><span class="line"><span class="cl">    F --&gt; O
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="412-questionclassifiernode---Êô∫ËÉΩÂàÜÁ±ªËäÇÁÇπ">4.1.2 QuestionClassifierNode - Êô∫ËÉΩÂàÜÁ±ªËäÇÁÇπ
</h4><p><strong>QuestionClassifierNodeÊòØÂ∑•‰ΩúÊµÅÁöÑÊô∫ËÉΩÂàÜÊã£Âëò</strong>ÔºåÂÆÉËÉΩÂ§üÁêÜËß£ÊñáÊú¨ÂÜÖÂÆπÂπ∂Â∞ÜÂÖ∂ÂΩíÁ±ªÂà∞È¢ÑÂÆö‰πâÁöÑÁ±ªÂà´‰∏≠„ÄÇËøô‰∏™ËäÇÁÇπÂÜÖÁΩÆ‰∫ÜÂ∞ëÊ†∑Êú¨Â≠¶‰π†Êú∫Âà∂ÔºåÂç≥‰ΩøÊ≤°ÊúâÂ§ßÈáèËÆ≠ÁªÉÊï∞ÊçÆÔºå‰πüËÉΩÂÆûÁé∞ÂáÜÁ°ÆÁöÑÂàÜÁ±ªÊïàÊûú„ÄÇ</p>
<p><strong>Ê†∏ÂøÉ‰ºòÂäø</strong>ÔºöQuestionClassifierNodeÈááÁî®‰∫ÜÊèêÁ§∫Â∑•Á®ãÁöÑÊúÄ‰Ω≥ÂÆûË∑µÔºåÈÄöËøáÁ≤æÂøÉËÆæËÆ°ÁöÑÊèêÁ§∫ËØçÊ®°ÊùøÂíåÂ∞ëÊ†∑Êú¨Á§∫‰æãÔºåËÆ©Â§ßËØ≠Ë®ÄÊ®°ÂûãËÉΩÂ§üÂáÜÁ°ÆÁêÜËß£ÂàÜÁ±ª‰ªªÂä°ÁöÑË¶ÅÊ±ÇÔºåÂÆûÁé∞È´òË¥®ÈáèÁöÑÊñáÊú¨ÂàÜÁ±ª„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart TD
</span></span><span class="line"><span class="cl">    A[QuestionClassifierNodeÊâßË°å] --&gt; B[‰ªéÁä∂ÊÄÅËé∑ÂèñËæìÂÖ•ÊñáÊú¨]
</span></span><span class="line"><span class="cl">    B --&gt; C[ÊûÑÂª∫ÂàÜÁ±ªÊèêÁ§∫ËØç]
</span></span><span class="line"><span class="cl">    C --&gt; D[Ê∑ªÂä†Â∞ëÊ†∑Êú¨Á§∫‰æã]
</span></span><span class="line"><span class="cl">    D --&gt; E[Ë∞ÉÁî®ChatClient]
</span></span><span class="line"><span class="cl">    E --&gt; F[Ëß£ÊûêÂàÜÁ±ªÁªìÊûú]
</span></span><span class="line"><span class="cl">    F --&gt; G[Êõ¥Êñ∞Áä∂ÊÄÅ]
</span></span><span class="line"><span class="cl">    G --&gt; H[ËøîÂõûÂàÜÁ±ªÁªìÊûú]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;ÊèêÁ§∫ËØçÊûÑÂª∫&#34;
</span></span><span class="line"><span class="cl">        I[Á≥ªÁªüÊèêÁ§∫ËØçÊ®°Êùø]
</span></span><span class="line"><span class="cl">        J[ÂàÜÁ±ªÁ±ªÂà´ÂàóË°®]
</span></span><span class="line"><span class="cl">        K[ÂàÜÁ±ªÊåá‰ª§]
</span></span><span class="line"><span class="cl">        L[Â∞ëÊ†∑Êú¨Á§∫‰æã]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    C --&gt; I
</span></span><span class="line"><span class="cl">    C --&gt; J
</span></span><span class="line"><span class="cl">    C --&gt; K
</span></span><span class="line"><span class="cl">    C --&gt; L
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;ËæìÂá∫Ê†ºÂºè&#34;
</span></span><span class="line"><span class="cl">        M[JSONÊ†ºÂºè]
</span></span><span class="line"><span class="cl">        M --&gt; N[keywords: ÂÖ≥ÈîÆËØçÂàóË°®]
</span></span><span class="line"><span class="cl">        M --&gt; O[category_name: ÂàÜÁ±ªÂêçÁß∞]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    F --&gt; M
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Â∫îÁî®Âú∫ÊôØ</strong>ÔºöQuestionClassifierNodeÁâπÂà´ÈÄÇÂêàÂÆ¢ÊúçÁ≥ªÁªüÁöÑÈóÆÈ¢òÂàÜÁ±ª„ÄÅÂÜÖÂÆπÂÆ°Ê†∏ÁöÑÁ±ªÂûãÂà§Êñ≠„ÄÅÈÇÆ‰ª∂ÁöÑËá™Âä®ÂàÜÊã£Á≠âÂú∫ÊôØÔºåËÉΩÂ§üÊòæËëóÊèêÈ´ò‰∏öÂä°Â§ÑÁêÜÁöÑËá™Âä®ÂåñÁ®ãÂ∫¶„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">QuestionClassifierNode</span><span class="w"> </span><span class="n">classifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">QuestionClassifierNode</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">chatClient</span><span class="p">(</span><span class="n">chatClient</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">inputTextKey</span><span class="p">(</span><span class="s">&#34;input&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">outputKey</span><span class="p">(</span><span class="s">&#34;classifier_output&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">categories</span><span class="p">(</span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;positive feedback&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;negative feedback&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">classificationInstructions</span><span class="p">(</span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;Try to understand the user&#39;s feeling when giving feedback.&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ê†∏ÂøÉÂÆûÁé∞ÂéüÁêÜÔºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">OverAllState</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 1. ‰ªéÁä∂ÊÄÅËé∑ÂèñËæìÂÖ•ÊñáÊú¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StringUtils</span><span class="p">.</span><span class="na">hasLength</span><span class="p">(</span><span class="n">inputTextKey</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">inputText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">(</span><span class="n">inputTextKey</span><span class="p">).</span><span class="na">orElse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">inputText</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 2. ÊûÑÂª∫Â∞ëÊ†∑Êú¨Â≠¶‰π†Ê∂àÊÅØ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">UserMessage</span><span class="p">(</span><span class="n">QUESTION_CLASSIFIER_USER_PROMPT_1</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">AssistantMessage</span><span class="p">(</span><span class="n">QUESTION_CLASSIFIER_ASSISTANT_PROMPT_1</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">UserMessage</span><span class="p">(</span><span class="n">QUESTION_CLASSIFIER_USER_PROMPT_2</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">AssistantMessage</span><span class="p">(</span><span class="n">QUESTION_CLASSIFIER_ASSISTANT_PROMPT_2</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 3. Ë∞ÉÁî®Â§ßÊ®°ÂûãËøõË°åÂàÜÁ±ª</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ChatResponse</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chatClient</span><span class="p">.</span><span class="na">prompt</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">system</span><span class="p">(</span><span class="n">systemPromptTemplate</span><span class="p">.</span><span class="na">render</span><span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;inputText&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">inputText</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;categories&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;classificationInstructions&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">classificationInstructions</span><span class="p">)))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">inputText</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">messages</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">call</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">chatResponse</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 4. ËøîÂõûÂàÜÁ±ªÁªìÊûú</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">updatedState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">updatedState</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">outputKey</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">getResult</span><span class="p">().</span><span class="na">getOutput</span><span class="p">().</span><span class="na">getText</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">updatedState</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="413-llmnode---Â§ßÊ®°ÂûãË∞ÉÁî®ËäÇÁÇπ">4.1.3 LlmNode - Â§ßÊ®°ÂûãË∞ÉÁî®ËäÇÁÇπ
</h4><p><strong>LlmNodeÊòØÂ∑•‰ΩúÊµÅÁöÑÊô∫ËÉΩÂ§ßËÑë</strong>ÔºåÂÆÉÂ∞ÅË£Ö‰∫Ü‰∏éÂ§ßËØ≠Ë®ÄÊ®°ÂûãÁöÑÊâÄÊúâ‰∫§‰∫íÈÄªËæëÔºåËÆ©ÂºÄÂèëËÄÖÂèØ‰ª•ËΩªÊùæÂú∞Âú®Â∑•‰ΩúÊµÅ‰∏≠‰ΩøÁî®AIÁöÑÂº∫Â§ßËÉΩÂäõ„ÄÇLlmNode‰∏ç‰ªÖÊîØÊåÅÁÆÄÂçïÁöÑÊñáÊú¨ÁîüÊàêÔºåËøòÊîØÊåÅÂ§çÊùÇÁöÑÂØπËØùÁÆ°ÁêÜÂíåÊµÅÂºèËæìÂá∫„ÄÇ</p>
<p><strong>Êô∫ËÉΩÁâπÊÄß</strong>ÔºöLlmNodeÂÜÖÁΩÆ‰∫ÜÊèêÁ§∫ËØçÊ®°ÊùøÂºïÊìéÔºåÊîØÊåÅÂä®ÊÄÅÂèÇÊï∞ÊõøÊç¢ÔºåËøòËÉΩÁÆ°ÁêÜÂÆåÊï¥ÁöÑÂØπËØùÂéÜÂè≤ÔºåËøô‰∫õÁâπÊÄßËÆ©ÂÆÉËÉΩÂ§üÂ§ÑÁêÜÂêÑÁßçÂ§çÊùÇÁöÑAI‰∫§‰∫íÂú∫ÊôØ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart TD
</span></span><span class="line"><span class="cl">    A[LlmNodeÊâßË°å] --&gt; B[ÂàùÂßãÂåñËäÇÁÇπÁä∂ÊÄÅ]
</span></span><span class="line"><span class="cl">    B --&gt; C{ÊòØÂê¶ÊµÅÂºèÊ®°Âºè?}
</span></span><span class="line"><span class="cl">    C --&gt;|ÊòØ| D[ÂàõÂª∫ÊµÅÂºèÂìçÂ∫î]
</span></span><span class="line"><span class="cl">    C --&gt;|Âê¶| E[ÂàõÂª∫ÂêåÊ≠•ÂìçÂ∫î]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    D --&gt; F[ÊûÑÂª∫StreamingChatGenerator]
</span></span><span class="line"><span class="cl">    F --&gt; G[ËøîÂõûAsyncGenerator]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    E --&gt; H[Ë∞ÉÁî®ChatClient]
</span></span><span class="line"><span class="cl">    H --&gt; I[Ëé∑ÂèñÂìçÂ∫îÁªìÊûú]
</span></span><span class="line"><span class="cl">    I --&gt; J[Êõ¥Êñ∞Ê∂àÊÅØÁä∂ÊÄÅ]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    G --&gt; K[ÊµÅÂºèËæìÂá∫Â§ÑÁêÜ]
</span></span><span class="line"><span class="cl">    J --&gt; L[ÂêåÊ≠•ÁªìÊûúËøîÂõû]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;Áä∂ÊÄÅÂàùÂßãÂåñ&#34;
</span></span><span class="line"><span class="cl">        M[userPromptKey ‚Üí userPrompt]
</span></span><span class="line"><span class="cl">        N[systemPromptKey ‚Üí systemPrompt]
</span></span><span class="line"><span class="cl">        O[paramsKey ‚Üí params]
</span></span><span class="line"><span class="cl">        P[messagesKey ‚Üí messages]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    B --&gt; M
</span></span><span class="line"><span class="cl">    B --&gt; N
</span></span><span class="line"><span class="cl">    B --&gt; O
</span></span><span class="line"><span class="cl">    B --&gt; P
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;Ê®°ÊùøÊ∏≤Êüì&#34;
</span></span><span class="line"><span class="cl">        Q[PromptTemplate.render]
</span></span><span class="line"><span class="cl">        Q --&gt; R[ÂèÇÊï∞ÊõøÊç¢]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    M --&gt; Q
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÊµÅÂºèÂ§ÑÁêÜ‰ºòÂäø</strong>ÔºöLlmNodeÂéüÁîüÊîØÊåÅÊµÅÂºèËæìÂá∫ÔºåËøôÊÑèÂë≥ÁùÄÁî®Êà∑ÂèØ‰ª•ÂÆûÊó∂ÁúãÂà∞AIÁöÑÁîüÊàêËøáÁ®ãÔºåËÄå‰∏çÈúÄË¶ÅÁ≠âÂæÖÂÆåÊï¥ÁöÑÂìçÂ∫îÔºåÂ§ßÂ§ßÊèêÂçá‰∫ÜÁî®Êà∑‰ΩìÈ™å„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">LlmNode</span><span class="w"> </span><span class="n">llmNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LlmNode</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">chatClient</span><span class="p">(</span><span class="n">chatClient</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">systemPromptTemplate</span><span class="p">(</span><span class="s">&#34;You are a helpful assistant.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">userPromptTemplate</span><span class="p">(</span><span class="s">&#34;Please process: {input}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">messagesKey</span><span class="p">(</span><span class="s">&#34;messages&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">outputKey</span><span class="p">(</span><span class="s">&#34;llm_response&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w">  </span><span class="c1">// ÂêØÁî®ÊµÅÂºèËæìÂá∫</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ê†∏ÂøÉÁâπÊÄßÔºö</strong></p>
<ul>
<li><strong>Ê®°ÊùøÊîØÊåÅ</strong>ÔºöÊîØÊåÅÁ≥ªÁªüÊèêÁ§∫ËØçÂíåÁî®Êà∑ÊèêÁ§∫ËØçÊ®°Êùø</li>
<li><strong>Ê∂àÊÅØÂéÜÂè≤</strong>ÔºöÊîØÊåÅÊ∂àÊÅØÂéÜÂè≤ÁÆ°ÁêÜ</li>
<li><strong>ÊµÅÂºèËæìÂá∫</strong>ÔºöÂéüÁîüÊîØÊåÅÊµÅÂºèÂ§ÑÁêÜ</li>
<li><strong>ÂèÇÊï∞Ê∏≤Êüì</strong>ÔºöÊîØÊåÅÂä®ÊÄÅÂèÇÊï∞ÊõøÊç¢</li>
</ul>
<h4 id="414-toolnode---Â∑•ÂÖ∑Ë∞ÉÁî®ËäÇÁÇπ">4.1.4 ToolNode - Â∑•ÂÖ∑Ë∞ÉÁî®ËäÇÁÇπ
</h4><p><strong>ToolNodeÊòØÂ∑•‰ΩúÊµÅÁöÑ‰∏áËÉΩÂ∑•ÂÖ∑ÁÆ±</strong>ÔºåÂÆÉËÆ©AIËÉΩÂ§üË∞ÉÁî®Â§ñÈÉ®Â∑•ÂÖ∑ÂíåAPIÔºåÊûÅÂ§ßÂú∞Êâ©Â±ï‰∫ÜAIÁöÑËÉΩÂäõËæπÁïå„ÄÇToolNode‰∏ç‰ªÖËÉΩÊâßË°åÂçï‰∏™Â∑•ÂÖ∑Ë∞ÉÁî®ÔºåËøòËÉΩÂπ∂Ë°åÊâßË°åÂ§ö‰∏™Â∑•ÂÖ∑ÔºåÊòæËëóÊèêÈ´ò‰∫ÜÂ§ÑÁêÜÊïàÁéá„ÄÇ</p>
<p><strong>Ê†∏ÂøÉ‰ª∑ÂÄº</strong>ÔºöToolNodeÂ∞ÜAI‰ªéÁ∫ØÊñáÊú¨ÁîüÊàêÊâ©Â±ïÂà∞‰∫ÜÂÆûÈôÖÁöÑË°åÂä®ËÉΩÂäõÔºåËÆ©AIËÉΩÂ§üÊü•ËØ¢Êï∞ÊçÆÂ∫ì„ÄÅË∞ÉÁî®API„ÄÅÊâßË°åËÆ°ÁÆóÁ≠âÔºåÁúüÊ≠£ÂÆûÁé∞‰∫ÜAI AgentÁöÑÊ¶ÇÂøµ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sequenceDiagram
</span></span><span class="line"><span class="cl">    participant TN as ToolNode
</span></span><span class="line"><span class="cl">    participant State as OverAllState
</span></span><span class="line"><span class="cl">    participant AM as AssistantMessage
</span></span><span class="line"><span class="cl">    participant TC as ToolCallback
</span></span><span class="line"><span class="cl">    participant TR as ToolResponse
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    TN-&gt;&gt;State: Ëé∑Âèñllm_responseÊàñmessages
</span></span><span class="line"><span class="cl">    State--&gt;&gt;TN: ËøîÂõûAssistantMessage
</span></span><span class="line"><span class="cl">    TN-&gt;&gt;AM: Ê£ÄÊü•ÊòØÂê¶ÊúâÂ∑•ÂÖ∑Ë∞ÉÁî®
</span></span><span class="line"><span class="cl">    AM--&gt;&gt;TN: ËøîÂõûToolCallÂàóË°®
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    loop ÈÅçÂéÜÊØè‰∏™ToolCall
</span></span><span class="line"><span class="cl">        TN-&gt;&gt;TC: ÊâßË°åÂ∑•ÂÖ∑Ë∞ÉÁî®
</span></span><span class="line"><span class="cl">        TC--&gt;&gt;TN: ËøîÂõûÂ∑•ÂÖ∑ÁªìÊûú
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    TN-&gt;&gt;TR: ÊûÑÂª∫ToolResponseMessage
</span></span><span class="line"><span class="cl">    TR--&gt;&gt;State: Êõ¥Êñ∞messagesÁä∂ÊÄÅ
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÁÅµÊ¥ªÊÄßËÆæËÆ°</strong>ÔºöToolNodeÊîØÊåÅÂêÑÁßçÁ±ªÂûãÁöÑÂ∑•ÂÖ∑Ë∞ÉÁî®Ôºå‰ªéÁÆÄÂçïÁöÑÂáΩÊï∞Ë∞ÉÁî®Âà∞Â§çÊùÇÁöÑAPIÈõÜÊàêÔºåÈÉΩËÉΩËΩªÊùæÂ§ÑÁêÜÔºåËøôÁßçÁÅµÊ¥ªÊÄßËÆ©AIÂ∫îÁî®ËÉΩÂ§üÈÄÇÂ∫îÂêÑÁßç‰∏öÂä°Âú∫ÊôØ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ToolNode</span><span class="w"> </span><span class="n">toolNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ToolNode</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">toolCallbacks</span><span class="p">(</span><span class="n">toolCallbacks</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">llmResponseKey</span><span class="p">(</span><span class="s">&#34;llm_response&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">outputKey</span><span class="p">(</span><span class="s">&#34;tool_response&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÊâßË°åÊú∫Âà∂Ôºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">OverAllState</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 1. Ëé∑ÂèñÂä©ÊâãÊ∂àÊÅØÔºàÂåÖÂê´Â∑•ÂÖ∑Ë∞ÉÁî®Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">assistantMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">AssistantMessage</span><span class="p">)</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">llmResponseKey</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">orElseGet</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">(</span><span class="s">&#34;messages&#34;</span><span class="p">).</span><span class="na">orElseThrow</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">messages</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">messages</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 2. ÊâßË°åÂ∑•ÂÖ∑Ë∞ÉÁî®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ToolResponseMessage</span><span class="w"> </span><span class="n">toolResponseMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">executeFunction</span><span class="p">(</span><span class="n">assistantMessage</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 3. ËøîÂõûÂ∑•ÂÖ∑ÂìçÂ∫î</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">updatedState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">updatedState</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;messages&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">toolResponseMessage</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StringUtils</span><span class="p">.</span><span class="na">hasLength</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">outputKey</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">updatedState</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">outputKey</span><span class="p">,</span><span class="w"> </span><span class="n">toolResponseMessage</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">updatedState</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="415-knowledgeretrievalnode---Áü•ËØÜÊ£ÄÁ¥¢ËäÇÁÇπ">4.1.5 KnowledgeRetrievalNode - Áü•ËØÜÊ£ÄÁ¥¢ËäÇÁÇπ
</h4><p><strong>KnowledgeRetrievalNodeÊòØÂ∑•‰ΩúÊµÅÁöÑÁü•ËØÜ‰∏ìÂÆ∂</strong>ÔºåÂÆÉËÉΩÂ§ü‰ªéÂ∫ûÂ§ßÁöÑÁü•ËØÜÂ∫ì‰∏≠Âø´ÈÄüÊâæÂà∞‰∏éÈóÆÈ¢òÁõ∏ÂÖ≥ÁöÑ‰ø°ÊÅØÔºå‰∏∫AIÊèê‰æõÂáÜÁ°ÆÁöÑËÉåÊôØÁü•ËØÜ„ÄÇËøô‰∏™ËäÇÁÇπÁªìÂêà‰∫ÜÂêëÈáèÊ£ÄÁ¥¢ÂíåÈáçÊéíÂ∫èÊäÄÊúØÔºåÁ°Æ‰øùÊ£ÄÁ¥¢ÁªìÊûúÁöÑÂáÜÁ°ÆÊÄßÂíåÁõ∏ÂÖ≥ÊÄß„ÄÇ</p>
<p><strong>ÊäÄÊúØ‰ºòÂäø</strong>ÔºöKnowledgeRetrievalNodeÈááÁî®‰∫ÜÂÖàËøõÁöÑRAGÔºàÊ£ÄÁ¥¢Â¢ûÂº∫ÁîüÊàêÔºâÊäÄÊúØÔºåÈÄöËøáÂêëÈáèÁõ∏‰ººÂ∫¶ËÆ°ÁÆóÊâæÂà∞Áõ∏ÂÖ≥ÊñáÊ°£ÔºåÂÜçÈÄöËøáÈáçÊéíÂ∫èÊ®°ÂûãËøõ‰∏ÄÊ≠•‰ºòÂåñÁªìÊûúË¥®ÈáèÔºåËøôÁßç‰∏§Èò∂ÊÆµÁöÑËÆæËÆ°Á°Æ‰øù‰∫ÜÊ£ÄÁ¥¢ÁöÑÁ≤æÂáÜÊÄß„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart TD
</span></span><span class="line"><span class="cl">    A[KnowledgeRetrievalNodeÊâßË°å] --&gt; B[Ëé∑ÂèñÊü•ËØ¢ÊñáÊú¨]
</span></span><span class="line"><span class="cl">    B --&gt; C[ÂêëÈáèÊ£ÄÁ¥¢]
</span></span><span class="line"><span class="cl">    C --&gt; D[Áõ∏‰ººÂ∫¶ËøáÊª§]
</span></span><span class="line"><span class="cl">    D --&gt; E{ÂêØÁî®ÈáçÊéíÂ∫è?}
</span></span><span class="line"><span class="cl">    E --&gt;|ÊòØ| F[Ë∞ÉÁî®ÈáçÊéíÂ∫èÊ®°Âûã]
</span></span><span class="line"><span class="cl">    E --&gt;|Âê¶| G[Áõ¥Êé•ËøîÂõûÁªìÊûú]
</span></span><span class="line"><span class="cl">    F --&gt; H[ÈáçÊéíÂ∫èÁªìÊûú]
</span></span><span class="line"><span class="cl">    H --&gt; I[ÊûÑÂª∫Ê£ÄÁ¥¢ÁªìÊûú]
</span></span><span class="line"><span class="cl">    G --&gt; I
</span></span><span class="line"><span class="cl">    I --&gt; J[Êõ¥Êñ∞Áä∂ÊÄÅ]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;Ê£ÄÁ¥¢ÈÖçÁΩÆ&#34;
</span></span><span class="line"><span class="cl">        K[topK: ËøîÂõûÊï∞Èáè]
</span></span><span class="line"><span class="cl">        L[similarityThreshold: Áõ∏‰ººÂ∫¶ÈòàÂÄº]
</span></span><span class="line"><span class="cl">        M[enableRanker: ÊòØÂê¶ÈáçÊéíÂ∫è]
</span></span><span class="line"><span class="cl">        N[rerankModel: ÈáçÊéíÂ∫èÊ®°Âûã]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    C --&gt; K
</span></span><span class="line"><span class="cl">    D --&gt; L
</span></span><span class="line"><span class="cl">    F --&gt; M
</span></span><span class="line"><span class="cl">    F --&gt; N
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Â∫îÁî®‰ª∑ÂÄº</strong>ÔºöKnowledgeRetrievalNodeËÆ©AIËÉΩÂ§üÂü∫‰∫é‰ºÅ‰∏öÁöÑÁßÅÊúâÁü•ËØÜÂ∫ìÂõûÁ≠îÈóÆÈ¢òÔºåËøôÂØπ‰∫éÊûÑÂª∫‰ºÅ‰∏öÁ∫ßAIÂä©Êâã„ÄÅÊô∫ËÉΩÂÆ¢ÊúçÁ≠âÂ∫îÁî®ÂÖ∑ÊúâÈáçË¶ÅÊÑè‰πâ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">KnowledgeRetrievalNode</span><span class="w"> </span><span class="n">retrievalNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KnowledgeRetrievalNode</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">vectorStore</span><span class="p">(</span><span class="n">vectorStore</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">userPromptKey</span><span class="p">(</span><span class="s">&#34;query&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">topK</span><span class="p">(</span><span class="n">5</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">similarityThreshold</span><span class="p">(</span><span class="n">0</span><span class="p">.</span><span class="na">7</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">enableRanker</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">rerankModel</span><span class="p">(</span><span class="n">rerankModel</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">outputKey</span><span class="p">(</span><span class="s">&#34;retrieved_docs&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="42-È¢ÑÂÆö‰πâagentÁ±ªÂûã">4.2 È¢ÑÂÆö‰πâAgentÁ±ªÂûã
</h3><h4 id="421-reactagent---ÂèçÂ∫îÂºèagent">4.2.1 ReactAgent - ÂèçÂ∫îÂºèAgent
</h4><p><strong>ReactAgentÊòØÂ∑•‰ΩúÊµÅÁöÑÊô∫ËÉΩÂÜ≥Á≠ñËÄÖ</strong>ÔºåÂÆÉÂÆûÁé∞‰∫ÜÁªèÂÖ∏ÁöÑReActÔºàReasoning and ActingÔºâÊ®°ÂºèÔºåËÉΩÂ§üÊ†πÊçÆÂΩìÂâçÊÉÖÂÜµÂä®ÊÄÅÂÜ≥ÂÆöÊòØÂê¶ÈúÄË¶ÅË∞ÉÁî®Â∑•ÂÖ∑„ÄÇReactAgentÂ∞±ÂÉè‰∏Ä‰∏™ÊúâÁªèÈ™åÁöÑÂä©ÊâãÔºåÁü•ÈÅì‰ªÄ‰πàÊó∂ÂÄôÈúÄË¶ÅÊü•Êâæ‰ø°ÊÅØÔºå‰ªÄ‰πàÊó∂ÂÄôÂèØ‰ª•Áõ¥Êé•ÂõûÁ≠î„ÄÇ</p>
<p><strong>Ê†∏ÂøÉÊÄùÊÉ≥</strong>ÔºöReactAgentÂ∞ÜÊé®ÁêÜÂíåË°åÂä®ÁªìÂêàÂú®‰∏ÄËµ∑ÔºåËÆ©AI‰∏ç‰ªÖËÉΩÊÄùËÄÉÔºåËøòËÉΩË°åÂä®„ÄÇËøôÁßçËÆæËÆ°ËÆ©AIÂÖ∑Â§á‰∫ÜËß£ÂÜ≥Â§çÊùÇÈóÆÈ¢òÁöÑËÉΩÂäõÔºåËÉΩÂ§üÈÄöËøáÂ§öËΩÆÊé®ÁêÜÂíåÂ∑•ÂÖ∑Ë∞ÉÁî®Êù•ÂÆåÊàêÂ§çÊùÇ‰ªªÂä°„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">stateDiagram-v2
</span></span><span class="line"><span class="cl">    [*] --&gt; START
</span></span><span class="line"><span class="cl">    START --&gt; LLM: ÂºÄÂßãÊé®ÁêÜ
</span></span><span class="line"><span class="cl">    LLM --&gt; Think: ÂàÜÊûêÊòØÂê¶ÈúÄË¶ÅÂ∑•ÂÖ∑
</span></span><span class="line"><span class="cl">    Think --&gt; Tool: ÈúÄË¶ÅÂ∑•ÂÖ∑
</span></span><span class="line"><span class="cl">    Think --&gt; END: ‰∏çÈúÄË¶ÅÂ∑•ÂÖ∑
</span></span><span class="line"><span class="cl">    Tool --&gt; LLM: Â∑•ÂÖ∑ÊâßË°åÂÆåÊàê
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    note right of Think
</span></span><span class="line"><span class="cl">        Ê£ÄÊü•AssistantMessage
</span></span><span class="line"><span class="cl">        ÊòØÂê¶ÂåÖÂê´ToolCalls
</span></span><span class="line"><span class="cl">    end note
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    note right of Tool
</span></span><span class="line"><span class="cl">        ÊâßË°åÂ∑•ÂÖ∑Ë∞ÉÁî®
</span></span><span class="line"><span class="cl">        Ëé∑ÂèñÂ§ñÈÉ®‰ø°ÊÅØ
</span></span><span class="line"><span class="cl">    end note
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Êô∫ËÉΩÂæ™ÁéØ</strong>ÔºöReactAgentÁöÑÊâßË°åËøáÁ®ãÊòØ‰∏Ä‰∏™Êô∫ËÉΩÂæ™ÁéØÔºåÊØèÊ¨°Âæ™ÁéØÈÉΩ‰ºöËØÑ‰º∞ÂΩìÂâçÁä∂ÊÄÅÔºåÂÜ≥ÂÆö‰∏ã‰∏ÄÊ≠•Ë°åÂä®ÔºåËøôÁßçËÆæËÆ°ËÆ©AIËÉΩÂ§üÂ§ÑÁêÜÂêÑÁßçÂ§çÊùÇÂíåÂä®ÊÄÅÁöÑ‰ªªÂä°Âú∫ÊôØ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ReactAgent</span><span class="w"> </span><span class="n">reactAgent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReactAgent</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;weatherAgent&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">chatClient</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">toolCallbacks</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">10</span><span class="w">  </span><span class="c1">// ÊúÄÂ§ßËø≠‰ª£Ê¨°Êï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ÁºñËØëÂπ∂‰ΩøÁî®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">CompiledGraph</span><span class="w"> </span><span class="n">compiledGraph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reactAgent</span><span class="p">.</span><span class="na">getAndCompileGraph</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÂÜÖÈÉ®ÂõæÁªìÊûÑÊûÑÂª∫Ôºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="n">StateGraph</span><span class="w"> </span><span class="nf">initGraph</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">GraphStateException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">StateGraph</span><span class="w"> </span><span class="n">graph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StateGraph</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">keyStrategyFactory</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ê∑ªÂä†Ê†∏ÂøÉËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">graph</span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;llm&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">llmNode</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">graph</span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;tool&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">toolNode</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÊûÑÂª∫ÊâßË°åÊµÅÁ®ã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">graph</span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;llm&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="p">.</span><span class="na">addConditionalEdges</span><span class="p">(</span><span class="s">&#34;llm&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">edge_async</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">think</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;continue&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;tool&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;end&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">END</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;tool&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;llm&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">graph</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ÂÜ≥Á≠ñÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">think</span><span class="p">(</span><span class="n">OverAllState</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iterations</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">max_iterations</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;end&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">(</span><span class="s">&#34;messages&#34;</span><span class="p">).</span><span class="na">orElseThrow</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">AssistantMessage</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">AssistantMessage</span><span class="p">)</span><span class="w"> </span><span class="n">messages</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">messages</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ê£ÄÊü•ÊòØÂê¶ÊúâÂ∑•ÂÖ∑Ë∞ÉÁî®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">hasToolCalls</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&#34;continue&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">&#34;end&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="422-reflectagent---ÂèçÊÄùagent">4.2.2 ReflectAgent - ÂèçÊÄùAgent
</h4><p><strong>ReflectAgentÊòØÂ∑•‰ΩúÊµÅÁöÑË¥®ÈáèÁõëÁù£ËÄÖ</strong>ÔºåÂÆÉÂÆûÁé∞‰∫ÜÂèçÊÄùÊ®°ÂºèÔºåËÉΩÂ§üÂØπËá™Â∑±ÁöÑËæìÂá∫ËøõË°åËØÑ‰º∞ÂíåÊîπËøõ„ÄÇReflectAgentÂ∞±ÂÉè‰∏Ä‰∏™‰∏•Ê†ºÁöÑÁºñËæëÔºå‰ºöÂèçÂ§çÊ£ÄÊü•Âíå‰øÆÊîπÂÜÖÂÆπÔºåÁõ¥Âà∞ËææÂà∞Êª°ÊÑèÁöÑË¥®ÈáèÊ†áÂáÜ„ÄÇ</p>
<p><strong>Ëá™ÊàëÊîπËøõÊú∫Âà∂</strong>ÔºöReflectAgentÈááÁî®‰∫ÜÂèåËäÇÁÇπÂçè‰ΩúÁöÑËÆæËÆ°Ôºå‰∏Ä‰∏™ËäÇÁÇπË¥üË¥£ÁîüÊàêÂÜÖÂÆπÔºåÂè¶‰∏Ä‰∏™ËäÇÁÇπË¥üË¥£ËØÑ‰º∞Ë¥®ÈáèÔºåÈÄöËøáÂ§öËΩÆËø≠‰ª£‰∏çÊñ≠ÊèêÂçáËæìÂá∫Ë¥®Èáè„ÄÇËøôÁßçËÆæËÆ°ËÆ©AIÂÖ∑Â§á‰∫ÜËá™ÊàëÂÆåÂñÑÁöÑËÉΩÂäõ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">graph TD
</span></span><span class="line"><span class="cl">    A[START] --&gt; B[GraphËäÇÁÇπ&lt;br/&gt;ÁîüÊàêÂÜÖÂÆπ]
</span></span><span class="line"><span class="cl">    B --&gt; C[Ê£ÄÊü•Ëø≠‰ª£Ê¨°Êï∞]
</span></span><span class="line"><span class="cl">    C --&gt; D{ËææÂà∞ÊúÄÂ§ßËø≠‰ª£?}
</span></span><span class="line"><span class="cl">    D --&gt;|ÊòØ| E[END]
</span></span><span class="line"><span class="cl">    D --&gt;|Âê¶| F[ReflectionËäÇÁÇπ&lt;br/&gt;ËØÑ‰º∞Ë¥®Èáè]
</span></span><span class="line"><span class="cl">    F --&gt; G[Ê£ÄÊü•ÊúÄÂêéÊ∂àÊÅØÁ±ªÂûã]
</span></span><span class="line"><span class="cl">    G --&gt; H{ÊòØÁî®Êà∑Ê∂àÊÅØ?}
</span></span><span class="line"><span class="cl">    H --&gt;|ÊòØ| B
</span></span><span class="line"><span class="cl">    H --&gt;|Âê¶| E
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;ÂèçÊÄùÂæ™ÁéØ&#34;
</span></span><span class="line"><span class="cl">        I[ÁîüÊàêÂàùÂßãÂÜÖÂÆπ]
</span></span><span class="line"><span class="cl">        J[ÂèçÊÄùËØÑ‰º∞]
</span></span><span class="line"><span class="cl">        K[Âü∫‰∫éÂèçÊÄùÊîπËøõ]
</span></span><span class="line"><span class="cl">        L[ÈáçÂ§çÁõ¥Âà∞Êª°ÊÑè]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    B --&gt; I
</span></span><span class="line"><span class="cl">    F --&gt; J
</span></span><span class="line"><span class="cl">    B --&gt; K
</span></span><span class="line"><span class="cl">    G --&gt; L
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ë¥®Èáè‰øùËØÅ</strong>ÔºöReflectAgentÁâπÂà´ÈÄÇÂêàÂØπËæìÂá∫Ë¥®ÈáèË¶ÅÊ±ÇËæÉÈ´òÁöÑÂú∫ÊôØÔºåÂ¶ÇÊñáÊ°£ÂÜô‰Ωú„ÄÅ‰ª£Á†ÅÁîüÊàê„ÄÅÂàõÊÑèÂÜÖÂÆπÁ≠âÔºåÈÄöËøáÂèçÊÄùÊú∫Âà∂Á°Æ‰øùÊúÄÁªàËæìÂá∫ÁöÑË¥®Èáè„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ReflectAgent</span><span class="w"> </span><span class="n">reflectAgent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReflectAgent</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">graph</span><span class="p">(</span><span class="n">assistantGraphNode</span><span class="p">)</span><span class="w">      </span><span class="c1">// ÁîüÊàêËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">reflection</span><span class="p">(</span><span class="n">judgeGraphNode</span><span class="p">)</span><span class="w">     </span><span class="c1">// ËØÑÂà§ËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">maxIterations</span><span class="p">(</span><span class="n">3</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÊâßË°åÊµÅÁ®ãËØ¶Ëß£Ôºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">StateGraph</span><span class="w"> </span><span class="nf">createReflectionGraph</span><span class="p">(</span><span class="n">NodeAction</span><span class="w"> </span><span class="n">graph</span><span class="p">,</span><span class="w"> </span><span class="n">NodeAction</span><span class="w"> </span><span class="n">reflection</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxIterations</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">StateGraph</span><span class="w"> </span><span class="n">stateGraph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StateGraph</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="o">&gt;</span><span class="w"> </span><span class="n">keyStrategyHashMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">keyStrategyHashMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">MESSAGES</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">keyStrategyHashMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ITERATION_NUM</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">keyStrategyHashMap</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="n">GRAPH_NODE_ID</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">graph</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="n">REFLECTION_NODE_ID</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">reflection</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span><span class="w"> </span><span class="n">GRAPH_NODE_ID</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addConditionalEdges</span><span class="p">(</span><span class="n">GRAPH_NODE_ID</span><span class="p">,</span><span class="w"> </span><span class="n">edge_async</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">graphCount</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">REFLECTION_NODE_ID</span><span class="p">,</span><span class="w"> </span><span class="n">REFLECTION_NODE_ID</span><span class="p">,</span><span class="w"> </span><span class="n">END</span><span class="p">,</span><span class="w"> </span><span class="n">END</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addConditionalEdges</span><span class="p">(</span><span class="n">REFLECTION_NODE_ID</span><span class="p">,</span><span class="w"> </span><span class="n">edge_async</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">apply</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">GRAPH_NODE_ID</span><span class="p">,</span><span class="w"> </span><span class="n">GRAPH_NODE_ID</span><span class="p">,</span><span class="w"> </span><span class="n">END</span><span class="p">,</span><span class="w"> </span><span class="n">END</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">stateGraph</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Ëø≠‰ª£Ê¨°Êï∞Ê£ÄÊü•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">graphCount</span><span class="p">(</span><span class="n">OverAllState</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">iterationNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">(</span><span class="n">ITERATION_NUM</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">orElse</span><span class="p">(</span><span class="n">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">state</span><span class="p">.</span><span class="na">updateState</span><span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">ITERATION_NUM</span><span class="p">,</span><span class="w"> </span><span class="n">iterationNum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">iterationNum</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">maxIterations</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">REFLECTION_NODE_ID</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Ê∂àÊÅØÁ±ªÂûãÊ£ÄÊü•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">OverAllState</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">(</span><span class="n">MESSAGES</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">orElse</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">messages</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">END</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Message</span><span class="w"> </span><span class="n">lastMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">messages</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">messages</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lastMessage</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">UserMessage</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">GRAPH_NODE_ID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">END</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="423-reactagentwithhuman---‰∫∫Êú∫Âçè‰Ωúagent">4.2.3 ReactAgentWithHuman - ‰∫∫Êú∫Âçè‰ΩúAgent
</h4><p><strong>ReactAgentWithHumanÊòØÂ∑•‰ΩúÊµÅÁöÑ‰∫∫Êú∫Âçè‰Ωú‰∏ìÂÆ∂</strong>ÔºåÂÆÉÂú®ReactAgentÁöÑÂü∫Á°Ä‰∏äÂ¢ûÂä†‰∫Ü‰∫∫Â∑•Âπ≤È¢ÑËÉΩÂäõÔºåËÆ©AIÂíå‰∫∫Á±ªËÉΩÂ§üÂçè‰ΩúÂÆåÊàêÂ§çÊùÇ‰ªªÂä°„ÄÇËøôÁßçËÆæËÆ°ÁâπÂà´ÈÄÇÂêàÈúÄË¶Å‰∫∫Â∑•ÂÆ°Ê†∏„ÄÅÂÜ≥Á≠ñÁ°ÆËÆ§Êàñ‰∏ì‰∏öÂà§Êñ≠ÁöÑÂú∫ÊôØ„ÄÇ</p>
<p><strong>Âçè‰ΩúÊú∫Âà∂</strong>ÔºöReactAgentWithHumanÂÜÖÁΩÆ‰∫ÜÂÆåÂñÑÁöÑ‰∏≠Êñ≠ÂíåÊÅ¢Â§çÊú∫Âà∂ÔºåÂΩìÈÅáÂà∞ÈúÄË¶Å‰∫∫Â∑•Âπ≤È¢ÑÁöÑÊÉÖÂÜµÊó∂ÔºåÁ≥ªÁªü‰ºöËá™Âä®ÊöÇÂÅúÊâßË°åÔºåÁ≠âÂæÖ‰∫∫Â∑•Â§ÑÁêÜÔºåÁÑ∂ÂêéÊó†ÁºùÊÅ¢Â§çÊâßË°å„ÄÇËøôÁßçËÆæËÆ°ËÆ©‰∫∫Êú∫Âçè‰ΩúÂèòÂæóËá™ÁÑ∂ËÄåÊµÅÁïÖ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart TD
</span></span><span class="line"><span class="cl">    A[START] --&gt; B[AgentËäÇÁÇπ&lt;br/&gt;LLMÊé®ÁêÜ]
</span></span><span class="line"><span class="cl">    B --&gt; C[HumanËäÇÁÇπ&lt;br/&gt;‰∫∫Â∑•Ê£ÄÊü•]
</span></span><span class="line"><span class="cl">    C --&gt; D{‰∫∫Â∑•ÂÜ≥Á≠ñ}
</span></span><span class="line"><span class="cl">    D --&gt;|ÁªßÁª≠Agent| B
</span></span><span class="line"><span class="cl">    D --&gt;|Ë∞ÉÁî®Â∑•ÂÖ∑| E[ToolËäÇÁÇπ&lt;br/&gt;Â∑•ÂÖ∑ÊâßË°å]
</span></span><span class="line"><span class="cl">    D --&gt;|ÁªìÊùü| F[END]
</span></span><span class="line"><span class="cl">    E --&gt; B
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;HumanËäÇÁÇπÈÄªËæë&#34;
</span></span><span class="line"><span class="cl">        G[Ê£ÄÊü•‰∏≠Êñ≠Êù°‰ª∂]
</span></span><span class="line"><span class="cl">        H[Á≠âÂæÖ‰∫∫Â∑•ÂèçÈ¶à]
</span></span><span class="line"><span class="cl">        I[Ê†πÊçÆÂèçÈ¶àÂÜ≥Á≠ñ]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    C --&gt; G
</span></span><span class="line"><span class="cl">    C --&gt; H
</span></span><span class="line"><span class="cl">    C --&gt; I
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;‰∏≠Êñ≠ÊÅ¢Â§çÊú∫Âà∂&#34;
</span></span><span class="line"><span class="cl">        J[‰øùÂ≠òÁä∂ÊÄÅÂø´ÁÖß]
</span></span><span class="line"><span class="cl">        K[Á≠âÂæÖ‰∫∫Â∑•Â§ÑÁêÜ]
</span></span><span class="line"><span class="cl">        L[Âä†ËΩΩÁä∂ÊÄÅÊÅ¢Â§ç]
</span></span><span class="line"><span class="cl">        M[ÁªßÁª≠ÊâßË°å]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    H --&gt; J
</span></span><span class="line"><span class="cl">    J --&gt; K
</span></span><span class="line"><span class="cl">    K --&gt; L
</span></span><span class="line"><span class="cl">    L --&gt; M
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>‰∫∫Êú∫Âçè‰ΩúÂÆûÁé∞Ôºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="n">StateGraph</span><span class="w"> </span><span class="nf">initGraph</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">GraphStateException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">StateGraph</span><span class="w"> </span><span class="n">graph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StateGraph</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">keyStrategyFactory</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;agent&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">llmNode</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;human&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">humanNode</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;tool&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">toolNode</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;agent&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;agent&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;human&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">addConditionalEdges</span><span class="p">(</span><span class="s">&#34;human&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">edge_async</span><span class="p">(</span><span class="n">humanNode</span><span class="p">::</span><span class="n">think</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;agent&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;agent&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;tool&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;tool&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;end&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">END</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;tool&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;agent&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">graph</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// HumanNodeÁöÑÂÜ≥Á≠ñÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">think</span><span class="p">(</span><span class="n">OverAllState</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶Å‰∏≠Êñ≠</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">shouldInterruptFunc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">shouldInterruptFunc</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">state</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ËÆæÁΩÆ‰∏≠Êñ≠Ê∂àÊÅØÔºåÁ≠âÂæÖ‰∫∫Â∑•Â§ÑÁêÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">state</span><span class="p">.</span><span class="na">setInterruptMessage</span><span class="p">(</span><span class="s">&#34;Á≠âÂæÖ‰∫∫Â∑•ÂÆ°Êâπ&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;human_interrupt&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÂ∑•ÂÖ∑Ë∞ÉÁî®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">(</span><span class="s">&#34;messages&#34;</span><span class="p">).</span><span class="na">orElse</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">messages</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Message</span><span class="w"> </span><span class="n">lastMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">messages</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">messages</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lastMessage</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">AssistantMessage</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">((</span><span class="n">AssistantMessage</span><span class="p">)</span><span class="w"> </span><span class="n">lastMessage</span><span class="p">).</span><span class="na">hasToolCalls</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;tool&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;agent&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="5-È´òÁ∫ßÁâπÊÄß‰∏éÊâ©Â±ïËÉΩÂäõ">5. È´òÁ∫ßÁâπÊÄß‰∏éÊâ©Â±ïËÉΩÂäõ
</h2><h3 id="51-ÂèØËßÇÊµãÊÄß">5.1 ÂèØËßÇÊµãÊÄß
</h3><p>Spring AI Alibaba GraphÊèê‰æõ‰∫Ü‰ºÅ‰∏öÁ∫ßÁöÑÂÖ®ÈìæË∑ØËßÇÊµãËÉΩÂäõÔºåÂü∫‰∫éOpenTelemetryÂíåMicrometerÊ†áÂáÜÔºåÂÆûÁé∞‰∫Ü‰ªéGraphÊâßË°åÂà∞Ê®°ÂûãË∞ÉÁî®ÁöÑÂÆåÊï¥ËøΩË∏™„ÄÇ</p>
<h4 id="511-Ê†∏ÂøÉÁâπÊÄß">5.1.1 Ê†∏ÂøÉÁâπÊÄß
</h4><ul>
<li><strong>ÂÖ®ÈìæË∑ØÂèØËßÇÊµã</strong>ÔºöÂÆûÊó∂ËøΩË∏™ÊØè‰∏™ËäÇÁÇπÁöÑËæìÂÖ•„ÄÅËæìÂá∫ÂíåÁä∂ÊÄÅÂèòÂåñ</li>
<li><strong>ÊµÅÂºèÊï∞ÊçÆÈááÈõÜ</strong>ÔºöÊîØÊåÅÂºÇÊ≠•„ÄÅÂπ∂Ë°å„ÄÅÊµÅÂºèËäÇÁÇπÁöÑËßÇÊµã</li>
<li><strong>ÂºÇÂ∏∏Ê∫ØÊ∫ê</strong>ÔºöÂø´ÈÄüÂÆö‰ΩçÂºÇÂ∏∏ËäÇÁÇπÂíåÊï∞ÊçÆ</li>
<li><strong>Â§öÂπ≥Âè∞ÊîØÊåÅ</strong>ÔºöÂÖºÂÆπLangfuse„ÄÅJaeger„ÄÅZipkin„ÄÅPrometheusÁ≠â‰∏ªÊµÅÂπ≥Âè∞</li>
</ul>
<h4 id="512-Âø´ÈÄüÊé•ÂÖ•">5.1.2 Âø´ÈÄüÊé•ÂÖ•
</h4><p><strong>‰ΩøÁî®ËßÇÊµãÊÄßStarter</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud.ai<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-ai-alibaba-starter-graph-observation<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>${spring-ai-alibaba.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">CompiledGraph</span><span class="w"> </span><span class="nf">compiledGraph</span><span class="p">(</span><span class="n">StateGraph</span><span class="w"> </span><span class="n">observabilityGraph</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                                  </span><span class="n">CompileConfig</span><span class="w"> </span><span class="n">observationCompileConfig</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">GraphStateException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">observabilityGraph</span><span class="p">.</span><span class="na">compile</span><span class="p">(</span><span class="n">observationCompileConfig</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="513-ËØ¶ÁªÜÊñáÊ°£">5.1.3 ËØ¶ÁªÜÊñáÊ°£
</h4><p>ÂÖ≥‰∫éSpring AI Alibaba GraphËßÇÊµãÊÄßÁöÑÂÆåÊï¥Êû∂ÊûÑËÆæËÆ°„ÄÅÂÆûÁé∞ÂéüÁêÜ„ÄÅÈÖçÁΩÆÊñπÂºè„ÄÅÊúÄ‰Ω≥ÂÆûË∑µÁ≠âËØ¶ÁªÜÂÜÖÂÆπÔºåËØ∑ÂèÇËÄÉÂÆòÊñπËßÇÊµãÊÄßÊñáÊ°£Ôºö</p>
<p><strong>üìö GraphËßÇÊµãÊÄßÂÆåÊï¥ÊåáÂçó</strong>Ôºö<a class="link" href="https://www.yuque.com/disaster-4qc4i/xhs01z/qrh6lv7m3sexgvr4"  target="_blank" rel="noopener"
    >Spring AI Alibaba GraphËßÇÊµãÊÄßËÆæËÆ°‰∏éÂÆûÁé∞</a></p>
<p>ËØ•ÊñáÊ°£Ê∂µÁõñÔºö</p>
<ul>
<li>ËßÇÊµãÊÄßËÆæËÆ°ÁêÜÂøµ‰∏éÊû∂ÊûÑ</li>
<li>Âπ∂Ë°å‰∏éÊµÅÂºèËßÇÊµãÂÆûÁé∞</li>
<li>Â§öÂπ≥Âè∞ÈõÜÊàêÈÖçÁΩÆ</li>
<li>LangfuseÁ≠âÂèØËßÜÂåñÂπ≥Âè∞‰ΩøÁî®</li>
<li>ÊúÄ‰Ω≥ÂÆûË∑µ‰∏éÊâ©Â±ïÂª∫ËÆÆ</li>
</ul>
<p><strong>üîó ÂÆåÊï¥Á§∫‰æã‰ª£Á†Å</strong>Ôºö<a class="link" href="https://github.com/springaialibaba/spring-ai-alibaba-examples/tree/main/spring-ai-alibaba-graph-example/graph-observability-langfuse"  target="_blank" rel="noopener"
    >graph-observability-langfuse</a></p>
<h3 id="52-Âπ∂Ë°åËäÇÁÇπ‰∏éÊµÅÂºèÂ§ÑÁêÜ">5.2 Âπ∂Ë°åËäÇÁÇπ‰∏éÊµÅÂºèÂ§ÑÁêÜ
</h3><h4 id="521-Âπ∂Ë°åËäÇÁÇπÁöÑ‰∏§ÁßçÂàõÂª∫ÊñπÂºè">5.2.1 Âπ∂Ë°åËäÇÁÇπÁöÑ‰∏§ÁßçÂàõÂª∫ÊñπÂºè
</h4><p><strong>Spring AI Alibaba GraphÊèê‰æõ‰∫Ü‰∏§ÁßçÂàõÂª∫Âπ∂Ë°åËäÇÁÇπÁöÑÊñπÂºè</strong>ÔºåËøô‰∏§ÁßçÊñπÂºèÂú®Â∫ïÂ±ÇÂÆûÁé∞‰∏äÊúâÊâÄ‰∏çÂêåÔºå‰ΩÜÈÉΩËÉΩÂÆûÁé∞Âπ∂Ë°åÂ§ÑÁêÜÁöÑÊïàÊûú„ÄÇ</p>
<h5 id="ÊñπÂºè‰∏ÄÁõ¥Êé•ÂàõÂª∫parallelnode">ÊñπÂºè‰∏ÄÔºöÁõ¥Êé•ÂàõÂª∫ParallelNode
</h5><p>Áõ¥Êé•ÂàõÂª∫‰∏Ä‰∏™ParallelNodeÂÆû‰æãÔºåÂπ∂Â∞ÜÂÖ∂Ê≥®ÂÜåÂà∞StateGraph‰∏≠Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÂàõÂª∫Âπ∂Ë°å‰ªªÂä°ÂàóË°®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">AsyncNodeActionWithConfig</span><span class="o">&gt;</span><span class="w"> </span><span class="n">parallelActions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">node_async</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">DataProcessingNode1</span><span class="p">()),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">node_async</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">DataProcessingNode2</span><span class="p">()),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">node_async</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">DataProcessingNode3</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ÂÆö‰πâÁä∂ÊÄÅÂêàÂπ∂Á≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="o">&gt;</span><span class="w"> </span><span class="n">channels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;results&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AppendStrategy</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;metadata&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ÂàõÂª∫Âπ∂Ë°åËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ParallelNode</span><span class="w"> </span><span class="n">parallelNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ParallelNode</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;data_processing&#34;</span><span class="p">,</span><span class="w">           </span><span class="c1">// ËäÇÁÇπÂÜÖÈÉ®ID  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">parallelActions</span><span class="p">,</span><span class="w">            </span><span class="c1">// Âπ∂Ë°å‰ªªÂä°ÂàóË°®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">channels</span><span class="w">                    </span><span class="c1">// KeyStrategyÊò†Â∞Ñ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Ê∑ªÂä†Âà∞StateGraph</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">stateGraph</span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;parallel_tasks&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">parallelNode</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ÊñπÂºè‰∫åÈÄöËøástategraphÊèèËø∞Âπ∂Ë°åËæπ">ÊñπÂºè‰∫åÔºöÈÄöËøáStateGraphÊèèËø∞Âπ∂Ë°åËæπ
</h5><p><strong>ËøôÊòØÊõ¥Â∏∏Áî®ÁöÑÊñπÂºè</strong>ÔºåÈÄöËøáÊ∑ªÂä†Â§ö‰∏™ÊåáÂêëÁõ∏ÂêåÁõÆÊ†áÁöÑËæπÊù•ÂÆö‰πâÂπ∂Ë°åÁªìÊûÑÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">StateGraph</span><span class="w"> </span><span class="n">workflow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StateGraph</span><span class="p">(</span><span class="n">keyStrategyFactory</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;source&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">sourceNode</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;task1&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">task1Node</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;task2&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">task2Node</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;task3&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">task3Node</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;merger&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">mergerNode</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÂàõÂª∫Âπ∂Ë°åÂàÜÊîØ - ‰ªésourceÂà∞Â§ö‰∏™‰ªªÂä°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;source&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;task1&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;source&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;task2&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;source&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;task3&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ê±áËÅöÂà∞mergerËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;task1&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;merger&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;task2&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;merger&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;task3&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;merger&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;source&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;merger&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">END</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÁºñËØëÊó∂ËΩ¨Êç¢Êú∫Âà∂</strong>Ôºö</p>
<p>ÂΩìStateGraphÁºñËØëÊó∂ÔºåÊ°ÜÊû∂‰ºöËá™Âä®Ê£ÄÊµãÂπ∂Ë°åËæπÊ®°ÂºèÔºåÂπ∂Âú®ÂÜÖÈÉ®ÂàõÂª∫ParallelNodeÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// CompiledGraphÁºñËØëËøáÁ®ã‰∏≠ÁöÑÂ§ÑÁêÜÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">targets</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ê£ÄÊµãÂà∞Âπ∂Ë°åËæπÔºåËé∑ÂèñÊâÄÊúâÂπ∂Ë°åÁõÆÊ†áËäÇÁÇπÁöÑAction</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">actions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parallelNodeStream</span><span class="p">.</span><span class="na">get</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">target</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">nodes</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="na">id</span><span class="p">()))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ëá™Âä®ÂàõÂª∫ParallelNode</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">parallelNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ParallelNode</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">sourceId</span><span class="p">(),</span><span class="w"> </span><span class="n">actions</span><span class="p">,</span><span class="w"> </span><span class="n">keyStrategyMap</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÊõøÊç¢ÂéüÊúâËäÇÁÇπÂíåËæπÁöÑÊò†Â∞Ñ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">nodes</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">parallelNode</span><span class="p">.</span><span class="na">id</span><span class="p">(),</span><span class="w"> </span><span class="n">parallelNode</span><span class="p">.</span><span class="na">actionFactory</span><span class="p">().</span><span class="na">apply</span><span class="p">(</span><span class="n">compileConfig</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">edges</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">sourceId</span><span class="p">(),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EdgeValue</span><span class="p">(</span><span class="n">parallelNode</span><span class="p">.</span><span class="na">id</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="522-Âπ∂Ë°åËäÇÁÇπÁöÑÂÜÖÈÉ®ÊâßË°åÊú∫Âà∂">5.2.2 Âπ∂Ë°åËäÇÁÇπÁöÑÂÜÖÈÉ®ÊâßË°åÊú∫Âà∂
</h4><p><strong>ParallelNodeÁöÑÊ†∏ÂøÉÂÆûÁé∞</strong>Âü∫‰∫éCompletableFuture.allOf()ÔºåÂÆûÁé∞ÁúüÊ≠£ÁöÑÂπ∂Ë°åÊâßË°åÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ParallelNode</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">record</span> <span class="nc">AsyncParallelNodeAction</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AsyncNodeActionWithConfig</span><span class="o">&gt;</span><span class="w"> </span><span class="n">actions</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="o">&gt;</span><span class="w"> </span><span class="n">channels</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AsyncNodeActionWithConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">OverAllState</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">RunnableConfig</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">partialMergedStates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">asyncGenerators</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Âπ∂Ë°åÊâßË°åÊâÄÊúâAction</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">actions</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">action</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">partialState</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// ÂàÜÁ¶ªÊôÆÈÄöÁªìÊûúÂíåAsyncGenerator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">partialState</span><span class="p">.</span><span class="na">forEach</span><span class="p">((</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">AsyncGenerator</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">GeneratorSubscriber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="p">((</span><span class="n">List</span><span class="p">)</span><span class="w"> </span><span class="n">asyncGenerators</span><span class="p">.</span><span class="na">computeIfAbsent</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">())).</span><span class="na">add</span><span class="p">(</span><span class="n">value</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">partialMergedStates</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// Á´ãÂç≥Êõ¥Êñ∞Áä∂ÊÄÅ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">state</span><span class="p">.</span><span class="na">updateState</span><span class="p">(</span><span class="n">partialMergedStates</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="n">action</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">toArray</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Á≠âÂæÖÊâÄÊúâ‰ªªÂä°ÂÆåÊàê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">allOf</span><span class="p">(</span><span class="n">futures</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">((</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">CollectionUtils</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">asyncGenerators</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="o">?</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">data</span><span class="p">()</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">:</span><span class="w"> </span><span class="n">asyncGenerators</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="523-Âπ∂Ë°åÊµÅÂºèÂ§ÑÁêÜÁöÑÂêàÂπ∂Êú∫Âà∂">5.2.3 Âπ∂Ë°åÊµÅÂºèÂ§ÑÁêÜÁöÑÂêàÂπ∂Êú∫Âà∂
</h4><p><strong>Ê†∏ÂøÉÊåëÊàò</strong>ÔºöÂΩìÂ§ö‰∏™Âπ∂Ë°åÂàÜÊîØÈÉΩ‰∫ßÁîüÊµÅÂºèËæìÂá∫Êó∂ÔºåÂ¶Ç‰ΩïÂ∞ÜËøô‰∫õÂºÇÊ≠•ÊµÅÂêàÂπ∂ÊàêÁªü‰∏ÄÁöÑËæìÂá∫ÊµÅÔºü</p>
<p>Spring AI Alibaba GraphÈÄöËøá<code>AsyncGeneratorUtils.createMergedGenerator</code>Âú®<strong>Ê°ÜÊû∂ÂÜÖÊ†∏‰∏≠</strong>Ëß£ÂÜ≥‰∫ÜËøô‰∏™Â§çÊùÇÈóÆÈ¢òÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart TD
</span></span><span class="line"><span class="cl">    A[Âπ∂Ë°åËäÇÁÇπÂêØÂä®] --&gt; B[ÂàÜÊîØ1: AsyncGenerator]
</span></span><span class="line"><span class="cl">    A --&gt; C[ÂàÜÊîØ2: AsyncGenerator]
</span></span><span class="line"><span class="cl">    A --&gt; D[ÂàÜÊîØ3: AsyncGenerator]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    B --&gt; E[AsyncGeneratorUtils.createMergedGenerator]
</span></span><span class="line"><span class="cl">    C --&gt; E
</span></span><span class="line"><span class="cl">    D --&gt; E
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    E --&gt; F[ËΩÆËØ¢ÊâÄÊúâGenerator]
</span></span><span class="line"><span class="cl">    F --&gt; G[StampedLockÂπ∂ÂèëÊéßÂà∂]
</span></span><span class="line"><span class="cl">    G --&gt; H[KeyStrategyÁä∂ÊÄÅÂêàÂπ∂]
</span></span><span class="line"><span class="cl">    H --&gt; I[Áªü‰∏ÄËæìÂá∫ÊµÅ]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    subgraph &#34;ÂêàÂπ∂Á≠ñÁï•&#34;
</span></span><span class="line"><span class="cl">        J[ReplaceStrategy&lt;br/&gt;ÊõøÊç¢ÂêàÂπ∂]
</span></span><span class="line"><span class="cl">        K[AppendStrategy&lt;br/&gt;ËøΩÂä†ÂêàÂπ∂]
</span></span><span class="line"><span class="cl">        L[CustomStrategy&lt;br/&gt;Ëá™ÂÆö‰πâÂêàÂπ∂]
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    H --&gt; J
</span></span><span class="line"><span class="cl">    H --&gt; K
</span></span><span class="line"><span class="cl">    H --&gt; L
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="524-mergedgeneratorÊ†∏ÂøÉÂÆûÁé∞">5.2.4 MergedGeneratorÊ†∏ÂøÉÂÆûÁé∞
</h4><p><strong>AsyncGeneratorUtils.createMergedGenerator</strong>ÊòØÊ°ÜÊû∂ÂÜÖÊ†∏ÁöÑÊ†∏ÂøÉÁÆóÊ≥ïÔºåÂÆûÁé∞‰∫ÜÂ§ö‰∏™ÂºÇÊ≠•ÊµÅÁöÑÊô∫ËÉΩÂêàÂπ∂Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AsyncGenerator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createMergedGenerator</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AsyncGenerator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">generators</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="o">&gt;</span><span class="w"> </span><span class="n">keyStrategyMap</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AsyncGenerator</span><span class="o">&lt;&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ‰ΩøÁî®StampedLock‰ºòÂåñÂπ∂ÂèëÊÄßËÉΩ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">StampedLock</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StampedLock</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">AtomicInteger</span><span class="w"> </span><span class="n">pollCounter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AtomicInteger</span><span class="p">(</span><span class="n">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mergedResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AsyncGenerator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">activeGenerators</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CopyOnWriteArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">generators</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">AsyncGenerator</span><span class="p">.</span><span class="na">Data</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">next</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// ‰πêËßÇËØªÈîÅÂø´ÈÄüÊ£ÄÊü•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kt">long</span><span class="w"> </span><span class="n">stamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lock</span><span class="p">.</span><span class="na">tryOptimisticRead</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kt">boolean</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeGenerators</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">lock</span><span class="p">.</span><span class="na">validate</span><span class="p">(</span><span class="n">stamp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">stamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lock</span><span class="p">.</span><span class="na">readLock</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">empty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeGenerators</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">lock</span><span class="p">.</span><span class="na">unlockRead</span><span class="p">(</span><span class="n">stamp</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">empty</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">AsyncGenerator</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">done</span><span class="p">(</span><span class="n">mergedResult</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// ËΩÆËØ¢Á≠ñÁï•ÈÄâÊã©Generator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">final</span><span class="w"> </span><span class="n">AsyncGenerator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">current</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kt">long</span><span class="w"> </span><span class="n">writeStamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lock</span><span class="p">.</span><span class="na">writeLock</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeGenerators</span><span class="p">.</span><span class="na">size</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">AsyncGenerator</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">done</span><span class="p">(</span><span class="n">mergedResult</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">currentIdx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pollCounter</span><span class="p">.</span><span class="na">updateAndGet</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">size</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activeGenerators</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">currentIdx</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">lock</span><span class="p">.</span><span class="na">unlockWrite</span><span class="p">(</span><span class="n">writeStamp</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// Âú®Êó†ÈîÅÁä∂ÊÄÅ‰∏ãÊâßË°åGenerator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">AsyncGenerator</span><span class="p">.</span><span class="na">Data</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current</span><span class="p">.</span><span class="na">next</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// Â§ÑÁêÜÁªìÊûúÂπ∂Êõ¥Êñ∞Áä∂ÊÄÅ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">writeStamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lock</span><span class="p">.</span><span class="na">writeLock</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">activeGenerators</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">current</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">continue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="na">isDone</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="na">isError</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">handleCompletedGenerator</span><span class="p">(</span><span class="n">current</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">activeGenerators</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="k">return</span><span class="w"> </span><span class="n">AsyncGenerator</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">done</span><span class="p">(</span><span class="n">mergedResult</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">continue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">handleCompletedGenerator</span><span class="p">(</span><span class="n">current</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">lock</span><span class="p">.</span><span class="na">unlockWrite</span><span class="p">(</span><span class="n">writeStamp</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleCompletedGenerator</span><span class="p">(</span><span class="n">AsyncGenerator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">generator</span><span class="p">,</span><span class="w"> </span><span class="n">AsyncGenerator</span><span class="p">.</span><span class="na">Data</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// ÁßªÈô§ÂÆåÊàêÁöÑGenerator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="na">isDone</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="na">isError</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">activeGenerators</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">generator</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// ‰ΩøÁî®KeyStrategyÂêàÂπ∂ÁªìÊûú</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">data</span><span class="p">.</span><span class="na">resultValue</span><span class="p">().</span><span class="na">ifPresent</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Map</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mapResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">mergedResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OverAllState</span><span class="p">.</span><span class="na">updateState</span><span class="p">(</span><span class="n">mergedResult</span><span class="p">,</span><span class="w"> </span><span class="n">mapResult</span><span class="p">,</span><span class="w"> </span><span class="n">keyStrategyMap</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ê†∏ÂøÉÁÆóÊ≥ïÁâπÁÇπ</strong>Ôºö</p>
<ul>
<li><strong>ËΩÆËØ¢Êú∫Âà∂</strong>ÔºöÈÄöËøápollCounterÂÆûÁé∞ÂÖ¨Âπ≥ÁöÑËΩÆËØ¢Ë∞ÉÂ∫¶</li>
<li><strong>StampedLock‰ºòÂåñ</strong>Ôºö‰ΩøÁî®‰πêËßÇËØªÈîÅÊèêÈ´òÂπ∂ÂèëÊÄßËÉΩ</li>
<li><strong>Áä∂ÊÄÅÂêàÂπ∂</strong>ÔºöÈÄöËøáKeyStrategyÂÆûÁé∞ÁÅµÊ¥ªÁöÑÁä∂ÊÄÅÂêàÂπ∂Á≠ñÁï•</li>
<li><strong>Á∫øÁ®ãÂÆâÂÖ®</strong>ÔºöCopyOnWriteArrayListÁ°Æ‰øùÂπ∂ÂèëËÆøÈóÆÁöÑÂÆâÂÖ®ÊÄß</li>
</ul>
<h4 id="525-ÊµÅÂºèËæìÂá∫ÈÖçÁΩÆ">5.2.5 ÊµÅÂºèËæìÂá∫ÈÖçÁΩÆ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/stream&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StreamingController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CompiledGraph</span><span class="w"> </span><span class="n">compiledGraph</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;/process&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">produces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MediaType</span><span class="p">.</span><span class="na">TEXT_EVENT_STREAM_VALUE</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">ServerSentEvent</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">processStream</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Flux</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">sink</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">AsyncGenerator</span><span class="o">&lt;</span><span class="n">NodeOutput</span><span class="o">&gt;</span><span class="w"> </span><span class="n">generator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compiledGraph</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;input&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">RunnableConfig</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">threadId</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">build</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">generator</span><span class="p">.</span><span class="na">forEachAsync</span><span class="p">(</span><span class="n">output</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">output</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">StreamingOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">StreamingOutput</span><span class="w"> </span><span class="n">streamingOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">StreamingOutput</span><span class="p">)</span><span class="w"> </span><span class="n">output</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">String</span><span class="w"> </span><span class="n">chunk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">streamingOutput</span><span class="p">.</span><span class="na">chunk</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">sink</span><span class="p">.</span><span class="na">next</span><span class="p">(</span><span class="n">ServerSentEvent</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="n">chunk</span><span class="p">).</span><span class="na">build</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}).</span><span class="na">thenRun</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">sink</span><span class="p">.</span><span class="na">complete</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}).</span><span class="na">exceptionally</span><span class="p">(</span><span class="n">throwable</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">sink</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">throwable</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">sink</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="53-Â≠êÂõæËäÇÁÇπ">5.3 Â≠êÂõæËäÇÁÇπ
</h3><p><strong>Â≠êÂõæËäÇÁÇπÊòØÂ∑•‰ΩúÊµÅÁöÑÊ®°ÂùóÂåñÁªÑ‰ª∂</strong>ÔºåÂÆÉÂÖÅËÆ∏Â∞ÜÂ§çÊùÇÁöÑÂ∑•‰ΩúÊµÅÂàÜËß£‰∏∫ÂèØÈáçÁî®ÁöÑÂ≠êÊ®°Âùó„ÄÇÂ≠êÂõæËäÇÁÇπÂ∞±ÂÉèÂáΩÊï∞Ë∞ÉÁî®‰∏ÄÊ†∑ÔºåÂèØ‰ª•Âú®‰∏ªÂ∑•‰ΩúÊµÅ‰∏≠Ë∞ÉÁî®È¢ÑÂÆö‰πâÁöÑÂ≠êÂ∑•‰ΩúÊµÅÔºåÂÆûÁé∞‰ª£Á†ÅÂ§çÁî®ÂíåÊ®°ÂùóÂåñËÆæËÆ°„ÄÇ</p>
<h4 id="531-Â≠êÂõæËäÇÁÇπÁ±ªÂûã">5.3.1 Â≠êÂõæËäÇÁÇπÁ±ªÂûã
</h4><p>Spring AI Alibaba GraphÊîØÊåÅ‰∏§ÁßçÁ±ªÂûãÁöÑÂ≠êÂõæËäÇÁÇπÔºö</p>
<h5 id="substategraphnode---Êú™ÁºñËØëÂ≠êÂõæËäÇÁÇπ">SubStateGraphNode - Êú™ÁºñËØëÂ≠êÂõæËäÇÁÇπ
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SubStateGraphNode</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">StateGraph</span><span class="w"> </span><span class="n">subGraph</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">SubStateGraphNode</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">StateGraph</span><span class="w"> </span><span class="n">subGraph</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Âú®ËøêË°åÊó∂ÁºñËØëÂ≠êÂõæ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">CompiledGraph</span><span class="w"> </span><span class="n">compiledSubGraph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subGraph</span><span class="p">.</span><span class="na">compile</span><span class="p">(</span><span class="n">config</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SubGraphAction</span><span class="p">(</span><span class="n">compiledSubGraph</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">subGraph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subGraph</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="subcompiledgraphnode---È¢ÑÁºñËØëÂ≠êÂõæËäÇÁÇπ">SubCompiledGraphNode - È¢ÑÁºñËØëÂ≠êÂõæËäÇÁÇπ
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SubCompiledGraphNode</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CompiledGraph</span><span class="w"> </span><span class="n">subGraph</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">SubCompiledGraphNode</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">CompiledGraph</span><span class="w"> </span><span class="n">subGraph</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SubGraphAction</span><span class="p">(</span><span class="n">subGraph</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">subGraph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subGraph</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="532-Â≠êÂõæÂÆö‰πâ‰∏é‰ΩøÁî®">5.3.2 Â≠êÂõæÂÆö‰πâ‰∏é‰ΩøÁî®
</h4><p><strong>ÂÆö‰πâÊñáÊ°£Â§ÑÁêÜÂ≠êÂõæ</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DocumentProcessingSubGraph</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">StateGraph</span><span class="w"> </span><span class="nf">createDocumentProcessingGraph</span><span class="p">(</span><span class="n">ChatModel</span><span class="w"> </span><span class="n">chatModel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ChatClient</span><span class="w"> </span><span class="n">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="n">chatModel</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ÊñáÊ°£ÊèêÂèñËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">DocumentExtractorNode</span><span class="w"> </span><span class="n">extractorNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DocumentExtractorNode</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;document_path&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;extracted_text&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;pdf&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;docx&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;txt&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ÊñáÊ°£ÂàÜÊûêËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">LlmNode</span><span class="w"> </span><span class="n">analysisNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LlmNode</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">chatClient</span><span class="p">(</span><span class="n">chatClient</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">systemPromptTemplate</span><span class="p">(</span><span class="s">&#34;‰Ω†ÊòØ‰∏Ä‰∏™ÊñáÊ°£ÂàÜÊûê‰∏ìÂÆ∂ÔºåËØ∑ÂàÜÊûêÊñáÊ°£ÂÜÖÂÆπÂπ∂ÊèêÂèñÂÖ≥ÈîÆ‰ø°ÊÅØ„ÄÇ&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">userPromptTemplate</span><span class="p">(</span><span class="s">&#34;ËØ∑ÂàÜÊûê‰ª•‰∏ãÊñáÊ°£ÂÜÖÂÆπÔºö\n{extracted_text}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">outputKey</span><span class="p">(</span><span class="s">&#34;analysis_result&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">KeyStrategyFactory</span><span class="w"> </span><span class="n">stateFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="o">&gt;</span><span class="w"> </span><span class="n">strategies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;document_path&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;extracted_text&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;analysis_result&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">strategies</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StateGraph</span><span class="p">(</span><span class="s">&#34;ÊñáÊ°£Â§ÑÁêÜÂ≠êÂõæ&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">stateFactory</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;extractor&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">extractorNode</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;analyzer&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">analysisNode</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;extractor&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;extractor&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;analyzer&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;analyzer&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">END</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Âú®‰∏ªÂ∑•‰ΩúÊµÅ‰∏≠‰ΩøÁî®Â≠êÂõæ</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MainWorkflowConfiguration</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">StateGraph</span><span class="w"> </span><span class="nf">mainWorkflow</span><span class="p">(</span><span class="n">ChatModel</span><span class="w"> </span><span class="n">chatModel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ÂàõÂª∫Â≠êÂõæ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">StateGraph</span><span class="w"> </span><span class="n">documentProcessingSubGraph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DocumentProcessingSubGraph</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">createDocumentProcessingGraph</span><span class="p">(</span><span class="n">chatModel</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ÂàõÂª∫ÂÖ∂‰ªñËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">QuestionClassifierNode</span><span class="w"> </span><span class="n">classifierNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">QuestionClassifierNode</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">chatClient</span><span class="p">(</span><span class="n">ChatClient</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="n">chatModel</span><span class="p">).</span><span class="na">build</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">inputTextKey</span><span class="p">(</span><span class="s">&#34;input&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">outputKey</span><span class="p">(</span><span class="s">&#34;classifier_output&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">categories</span><span class="p">(</span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;document_processing&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;general_question&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">LlmNode</span><span class="w"> </span><span class="n">generalAnswerNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LlmNode</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">chatClient</span><span class="p">(</span><span class="n">ChatClient</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="n">chatModel</span><span class="p">).</span><span class="na">build</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">systemPromptTemplate</span><span class="p">(</span><span class="s">&#34;‰Ω†ÊòØ‰∏Ä‰∏™ÈÄöÁî®Âä©ÊâãÔºåËØ∑ÂõûÁ≠îÁî®Êà∑ÁöÑÈóÆÈ¢ò„ÄÇ&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">userPromptTemplate</span><span class="p">(</span><span class="s">&#34;Áî®Êà∑ÈóÆÈ¢òÔºö{input}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">outputKey</span><span class="p">(</span><span class="s">&#34;general_answer&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">KeyStrategyFactory</span><span class="w"> </span><span class="n">stateFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="o">&gt;</span><span class="w"> </span><span class="n">strategies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;input&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;classifier_output&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;document_path&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;extracted_text&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;analysis_result&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;general_answer&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">strategies</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StateGraph</span><span class="p">(</span><span class="s">&#34;‰∏ªÂ∑•‰ΩúÊµÅ&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">stateFactory</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;classifier&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">classifierNode</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;document_processor&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">documentProcessingSubGraph</span><span class="p">)</span><span class="w">  </span><span class="c1">// Ê∑ªÂä†Â≠êÂõæ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;general_answer&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">generalAnswerNode</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;classifier&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addConditionalEdges</span><span class="p">(</span><span class="s">&#34;classifier&#34;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">edge_async</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ClassifierDispatcher</span><span class="p">()),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;document_processing&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;document_processor&#34;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                       </span><span class="s">&#34;general_question&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;general_answer&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;document_processor&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">END</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;general_answer&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">END</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="533-Â≠êÂõæÊâßË°åÊµÅÁ®ã">5.3.3 Â≠êÂõæÊâßË°åÊµÅÁ®ã
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sequenceDiagram
</span></span><span class="line"><span class="cl">    participant Main as ‰∏ªÂ∑•‰ΩúÊµÅ
</span></span><span class="line"><span class="cl">    participant SubNode as Â≠êÂõæËäÇÁÇπ
</span></span><span class="line"><span class="cl">    participant SubGraph as Â≠êÂõæCompiledGraph
</span></span><span class="line"><span class="cl">    participant SubNodes as Â≠êÂõæÂÜÖÈÉ®ËäÇÁÇπ
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    Main-&gt;&gt;SubNode: ÊâßË°åÂ≠êÂõæËäÇÁÇπ
</span></span><span class="line"><span class="cl">    SubNode-&gt;&gt;SubGraph: Ë∞ÉÁî®Â≠êÂõæ.invoke()
</span></span><span class="line"><span class="cl">    SubGraph-&gt;&gt;SubNodes: ÊâßË°åÂ≠êÂõæÂÜÖÈÉ®ÊµÅÁ®ã
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    loop Â≠êÂõæÂÜÖÈÉ®ÊâßË°å
</span></span><span class="line"><span class="cl">        SubNodes-&gt;&gt;SubNodes: ËäÇÁÇπÈó¥Áä∂ÊÄÅÊµÅËΩ¨
</span></span><span class="line"><span class="cl">    end
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    SubNodes--&gt;&gt;SubGraph: ËøîÂõûÂ≠êÂõæÁªìÊûú
</span></span><span class="line"><span class="cl">    SubGraph--&gt;&gt;SubNode: ËøîÂõûÊâßË°åÁªìÊûú
</span></span><span class="line"><span class="cl">    SubNode--&gt;&gt;Main: Êõ¥Êñ∞‰∏ªÂ∑•‰ΩúÊµÅÁä∂ÊÄÅ
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="534-Â≠êÂõæÁä∂ÊÄÅÁÆ°ÁêÜ">5.3.4 Â≠êÂõæÁä∂ÊÄÅÁÆ°ÁêÜ
</h4><p><strong>Áä∂ÊÄÅÈöîÁ¶ª‰∏é‰º†ÈÄí</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SubGraphAction</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AsyncNodeActionWithConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CompiledGraph</span><span class="w"> </span><span class="n">subGraph</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">OverAllState</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">RunnableConfig</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// ‰ªé‰∏ªÁä∂ÊÄÅ‰∏≠ÊèêÂèñÂ≠êÂõæÈúÄË¶ÅÁöÑÊï∞ÊçÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">subGraphInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extractSubGraphInput</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// ÊâßË°åÂ≠êÂõæ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">OverAllState</span><span class="o">&gt;</span><span class="w"> </span><span class="n">subGraphResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subGraph</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">subGraphInput</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// Â∞ÜÂ≠êÂõæÁªìÊûúÊò†Â∞ÑÂõû‰∏ªÁä∂ÊÄÅ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">mapSubGraphOutput</span><span class="p">(</span><span class="n">subGraphResult</span><span class="p">.</span><span class="na">orElse</span><span class="p">(</span><span class="kc">null</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;Â≠êÂõæÊâßË°åÂ§±Ë¥•&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">extractSubGraphInput</span><span class="p">(</span><span class="n">OverAllState</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Ê†πÊçÆÂ≠êÂõæÁöÑËæìÂÖ•ÈúÄÊ±ÇÊèêÂèñÊï∞ÊçÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">(</span><span class="s">&#34;document_path&#34;</span><span class="p">).</span><span class="na">ifPresent</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;document_path&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">(</span><span class="s">&#34;input&#34;</span><span class="p">).</span><span class="na">ifPresent</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;input&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">input</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">mapSubGraphOutput</span><span class="p">(</span><span class="n">OverAllState</span><span class="w"> </span><span class="n">subGraphState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">subGraphState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Â∞ÜÂ≠êÂõæÁöÑËæìÂá∫Êò†Â∞ÑÂà∞‰∏ªÁä∂ÊÄÅ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">subGraphState</span><span class="p">.</span><span class="na">value</span><span class="p">(</span><span class="s">&#34;analysis_result&#34;</span><span class="p">).</span><span class="na">ifPresent</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">output</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;analysis_result&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">subGraphState</span><span class="p">.</span><span class="na">value</span><span class="p">(</span><span class="s">&#34;extracted_text&#34;</span><span class="p">).</span><span class="na">ifPresent</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">output</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;extracted_text&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">output</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="54-‰∏≠Êñ≠‰∏éÊÅ¢Â§çÊú∫Âà∂">5.4 ‰∏≠Êñ≠‰∏éÊÅ¢Â§çÊú∫Âà∂
</h3><p><strong>‰∏≠Êñ≠‰∏éÊÅ¢Â§çÊú∫Âà∂ÊòØÂ∑•‰ΩúÊµÅÁöÑÂÆπÈîô‰øùÈöú</strong>ÔºåÂÆÉËÆ©Â∑•‰ΩúÊµÅËÉΩÂ§üÂú®ÈÅáÂà∞ÈúÄË¶Å‰∫∫Â∑•Âπ≤È¢ÑÊàñÂ§ñÈÉ®Êù°‰ª∂‰∏çÊª°Ë∂≥Êó∂‰ºòÈõÖÂú∞ÊöÇÂÅúÊâßË°åÔºåÂπ∂Âú®Êù°‰ª∂Êª°Ë∂≥ÂêéÊó†ÁºùÊÅ¢Â§ç„ÄÇËøôÁßçÊú∫Âà∂ÂØπ‰∫éÊûÑÂª∫ÂèØÈù†ÁöÑ‰ºÅ‰∏öÁ∫ßAIÂ∫îÁî®Ëá≥ÂÖ≥ÈáçË¶Å„ÄÇ</p>
<h4 id="541-‰∏≠Êñ≠Êú∫Âà∂ÂéüÁêÜ">5.4.1 ‰∏≠Êñ≠Êú∫Âà∂ÂéüÁêÜ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">stateDiagram-v2
</span></span><span class="line"><span class="cl">    [*] --&gt; Executing: ÂºÄÂßãÊâßË°å
</span></span><span class="line"><span class="cl">    Executing --&gt; CheckingInterrupt: Ê£ÄÊü•‰∏≠Êñ≠Êù°‰ª∂
</span></span><span class="line"><span class="cl">    CheckingInterrupt --&gt; Interrupted: Êª°Ë∂≥‰∏≠Êñ≠Êù°‰ª∂
</span></span><span class="line"><span class="cl">    CheckingInterrupt --&gt; ContinueExecuting: ÁªßÁª≠ÊâßË°å
</span></span><span class="line"><span class="cl">    ContinueExecuting --&gt; Executing: ‰∏ã‰∏Ä‰∏™ËäÇÁÇπ
</span></span><span class="line"><span class="cl">    Interrupted --&gt; SavingSnapshot: ‰øùÂ≠òÁä∂ÊÄÅÂø´ÁÖß
</span></span><span class="line"><span class="cl">    SavingSnapshot --&gt; WaitingForResume: Á≠âÂæÖÊÅ¢Â§ç
</span></span><span class="line"><span class="cl">    WaitingForResume --&gt; LoadingSnapshot: Âä†ËΩΩÂø´ÁÖß
</span></span><span class="line"><span class="cl">    LoadingSnapshot --&gt; Executing: ÊÅ¢Â§çÊâßË°å
</span></span><span class="line"><span class="cl">    Executing --&gt; [*]: ÊâßË°åÂÆåÊàê
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="542-‰∏≠Êñ≠Êù°‰ª∂ÈÖçÁΩÆ">5.4.2 ‰∏≠Êñ≠Êù°‰ª∂ÈÖçÁΩÆ
</h4><p><strong>InterruptBefore - ËäÇÁÇπÊâßË°åÂâç‰∏≠Êñ≠</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">InterruptConfiguration</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompiledGraph</span><span class="w"> </span><span class="nf">interruptableGraph</span><span class="p">(</span><span class="n">StateGraph</span><span class="w"> </span><span class="n">stateGraph</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">stateGraph</span><span class="p">.</span><span class="na">compile</span><span class="p">(</span><span class="n">CompileConfig</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">withInterruptBefore</span><span class="p">(</span><span class="s">&#34;human_approval&#34;</span><span class="p">)</span><span class="w">  </span><span class="c1">// Âú®human_approvalËäÇÁÇπÂâç‰∏≠Êñ≠</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>InterruptAfter - ËäÇÁÇπÊâßË°åÂêé‰∏≠Êñ≠</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">CompiledGraph</span><span class="w"> </span><span class="nf">interruptableGraph</span><span class="p">(</span><span class="n">StateGraph</span><span class="w"> </span><span class="n">stateGraph</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">stateGraph</span><span class="p">.</span><span class="na">compile</span><span class="p">(</span><span class="n">CompileConfig</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">withInterruptAfter</span><span class="p">(</span><span class="s">&#34;data_processing&#34;</span><span class="p">)</span><span class="w">  </span><span class="c1">// Âú®data_processingËäÇÁÇπÂêé‰∏≠Êñ≠</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Âä®ÊÄÅ‰∏≠Êñ≠Êù°‰ª∂</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DynamicInterruptNode</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AsyncNodeActionWithConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">OverAllState</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">RunnableConfig</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶Å‰∏≠Êñ≠</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">shouldInterrupt</span><span class="p">(</span><span class="n">state</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// ËÆæÁΩÆ‰∏≠Êñ≠Ê∂àÊÅØ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">state</span><span class="p">.</span><span class="na">setInterruptMessage</span><span class="p">(</span><span class="s">&#34;ÈúÄË¶Å‰∫∫Â∑•ÂÆ°ÊâπÔºåËØ∑Ê£ÄÊü•Êï∞ÊçÆË¥®Èáè&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">result</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;interrupt_reason&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;data_quality_check&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">result</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;requires_approval&#34;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Ê≠£Â∏∏Â§ÑÁêÜÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">processData</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">shouldInterrupt</span><span class="p">(</span><span class="n">OverAllState</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Ëá™ÂÆö‰πâ‰∏≠Êñ≠Êù°‰ª∂ÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Double</span><span class="w"> </span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Double</span><span class="p">)</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">(</span><span class="s">&#34;confidence_score&#34;</span><span class="p">).</span><span class="na">orElse</span><span class="p">(</span><span class="n">1</span><span class="p">.</span><span class="na">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">confidence</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">8</span><span class="p">;</span><span class="w">  </span><span class="c1">// ÁΩÆ‰ø°Â∫¶‰Ωé‰∫é80%Êó∂‰∏≠Êñ≠</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="543-Áä∂ÊÄÅÂø´ÁÖßÁÆ°ÁêÜ">5.4.3 Áä∂ÊÄÅÂø´ÁÖßÁÆ°ÁêÜ
</h4><p><strong>ÂÜÖÂ≠òÂø´ÁÖßÂ≠òÂÇ®</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MemorySnapshotManager</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">OverAllState</span><span class="o">&gt;</span><span class="w"> </span><span class="n">snapshots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">saveSnapshot</span><span class="p">(</span><span class="n">OverAllState</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">snapshotId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">snapshots</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">snapshotId</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">snapShot</span><span class="p">().</span><span class="na">orElse</span><span class="p">(</span><span class="n">state</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">snapshotId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">OverAllState</span><span class="w"> </span><span class="nf">loadSnapshot</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">snapshotId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">OverAllState</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snapshots</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">snapshotId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">snapshot</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&#34;Âø´ÁÖß‰∏çÂ≠òÂú®: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">snapshotId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">snapshot</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">removeSnapshot</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">snapshotId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">snapshots</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">snapshotId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÊåÅ‰πÖÂåñÂø´ÁÖßÂ≠òÂÇ®</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PersistentSnapshotManager</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">redisTemplate</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">saveSnapshot</span><span class="p">(</span><span class="n">OverAllState</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">snapshotId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">serializedState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">opsForValue</span><span class="p">().</span><span class="na">set</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="s">&#34;snapshot:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">snapshotId</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">serializedState</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Duration</span><span class="p">.</span><span class="na">ofHours</span><span class="p">(</span><span class="n">24</span><span class="p">)</span><span class="w">  </span><span class="c1">// 24Â∞èÊó∂ËøáÊúü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">snapshotId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;‰øùÂ≠òÂø´ÁÖßÂ§±Ë¥•&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">OverAllState</span><span class="w"> </span><span class="nf">loadSnapshot</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">snapshotId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">serializedState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">opsForValue</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;snapshot:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">snapshotId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">serializedState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&#34;Âø´ÁÖß‰∏çÂ≠òÂú®: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">snapshotId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">.</span><span class="na">readValue</span><span class="p">(</span><span class="n">serializedState</span><span class="p">,</span><span class="w"> </span><span class="n">OverAllState</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;Âä†ËΩΩÂø´ÁÖßÂ§±Ë¥•&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="6-Âø´ÈÄüÂºÄÂßã‰∏éÂÆûÊàòÊåáÂçó">6. Âø´ÈÄüÂºÄÂßã‰∏éÂÆûÊàòÊåáÂçó
</h2><h3 id="61-ÁéØÂ¢ÉÂáÜÂ§á">6.1 ÁéØÂ¢ÉÂáÜÂ§á
</h3><h4 id="611-‰æùËµñÈÖçÁΩÆ">6.1.1 ‰æùËµñÈÖçÁΩÆ
</h4><p>Âú®ÊÇ®ÁöÑSpring BootÈ°πÁõÆ‰∏≠Ê∑ªÂä†Spring AI Alibaba Graph‰æùËµñÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;properties&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;spring-ai-alibaba.version&gt;</span>1.0.0.3-SNAPSHOT<span class="nt">&lt;/spring-ai-alibaba.version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/properties&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud.ai<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-ai-alibaba-starter-dashscope<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>${spring-ai-alibaba.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud.ai<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-ai-alibaba-graph-core<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>${spring-ai-alibaba.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="62-Âø´ÈÄüÂºÄÂßãÊµÅÁ®ã">6.2 Âø´ÈÄüÂºÄÂßãÊµÅÁ®ã
</h3><h4 id="621-ÂàõÂª∫Á¨¨‰∏Ä‰∏™Â∑•‰ΩúÊµÅ">6.2.1 ÂàõÂª∫Á¨¨‰∏Ä‰∏™Â∑•‰ΩúÊµÅ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyFirstGraphConfiguration</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">StateGraph</span><span class="w"> </span><span class="nf">myFirstGraph</span><span class="p">(</span><span class="n">ChatModel</span><span class="w"> </span><span class="n">chatModel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 1. ÂàõÂª∫ChatClient</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ChatClient</span><span class="w"> </span><span class="n">chatClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChatClient</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="n">chatModel</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 2. ÂÆö‰πâËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">LlmNode</span><span class="w"> </span><span class="n">welcomeNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LlmNode</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">chatClient</span><span class="p">(</span><span class="n">chatClient</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">systemPromptTemplate</span><span class="p">(</span><span class="s">&#34;‰Ω†ÊòØ‰∏Ä‰∏™ÂèãÂ•ΩÁöÑÂä©Êâã&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">userPromptTemplate</span><span class="p">(</span><span class="s">&#34;Ê¨¢ËøéÁî®Êà∑Ôºö{input}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">outputKey</span><span class="p">(</span><span class="s">&#34;welcome_message&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 3. ÂÆö‰πâÁä∂ÊÄÅÁ≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">KeyStrategyFactory</span><span class="w"> </span><span class="n">stateFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">KeyStrategy</span><span class="o">&gt;</span><span class="w"> </span><span class="n">strategies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;input&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">strategies</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;welcome_message&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReplaceStrategy</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">strategies</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 4. ÊûÑÂª∫Â∑•‰ΩúÊµÅ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StateGraph</span><span class="p">(</span><span class="s">&#34;ÊàëÁöÑÁ¨¨‰∏Ä‰∏™Â∑•‰ΩúÊµÅ&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">stateFactory</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addNode</span><span class="p">(</span><span class="s">&#34;welcome&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">node_async</span><span class="p">(</span><span class="n">welcomeNode</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;welcome&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addEdge</span><span class="p">(</span><span class="s">&#34;welcome&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">END</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompiledGraph</span><span class="w"> </span><span class="nf">compiledGraph</span><span class="p">(</span><span class="n">StateGraph</span><span class="w"> </span><span class="n">myFirstGraph</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">myFirstGraph</span><span class="p">.</span><span class="na">compile</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="622-‰ΩøÁî®Â∑•‰ΩúÊµÅ">6.2.2 ‰ΩøÁî®Â∑•‰ΩúÊµÅ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GraphController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CompiledGraph</span><span class="w"> </span><span class="n">compiledGraph</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&#34;/chat&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">chat</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">OverAllState</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compiledGraph</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&#34;input&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">OverAllState</span><span class="p">::</span><span class="n">data</span><span class="p">).</span><span class="na">orElse</span><span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="63-ÂÆåÊï¥Á§∫‰æãÈ°πÁõÆ">6.3 ÂÆåÊï¥Á§∫‰æãÈ°πÁõÆ
</h3><p>‰∏∫‰∫ÜÂ∏ÆÂä©ÂºÄÂèëËÄÖÊõ¥Â•ΩÂú∞ÁêÜËß£Âíå‰ΩøÁî®Spring AI Alibaba GraphÔºåÊàë‰ª¨Êèê‰æõ‰∫ÜÂÆåÊï¥ÁöÑÁ§∫‰æãÈ°πÁõÆÔºö</p>
<p><strong>üìö ÂÆòÊñπÁ§∫‰æã‰ªìÂ∫ì</strong>Ôºö<a class="link" href="https://github.com/springaialibaba/spring-ai-alibaba-examples/tree/main/spring-ai-alibaba-graph-example"  target="_blank" rel="noopener"
    >spring-ai-alibaba-graph-example</a></p>
<p><strong>Âø´ÈÄü‰ΩìÈ™åÊ≠•È™§</strong>Ôºö</p>
<ol>
<li>
<p><strong>ÂÖãÈöÜ‰ªìÂ∫ì</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/springaialibaba/spring-ai-alibaba-examples.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> spring-ai-alibaba-examples/spring-ai-alibaba-graph-example
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>ÈÖçÁΩÆÁéØÂ¢É</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># ËÆæÁΩÆDashScope API Key</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AI_DASHSCOPE_API_KEY</span><span class="o">=</span>your_api_key_here
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>ËøêË°åÁ§∫‰æã</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mvn spring-boot:run
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h3 id="64-Á§æÂå∫ÊîØÊåÅ">6.4 Á§æÂå∫ÊîØÊåÅ
</h3><p><strong>ÊäÄÊúØÊîØÊåÅ</strong>Ôºö</p>
<ul>
<li><strong>GitHub Issues</strong>Ôºö<a class="link" href="https://github.com/alibaba/spring-ai-alibaba/issues"  target="_blank" rel="noopener"
    >Êèê‰∫§ÈóÆÈ¢òÂíåÂª∫ËÆÆ</a></li>
<li><strong>ÂÆòÊñπÊñáÊ°£</strong>Ôºö<a class="link" href="https://java2ai.com/"  target="_blank" rel="noopener"
    >ÂÆåÊï¥ÊñáÊ°£Á´ôÁÇπ</a></li>
<li><strong>Á§∫‰æã‰ª£Á†Å</strong>Ôºö<a class="link" href="https://github.com/springaialibaba/spring-ai-alibaba-examples"  target="_blank" rel="noopener"
    >Êõ¥Â§öÁ§∫‰æã</a></li>
</ul>
<p>ÈÄöËøá‰ª•‰∏äÊåáÂçóÂíåÂÆåÊï¥ÁöÑÁ§∫‰æãÈ°πÁõÆÔºåÊÇ®ÂèØ‰ª•Âø´ÈÄüÊéåÊè°Spring AI Alibaba GraphÁöÑ‰ΩøÁî®ÊñπÊ≥ïÔºåÂπ∂Âú®ÂÆûÈôÖÈ°πÁõÆ‰∏≠È´òÊïàÂú∞ÊûÑÂª∫Êô∫ËÉΩÂåñÂ∫îÁî®„ÄÇ</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/java/">Java</a>
        
            <a href="/tags/llm/">LLM</a>
        
            <a href="/tags/infrastructure/">Infrastructure</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/langsmith%E8%B0%83%E7%A0%94%E8%AE%B0%E5%BD%95/">
        
        

        <div class="article-details">
            <h2 class="article-title">LangSmithË∞ÉÁ†îËÆ∞ÂΩï</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E5%85%AB%E8%82%A1%E6%96%87%E4%B9%8Bjava%E9%9B%86%E5%90%88/">
        
        

        <div class="article-details">
            <h2 class="article-title">ÂÖ´ËÇ°Êñá‰πãJavaÈõÜÂêà</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E5%85%AB%E8%82%A1%E6%96%87%E4%B9%8Bjava%E5%9F%BA%E7%A1%80/">
        
        

        <div class="article-details">
            <h2 class="article-title">ÂÖ´ËÇ°Êñá‰πãJavaÂü∫Á°Ä</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E5%85%AB%E8%82%A1%E6%96%87%E4%B9%8Bjava%E5%B9%B6%E5%8F%91/">
        
        

        <div class="article-details">
            <h2 class="article-title">ÂÖ´ËÇ°Êñá‰πãJavaÂπ∂Âèë</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/spring-ai-alibaba-graph-core-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/">
        
        

        <div class="article-details">
            <h2 class="article-title">spring-ai-alibaba-graph-core Ê∫êÁ†ÅÈòÖËØª</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 sixiyida
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
